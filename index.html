<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hongyi&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hongyi&#39;s blog">
<meta property="og:url" content="https://godshy.github.io/blog/index.html">
<meta property="og:site_name" content="Hongyi&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Hongyi Shen">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/blog/atom.xml" title="Hongyi's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/blog/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/blog/css/style.css">

  
    
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Hongyi&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/blog/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://godshy.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Deploy-kubernetes-and-datadog-on-AWS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2026/01/29/Deploy-kubernetes-and-datadog-on-AWS/" class="article-date">
  <time class="dt-published" datetime="2026-01-29T05:15:27.000Z" itemprop="datePublished">2026-01-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/DIY-and-lab/">DIY and lab</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2026/01/29/Deploy-kubernetes-and-datadog-on-AWS/">Deploy kubernetes and datadog on AWS</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Deploy-Kubernetes-cluster-on-AWS-then-perform-monitoring-and-enable-observability-using-datadog"><a href="#Deploy-Kubernetes-cluster-on-AWS-then-perform-monitoring-and-enable-observability-using-datadog" class="headerlink" title="Deploy Kubernetes cluster on AWS, then perform monitoring and enable observability using datadog"></a>Deploy Kubernetes cluster on AWS, then perform monitoring and enable observability using datadog</h1><p>In this blog, I want to test deploying a kubernetes with 2 worker nodes and 1 master node, worker nodes are deployed on different AZs.</p>
<p>I will firstly set up EC-2 with the dumbest way (set up manually with all handcrafts and then set up kubernetes manually) and set datadog to try monitor the kubernetes environment. Then try using terraform, ansible to make the process easier, and temper with some fancy parts(different deploy patterns, ELBs, other services) on AWS.</p>
<h2 id="Set-up-EC2-instance"><a href="#Set-up-EC2-instance" class="headerlink" title="Set up EC2 instance"></a>Set up EC2 instance</h2><p>Launch EC2 instance first, open console, search for EC2 and click Launch instances</p>
<p>Configure following:</p>
<ul>
<li>Name and tages: Master x1 and Worker x2</li>
<li>Application and OS image: I chose Ubuntu, but any other distribution is OK</li>
<li>Key pair: it is used to connect to the instance remotelly, I set one for master and one for works</li>
<li>Network settings: For one worker, change Subnet to let it placed in a different AZ from other instances. Other parameters just leave them default here. (For security group, it will create security group and allow inbound SSH only in default we can change it later.)</li>
</ul>
<p>Others leave the same. And click launch</p>
<p><img src="https://s2.loli.net/2026/01/29/mtqsnkbhXKY4AVR.png" alt="ec2 launch.png"></p>
<p><img src="https://s2.loli.net/2026/01/29/d2pwOvitNB3berf.png" alt="ec2 launch 2.png"></p>
<p>After launch successful, we should see all three instance are up and running. By default, these 3 instances are attached with public ipv4 ip address and attached default internet gateway, so we can ssh to them using key pair created previously. Notice that one worker’s AZ is different from the others.</p>
<p><img src="https://s2.loli.net/2026/01/29/senbyGNAwap6VCu.png" alt="1.1 3 ec2 launched on aws.png"></p>
<p>Then we connect to them using terminal and do some initial configurations:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br><span class="line">sudo hostnamectl set-hostname Master1/Worker1/Worker2</span><br><span class="line">sudo reboot</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Return to console, since by default security group only allow inbound SSH, we need to configure network access with each node. Go to security groups, click create new security group and specify a good name for each instance. Firstly allow ssh from anywhere, then add new inbound rules from other instances. For example SG for mmaster should allow traffic from worker1 and worker2. After configured all of the SGs, go to instance -&gt; Actions -&gt; Security -&gt; Change security groups,<br>Unbind the default SG and attach created new SG to it.</p>
<p><img src="https://s2.loli.net/2026/01/29/TVmNnW3XL7BFMdh.png" alt="SG.png"></p>
<p><img src="https://s2.loli.net/2026/01/29/v7GNjkq9sPD1WyR.png" alt="sg configure.png"></p>
<p><img src="https://s2.loli.net/2026/01/29/6HoTKMNCDcxfbwp.png" alt="SG detach.png"></p>
<p>Check ping for each instance, no ping should get through.</p>
<p>Modify <code>/etc/hosts</code>. add hostname for each other. So that each instance can ping with others with their hostname.</p>
<p><em><strong>Important things to be noticed:</strong></em></p>
<ul>
<li>Since there is no Elastic IP attached, after instance is relaunched thru console, Public IP will change</li>
<li>Micro EC2 (mem under 2048) may have some problem when installing kubernetes control plane components. We may need to change instance type for larger memory.</li>
</ul>
<p>Refer to <a href="https://godshy.github.io/blog/2026/01/05/Deploy-k8s-cluster/">Install k8s on vm</a> for the cluster installation.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2026/01/29/Deploy-kubernetes-and-datadog-on-AWS/" data-id="cmkzmweom0005l4ur99ua9str" data-title="Deploy kubernetes and datadog on AWS" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/AWS-K8s/" rel="tag">AWS, K8s</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-kubernetes-security" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2026/01/22/kubernetes-security/" class="article-date">
  <time class="dt-published" datetime="2026-01-21T15:16:26.000Z" itemprop="datePublished">2026-01-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/security/">security</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2026/01/22/kubernetes-security/">kubernetes security</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="Pod-Security-Admission-PSA"><a href="#Pod-Security-Admission-PSA" class="headerlink" title="Pod Security Admission (PSA)"></a>Pod Security Admission (PSA)</h3><p>Enforce a pod to follow a certain security context, otherwise it cannot be scheduled:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">kubernetes.io/metadata.name:</span> <span class="string">security_enforced</span></span><br><span class="line">    <span class="attr">pod-security.kubernetes.io/enforce:</span> <span class="string">restricted</span></span><br><span class="line">    <span class="attr">pod-security.kubernetes.io/enforce-version:</span> <span class="string">latest</span></span><br><span class="line">    <span class="attr">pod-security.kubernetes.io/warn:</span> <span class="string">restricted</span></span><br><span class="line">    <span class="attr">pod-security.kubernetes.io/warn-version:</span> <span class="string">latest</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">security_enforced</span></span><br></pre></td></tr></table></figure>

<p>If you have pod violate the security policy, when restarting it will have following error:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">     kubectl rollout restart -f nginx.yaml </span><br><span class="line">Warning: would violate PodSecurity <span class="string">&quot;restricted:latest&quot;</span>: allowPrivilegeEscalation != <span class="literal">false</span> (container <span class="string">&quot;nginx&quot;</span> must <span class="built_in">set</span> securityContext.allowPrivilegeEscalation=<span class="literal">false</span>), unrestricted capabilities (container <span class="string">&quot;nginx&quot;</span> must <span class="built_in">set</span> securityContext.capabilities.drop=[<span class="string">&quot;ALL&quot;</span>]), runAsNonRoot != <span class="literal">true</span> (pod or container <span class="string">&quot;nginx&quot;</span> must <span class="built_in">set</span> securityContext.runAsNonRoot=<span class="literal">true</span>), seccompProfile (pod or container <span class="string">&quot;nginx&quot;</span> must <span class="built_in">set</span> securityContext.seccompProfile.<span class="built_in">type</span> to <span class="string">&quot;RuntimeDefault&quot;</span> or <span class="string">&quot;Localhost&quot;</span>)</span><br><span class="line">deployment.apps/nginx restarted</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2026/01/22/kubernetes-security/" data-id="cmkzmweot000sl4urf7c6g2t1" data-title="kubernetes security" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/K8s/" rel="tag">K8s</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-deploy-5gc-on-kubernetes" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2026/01/05/deploy-5gc-on-kubernetes/" class="article-date">
  <time class="dt-published" datetime="2026-01-05T13:23:51.000Z" itemprop="datePublished">2026-01-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/DIY-and-lab/">DIY and lab</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2026/01/05/deploy-5gc-on-kubernetes/">Deploy-5gc-on-kubernetes</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Install-5GC-on-kubernetes-cluster"><a href="#Install-5GC-on-kubernetes-cluster" class="headerlink" title="Install 5GC on kubernetes cluster"></a>Install 5GC on kubernetes cluster</h1><h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>2 years ago, I tried to deploy 5gc on a minikube vm, and installed free5gc. However, free5gc is no longer supported and there are problems related to calico cannot be resolved. This time I select another repository and installed on a real kubernetes cluster.</p>
<h2 id="Cluster-installation-and-preparation"><a href="#Cluster-installation-and-preparation" class="headerlink" title="Cluster installation and preparation"></a>Cluster installation and preparation</h2><p>For kubernetes cluster installation, check my other post <strong>Deploy kubernetes cluster on virtual machine</strong>. </p>
<h3 id="CNI-plugin"><a href="#CNI-plugin" class="headerlink" title="CNI plugin"></a>CNI plugin</h3><p>When installing network plugin, a calico plugin is installed, it enables pod-pod network, node-node connectivety. However, when deploying 5gs, multiple ports on pod are needed. For example, when adding UPF, an interface for user-plane and an interface for control-plane are both required. Here I installed multus-CNI to accomplish such requirement.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/k8snetworkplumbingwg/multus-cni/master/deployments/multus-daemonset.yml</span><br></pre></td></tr></table></figure>
<p>Check multus daemonset is installed on each node:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    kubectl get daemonset -n kube-system</span><br><span class="line">NAME             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE</span><br><span class="line">kube-multus-ds   2         2         2       2            2           &lt;none&gt;                   18d</span><br></pre></td></tr></table></figure>
<h3 id="Helm-installation"><a href="#Helm-installation" class="headerlink" title="Helm installation"></a>Helm installation</h3><p>Very simple, just execute following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3</span><br><span class="line"><span class="built_in">chmod</span> 700 get_helm.sh</span><br><span class="line">./get_helm.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="Metric-server"><a href="#Metric-server" class="headerlink" title="Metric server"></a>Metric server</h3><p>Need metric server to use <code> kubectl top</code> command, other wise it will just say: “error: Metrics API not available”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span><br></pre></td></tr></table></figure>


<p>However, after applied it, the pod didn’t go up, after checking the logs it says:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cannot validate certificate for x.x.x.x because it doesn&#x27;t contain any IP SANs&quot; node=&quot;xxx&quot;</span><br></pre></td></tr></table></figure>
<p>This means, kubelet server cert didn’t contain Subject Alternative Name, thus metric-server cannot connect to kubelet using TLS.</p>
<p>Run the following to check for the server certificate</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> /var/lib/kubelet/pki/kubelet.crt -noout -text | grep -A2 <span class="string">&quot;Subject Alternative Name&quot;</span></span><br></pre></td></tr></table></figure>
<p>There are two method to solve this:</p>
<ol>
<li>modify api-server side to let it ignore unsecure tls</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add kubelet-insecure-tls</span></span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - args:</span><br><span class="line">        - --kubelet-insecure-tls</span><br><span class="line">        - --cert-dir=/tmp</span><br><span class="line">        - --secure-port=10250</span><br><span class="line">        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span><br><span class="line">        - --kubelet-use-node-status-port</span><br><span class="line">        - --metric-resolution=15s</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>modifiy kubelet settings to renew a certificate and let it contain new SAN.</li>
</ol>
<p>Add following into &#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;config.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">serverTLSBootstrap:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="PVC-Under-construction"><a href="#PVC-Under-construction" class="headerlink" title="PVC (Under construction)"></a>PVC (Under construction)</h3><p>If installing kubernetes on local machine, storage class and pvc need to be configured, otherwise DB or statefulset cannot be actived.</p>
<h3 id="5GC-install-Under-construction"><a href="#5GC-install-Under-construction" class="headerlink" title="5GC install (Under construction)"></a>5GC install (Under construction)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">helm pull oci://registry-1.docker.io/gradiant/open5gs --version 2.2.0</span><br><span class="line">helm pull oci://registry-1.docker.io/gradiant/ueransim-gnb --version 0.2.6</span><br><span class="line"><span class="built_in">mkdir</span> 5gs</span><br><span class="line"><span class="built_in">mv</span> open5gs-2.2.0.tgz 5gs/</span><br><span class="line"><span class="built_in">mv</span> ueransim-gnb-0.2.6.tgz 5gs/</span><br><span class="line"><span class="built_in">cd</span> 5gs/</span><br><span class="line">tar -zxf open5gs-2.2.0.tgz</span><br><span class="line">tar -zxf ueransim-gnb-0.2.6.tgz</span><br><span class="line"></span><br><span class="line"><span class="comment"># If no need of 4g node, just modify values.yaml before installing. Here is my values without 4g.</span></span><br><span class="line">helm install open5gs -n 5gs ./open5gs-2.2.0.tgz --values ./open5gs/values_no4g.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  values_no4g.yaml</span></span><br><span class="line"><span class="attr">dbURI:</span> <span class="string">&quot;mongodb://<span class="template-variable">&#123;&#123; .Release.Name &#125;&#125;</span>-mongodb/open5gs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">populate:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">registry:</span> <span class="string">docker.io</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">gradiant/open5gs-dbctl</span></span><br><span class="line">    <span class="attr">tag:</span> <span class="number">0.10</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">pullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">initCommands:</span> []</span><br><span class="line">  <span class="comment"># example of initCommands:</span></span><br><span class="line">  <span class="comment">#  - open5gs-dbctl add 999700000000001 465B5CE8B199B49FAA5F0A2EE238A6BC E8ED289DEBA952E4283B54E88E6183CA</span></span><br><span class="line">  <span class="comment">#  - open5gs-dbctl add_ue_with_apn 999700000000002 465B5CE8B199B49FAA5F0A2EE238A6BC E8ED289DEBA952E4283B54E88E6183CA internet</span></span><br><span class="line">  <span class="comment">#  - open5gs-dbctl add_ue_with_slice 999700000000003 465B5CE8B199B49FAA5F0A2EE238A6BC E8ED289DEBA952E4283B54E88E6183CA internet 1 111111</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Common</span></span><br><span class="line"><span class="attr">mongodb:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">auth:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">smf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">upf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">webui:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4G</span></span><br><span class="line"><span class="attr">hss:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">mme:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">pcrf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">sgwc:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">sgwu:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5G</span></span><br><span class="line"><span class="attr">amf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">ausf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">bsf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">nrf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">nssf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">pcf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">scp:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">udm:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">udr:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2026/01/05/deploy-5gc-on-kubernetes/" data-id="cmkzmweos000ll4ur4usw0y88" data-title="Deploy-5gc-on-kubernetes" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/k8s-helm/" rel="tag">k8s, helm</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Deploy-k8s-cluster" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2026/01/05/Deploy-k8s-cluster/" class="article-date">
  <time class="dt-published" datetime="2026-01-05T12:44:58.000Z" itemprop="datePublished">2026-01-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2026/01/05/Deploy-k8s-cluster/">Deploy kubernetes cluster on virtual machine</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Set-up-VMs"><a href="#Set-up-VMs" class="headerlink" title="Set up VMs"></a>Set up VMs</h2><p><code>One Network Adapter for internet, the other is for  connection between Nodes</code></p>
<p><img src="https://s2.loli.net/2026/01/05/ZuVatjDWwBnSUbT.png" alt="VM spec"></p>
<p>I installed Ubuntu 22.04.5 LTS on my local PC, two VMs, one is for master the other is for worker. </p>
<p>After VMs are installed and running, make sure two VM can ping each other, then edit etc&#x2F;hosts to let them resolve each other’s hostname:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># On master</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line">192.168.168.129 worker</span><br><span class="line"></span><br><span class="line"><span class="comment"># On worker </span></span><br><span class="line">vim /etc/hosts</span><br><span class="line">192.168.168.128 master</span><br><span class="line"></span><br><span class="line"><span class="comment"># then ping using hostname:</span></span><br><span class="line">master:$ ping worker <span class="comment"># should be ok</span></span><br><span class="line">worker:$ ping master <span class="comment"># should be ok</span></span><br></pre></td></tr></table></figure>

<p>then execute following commands:</p>
<p>On Master and Worker:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade -y</span><br><span class="line"><span class="comment"># check your hostname:</span></span><br><span class="line"><span class="built_in">uname</span> -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># disable swapoff for better performance and best practice:</span></span><br><span class="line">sudo swapoff -a</span><br><span class="line">sudo sed -i <span class="string">&#x27;/ swap / s/^\(.*\)$/#\1/g&#x27;</span> /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add settings to containerd.conf  </span></span><br><span class="line"><span class="comment"># overlay (for using overlayfs),  </span></span><br><span class="line"><span class="comment"># br_netfilter (for ipvlan, macvlan, external SNAT of service IPs)  </span></span><br><span class="line">sudo <span class="built_in">tee</span> /etc/modules-load.d/containerd.conf &lt;&lt;<span class="string">EOF  </span></span><br><span class="line"><span class="string">overlay  </span></span><br><span class="line"><span class="string">br_netfilter  </span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment"># Add settings to kubernetes.conf  </span></span><br><span class="line"><span class="comment"># Allow IPv4, IPv6 and IP forwarding  </span></span><br><span class="line">sudo <span class="built_in">tee</span> /etc/sysctl.d/kubernetes.conf &lt;&lt;<span class="string">EOF  </span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1  </span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1  </span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1  </span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">	<span class="comment"># Reload updated config  </span></span><br><span class="line">	sudo sysctl --system  </span><br><span class="line">	  </span><br><span class="line">	<span class="comment"># Install required tools and CA certificates  </span></span><br><span class="line">	sudo apt install -y curl gnupg2 software-properties-common apt-transport-https ca-certificates  </span><br><span class="line">	  </span><br><span class="line">	<span class="comment"># Add Docker repository  </span></span><br><span class="line">	sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmour -o /etc/apt/trusted.gpg.d/docker.gpg  </span><br><span class="line">	sudo add-apt-repository <span class="string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># Then, install containerd  </span></span><br><span class="line">	sudo apt update  </span><br><span class="line">	sudo apt install -y containerd.io  </span><br><span class="line">	containerd config default | sudo <span class="built_in">tee</span> /etc/containerd/config.toml &gt;/dev/null 2&gt;&amp;1  </span><br><span class="line">	sudo sed -i <span class="string">&#x27;s/SystemdCgroup \= false/SystemdCgroup \= true/g&#x27;</span> /etc/containerd/config.toml  </span><br><span class="line">	sudo systemctl restart containerd  </span><br><span class="line">	sudo systemctl <span class="built_in">enable</span> containerd</span><br><span class="line"></span><br><span class="line">	<span class="comment"># Add k8s repository</span></span><br><span class="line">	<span class="comment"># Please modify v1.32 to latest from https://kubernetes.io/releases/</span></span><br><span class="line">	sudo <span class="built_in">mkdir</span> -p /etc/apt/keyrings</span><br><span class="line">	curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.32/deb/Release.key | gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.32/deb/ /&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/kubernetes.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># Then, install Kubernetes components  </span></span><br><span class="line">	sudo apt update  </span><br><span class="line">	sudo apt install -y kubelet kubeadm kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add port granted for etcd:</span></span><br><span class="line">	sudo iptables -A INPUT -p tcp --dport 6443 -j ACCEPT</span><br><span class="line"><span class="comment"># k8s cluster nodes  </span></span><br><span class="line">	sudo apt-get install docker-ce</span><br><span class="line"></span><br><span class="line">	sudo reboot</span><br></pre></td></tr></table></figure>

<h3 id="Set-up-master-and-worker-and-CNI-plugin"><a href="#Set-up-master-and-worker-and-CNI-plugin" class="headerlink" title="Set up master and worker and CNI plugin"></a>Set up master and worker and CNI plugin</h3><h4 id="On-Master"><a href="#On-Master" class="headerlink" title="On Master"></a>On Master</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">	sudo kubeadm config images pull</span><br><span class="line">	sudo kubeadm init --pod-network-cidr=192.168.0.0/16</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">I0602 21:23:23.755053    2030 version.go:261] remote version is much newer: v1.33.1; falling back to: stable-1.32</span><br><span class="line">[config/images] Pulled registry.k8s.io/kube-apiserver:v1.32.5</span><br><span class="line">[config/images] Pulled registry.k8s.io/kube-controller-manager:v1.32.5</span><br><span class="line">[config/images] Pulled registry.k8s.io/kube-scheduler:v1.32.5</span><br><span class="line">[config/images] Pulled registry.k8s.io/kube-proxy:v1.32.5</span><br><span class="line">[config/images] Pulled registry.k8s.io/coredns/coredns:v1.11.3</span><br><span class="line">[config/images] Pulled registry.k8s.io/pause:3.10</span><br><span class="line">[config/images] Pulled registry.k8s.io/etcd:3.5.16-0</span><br><span class="line">shy@shymaster:~$ sudo kubeadm init</span><br><span class="line">I0602 21:24:42.138404    2276 version.go:261] remote version is much newer: v1.33.1; falling back to: stable-1.32</span><br><span class="line">[init] Using Kubernetes version: v1.32.5</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] Pulling images required <span class="keyword">for</span> setting up a Kubernetes cluster</span><br><span class="line">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight] You can also perform this action beforehand using <span class="string">&#x27;kubeadm config images pull&#x27;</span></span><br><span class="line">W0602 21:24:42.808265    2276 checks.go:846] detected that the sandbox image <span class="string">&quot;registry.k8s.io/pause:3.8&quot;</span> of the container runtime is inconsistent with that used by kubeadm.It is recommended to use <span class="string">&quot;registry.k8s.io/pause:3.10&quot;</span> as the CRI sandbox image.</span><br><span class="line">[certs] Using certificateDir folder <span class="string">&quot;/etc/kubernetes/pki&quot;</span></span><br><span class="line">[certs] Generating <span class="string">&quot;ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver&quot;</span> certificate and key</span><br><span class="line">[certs] apiserver serving cert is signed <span class="keyword">for</span> DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local shymaster] and IPs [10.96.0.1 11.0.1.130]</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver-kubelet-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;front-proxy-ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;front-proxy-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/server&quot;</span> certificate and key</span><br><span class="line">[certs] etcd/server serving cert is signed <span class="keyword">for</span> DNS names [localhost shymaster] and IPs [11.0.1.130 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/peer&quot;</span> certificate and key</span><br><span class="line">[certs] etcd/peer serving cert is signed <span class="keyword">for</span> DNS names [localhost shymaster] and IPs [11.0.1.130 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/healthcheck-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver-etcd-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;sa&quot;</span> key and public key</span><br><span class="line">[kubeconfig] Using kubeconfig folder <span class="string">&quot;/etc/kubernetes&quot;</span></span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;admin.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;super-admin.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;kubelet.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;controller-manager.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;scheduler.conf&quot;</span> kubeconfig file</span><br><span class="line">[etcd] Creating static Pod manifest <span class="keyword">for</span> <span class="built_in">local</span> etcd <span class="keyword">in</span> <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[control-plane] Using manifest folder <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-apiserver&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-controller-manager&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-scheduler&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file <span class="string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet configuration to file <span class="string">&quot;/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[wait-control-plane] Waiting <span class="keyword">for</span> the kubelet to boot up the control plane as static Pods from directory <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[kubelet-check] Waiting <span class="keyword">for</span> a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s</span><br><span class="line">[kubelet-check] The kubelet is healthy after 502.872747ms</span><br><span class="line">[api-check] Waiting <span class="keyword">for</span> a healthy API server. This can take up to 4m0s</span><br><span class="line">[api-check] The API server is healthy after 7.00102198s</span><br><span class="line">[upload-config] Storing the configuration used <span class="keyword">in</span> ConfigMap <span class="string">&quot;kubeadm-config&quot;</span> <span class="keyword">in</span> the <span class="string">&quot;kube-system&quot;</span> Namespace</span><br><span class="line">[kubelet] Creating a ConfigMap <span class="string">&quot;kubelet-config&quot;</span> <span class="keyword">in</span> namespace kube-system with the configuration <span class="keyword">for</span> the kubelets <span class="keyword">in</span> the cluster</span><br><span class="line">[upload-certs] Skipping phase. Please see --upload-certs</span><br><span class="line">[mark-control-plane] Marking the node shymaster as control-plane by adding the labels: [node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]</span><br><span class="line">[mark-control-plane] Marking the node shymaster as control-plane by adding the taints [node-role.kubernetes.io/control-plane:NoSchedule]</span><br><span class="line">[bootstrap-token] Using token: qbqna4.vcib69rginbjmgi3</span><br><span class="line">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs <span class="keyword">in</span> order <span class="keyword">for</span> nodes to get long term certificate credentials</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow certificate rotation <span class="keyword">for</span> all node client certificates <span class="keyword">in</span> the cluster</span><br><span class="line">[bootstrap-token] Creating the <span class="string">&quot;cluster-info&quot;</span> ConfigMap <span class="keyword">in</span> the <span class="string">&quot;kube-public&quot;</span> namespace</span><br><span class="line">[kubelet-finalize] Updating <span class="string">&quot;/etc/kubernetes/kubelet.conf&quot;</span> to point to a rotatable kubelet client certificate and key</span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">Alternatively, <span class="keyword">if</span> you are the root user, you can run:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm <span class="built_in">join</span> ....</span><br><span class="line"><span class="comment">#-------------------#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Follow the instructions from above:</span></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install cni </span></span><br><span class="line"><span class="comment"># Find latest version on https://github.com/projectcalico/calico/releases</span></span><br><span class="line">	kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.30.1/manifests/calico.yaml</span><br></pre></td></tr></table></figure>


<h4 id="On-worker"><a href="#On-worker" class="headerlink" title="On worker"></a>On worker</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># just copy and paste kubeadm join .... command from kube init output on master node, it will automatically join the master node</span></span><br><span class="line">	kubeadm <span class="built_in">join</span> ....</span><br></pre></td></tr></table></figure>

<h3 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting:"></a>Troubleshooting:</h3><ul>
<li>Your node will not be ready unless you successfully installed CNI plugin, because your pod cannot communicate outside node. To check issue, run following command:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">journalctl -u kubelet</span><br><span class="line">journalctl -u containerd</span><br></pre></td></tr></table></figure>

<p>Example of the finish state:<br><img src="https://s2.loli.net/2026/01/05/2JkmfQElny6X5z1.png" alt="Final result"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2026/01/05/Deploy-k8s-cluster/" data-id="cmkzmweol0004l4ur5exc33mw" data-title="Deploy kubernetes cluster on virtual machine" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/K8s/" rel="tag">K8s</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-PKI-and-encryption-explained-step-by-step" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2024/07/18/PKI-and-encryption-explained-step-by-step/" class="article-date">
  <time class="dt-published" datetime="2024-07-18T02:40:47.000Z" itemprop="datePublished">2024-07-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/security/">security</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/07/18/PKI-and-encryption-explained-step-by-step/">PKI and encryption explained step by step</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="PKI-and-data-transfer-encryption-explained"><a href="#PKI-and-data-transfer-encryption-explained" class="headerlink" title="PKI and data transfer encryption explained"></a>PKI and data transfer encryption explained</h1><p>It is import to understand the concept of data layer encryption and security. Let’s understand how it works from scratch. I will explain this by using different scenarios. </p>
<h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><ol>
<li><a href="#what-we-want-to-achieve">Basic concept</a></li>
<li><a href="#scenario-1-no-encryption">Scenario 1</a></li>
<li><a href="#scenario-2-symmetric-encryption">Scenario 2</a></li>
<li><a href="#scenario-3-asymmetric-encryption">Scenario 3</a></li>
<li><a href="#scenario-4-digital-signature">Scenario 4</a></li>
<li><a href="#summary">Summary</a></li>
</ol>
<h2 id="What-we-want-to-achieve"><a href="#What-we-want-to-achieve" class="headerlink" title="What we want to achieve?"></a>What we want to achieve?</h2><p>It is always import to understand why we need data layer encryption in the first place. Here is some points that we need to consider if we want to protect the data when sending it to remote peers.</p>
<ul>
<li>confidentiality: Only targeted user or device can read and decrypt the data you sent. If attacker want to decrypt your data, they cannot achieve this within the time that this message or data is valid. Confidentiality is achieved by <strong>encryption algorithms</strong>.</li>
<li>integrity: You need to ensure that the data you sent is not alternated by third parties. Receiver can check to see if the data is original and the same as you sent. This is achieved by using <strong>Hash algorithms</strong>.</li>
<li>Source verification: Sender of data can be verified. Not by forged or created by unknown person. This is achieved by <strong>HMAC</strong>, hash message authentication code.</li>
<li>Deniability prevention: Sender of message or data cannot deny the fact that he sent this message. This is achieved by <strong>digital signature</strong>.</li>
</ul>
<p>Next let’s talk about how to encrypt and secure the connection between users.</p>
<h2 id="Scenario-1-no-encryption"><a href="#Scenario-1-no-encryption" class="headerlink" title="Scenario 1: no encryption"></a>Scenario 1: no encryption</h2><p>Imagine A want to send data to B, in which contains sensitive data.<br>In first scenario, A is sending plain text, hackers can easily stole the data by capturing packet. This is, obviously, not safe.<br><img src="https://s2.loli.net/2024/07/18/6tMxpNq2OAoFT5a.png" alt="Scenario 1, A is sending plain text o B."></p>
<h2 id="Scenario-2-symmetric-encryption"><a href="#Scenario-2-symmetric-encryption" class="headerlink" title="Scenario 2: symmetric encryption"></a>Scenario 2: symmetric encryption</h2><p>Let’s consider a encryption method to protect data transportation.<br>There is one method called <strong>symmetric encryption</strong>, data is encrypted and decrypted by a so-called key. In symmetric encryption, both encryption&#x2F;decryption is used by same key. So this doesn’t solve the problem of data leakage. If attackers stole the key, they are also able to see the content of data.<br><img src="https://s2.loli.net/2024/07/18/FSnuHhs178GkKxe.png" alt="Scenario 2, symmetric encryption, but not solving problems"></p>
<h2 id="Scenario-3-asymmetric-encryption"><a href="#Scenario-3-asymmetric-encryption" class="headerlink" title="Scenario 3: asymmetric encryption"></a>Scenario 3: asymmetric encryption</h2><p>To solve the problem in scenario 2, we need to think of a way to protect the key from being stolen while transferring to remote side.<br>Here we introduce <strong>asymmetric encryption algorithm</strong>. Asymmetric encryption use a private&#x2F;public key pair, instead of one key to encrypt and decrypt data. You can either choose to use private key to encrypt and public key to decrypt or vice versa. In our case, A&#x2F;B firstly generate their only private&#x2F;public key-pair. Then encrypt the data using their private key and exchange the public key with others.<br>Data are decrypted by the corresponding public key.</p>
<p>The problem of asymmetric algorithm is that it has a huge compute complexity so using this method to encrypt  large data is time costing.<br>To mitigate the issue, we use asymmetric algorithm to encrypt&#x2F;decrypt the symmetric key only. The data is still encrypted by symmetric key. Then the key itself is encrypted by private key of sender. Receiver received the encrypted symmetric key and the public key of sender, it uses the public key to decrypt the symmetric key, and use this key to decrypt the data. In this case, even if hacker get the public key, he cannot decrypt the encrypted symmetric key, thus not able to stole the data.<br><img src="https://s2.loli.net/2024/07/18/mQ7xhypnv9uMS4I.png" alt="Scenario 3, by using asymmetric and symmetric encryption, data are now secured"></p>
<p>But hacker doesn’t give up, in fact he still has some way to stole the data. Actually the method of exchanging public keys between each other, will cause source verification issue. That’s what I mentioned in the first place. In other word, neither A nor B can figure out whether he is exchanging keys with proper peer. Hacker could be playing A or B, and we don’t have a way to identify then. Also, we are not sure whether data is not tampered during transportation or not. Let’s look two attack pattern below.</p>
<p>In first pattern, hacker is playing A and exchanging key with B, B actually received public key from hacker, but hacker claims the key is actually from A, B cannot verify it.</p>
<p><img src="https://s2.loli.net/2024/07/18/KvucmGXQnyFtji8.png" alt="Attack pattern 1. Hacker is playing role as A and send malicious data"></p>
<p>In second pattern, hacker is playing B and exchanging key with A. A cannot verify whether the incoming public key is from B or others. By encrypting the data using the unknown public key, it is actually sending data to hacker.<br><img src="https://s2.loli.net/2024/07/18/oITn98uUgYlOft1.png" alt="Attack pattern 2. Hacker is staling data from A by playing role as B"></p>
<h2 id="Scenario-4-digital-signature"><a href="#Scenario-4-digital-signature" class="headerlink" title="Scenario 4: digital signature"></a>Scenario 4: digital signature</h2><p>So how we fix this issue? You see, in real world, we use signature to<br>identify the source of executer. You cannot deny what you have done with signature as evidence. We can use same method to identify the sender in our case, by using method so-called digital signature. To verify the source of sender, sender uses his private key to encrypt the hash of his data, hash of the data is called digest, and encrypted hash is called signature. Sender and receiver exchanges public key, then perform Data encryption and symmetric key encryption, when sender sends his encrypted data and key, he also sends a signature in which contains the hash result of the data encrypted by his private key. Receiver then do the same thing, decrypt data and symmetric key, but also decrypt the signature and compare with the hash between the sent data digest and signature digest.<br><img src="https://s2.loli.net/2024/07/18/kdZbijFreGV7BgI.png" alt="A uses his private key to do digital signature"></p>
<p><img src="https://s2.loli.net/2024/07/18/EHZzMIxsUWX6tuL.png" alt="A send his digital signature to prove the data is sent to B not by others and data is not alternated"></p>
<p>However, still one problem exists.. Since there is no way to verify the identity of key owner, everyone can claim they are the correct sender.. Signature can make sure data is not alternated while transporting. But every can claim that they are A using their own signature. </p>
<p>In real world, every one’s identity is proven by your government or a third party authority that everyone can believe into. Here we introduce a concept called CA (centralized authority) to deal with the identity problem. CA acts as a trusted third-party to help validate and verify the identity of each senders&#x2F;receivers.<br>CA uses his private key to create digest and prepare the certificate for each public key of end user. The certificate has specific format. But in general, it contains public key of the end-user, valid data and digital signature of CA.<br>Certificate is verified by CA’s public key, if the digest matches, then senders’ identity are verified.</p>
<p><img src="https://s2.loli.net/2024/07/18/cKhp8g7CRjeBrLA.png" alt="A here send a CSR(certificate sign request) to CA, CA signs this CSR using its private key. A can now use his signed certificate to identify himself."></p>
<p>However, how to verify CA is trusted? Not signed by anyone else? Actually everyone can setup its own CA and sign for himself. To prevent it, CA will self-sign a root certificate, and install on each users. Users use CA’s public key to verify the identity of CA.<br><img src="https://s2.loli.net/2024/07/18/wnUILl3hHWcZFiX.png" alt="CA also need to be trusted."></p>
<p><img src="https://s2.loli.net/2024/07/18/T5R7HOtiSdYIKFl.png" alt="Generally, CA sign its own public key. And installed on end-users. For example, every PC would install CA cert when it was manufactured. CA cert is decrypted by CA public key"></p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>To establish a secured connection between A and B,<br>in which A’s identity is verified by B and B’s identity is verified by A. On A and B there should be these files existing below.<br><img src="https://s2.loli.net/2024/07/18/lRpKxEeHkhTUsr7.png" alt="A/B need to install CA cert, then they exchange their certificates."></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2024/07/18/PKI-and-encryption-explained-step-by-step/" data-id="cmkzmweor000hl4ur6hedgmmn" data-title="PKI and encryption explained step by step" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/PKI-encryption-TLS/" rel="tag">PKI, encryption, TLS</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-linux-FS-and-pkg" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2024/02/21/linux-FS-and-pkg/" class="article-date">
  <time class="dt-published" datetime="2024-02-21T05:38:04.000Z" itemprop="datePublished">2024-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/Learning/">Learning</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/02/21/linux-FS-and-pkg/">linux FS and pkg</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Linux-filesystem-and-package-management"><a href="#Linux-filesystem-and-package-management" class="headerlink" title="Linux filesystem and package management"></a>Linux filesystem and package management</h1><h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><ol>
<li><a href="#filesystems">Filesystems</a></li>
<li><a href="#packages-and-applications">Package and apps</a></li>
</ol>
<h2 id="Filesystems"><a href="#Filesystems" class="headerlink" title="Filesystems"></a>Filesystems</h2><p>Some concept in filesystems are:</p>
<ul>
<li><p>Drive: A physical block device such as HDD or SSD. <strong>In virtual machines, drive can be emulated</strong>. <code>/dev/sda (SCSI device)</code> <code>/dev/sdb (SATA)</code> or <code>/dev/hda (IDE)</code></p>
</li>
<li><p>Partition: Divide physical disks into partitions, logical sub-disks</p>
</li>
<li><p>Volume: special partition with more flexibility </p>
</li>
<li><p>Super block: A special section that contains metadata of the filesystem such as fs type, blocks, state..</p>
</li>
<li><p>Inodes: Inodes store metadata about files such as size, owner, location, data and permissions. It does not store file name and actual data</p>
</li>
</ul>
<p>Use <code> lsblk</code> to list the block devices</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    lsblk --exclude 7</span><br><span class="line">NAME  MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda     8:0    0 389.8M  1 disk</span><br><span class="line">sdb     8:16   0     3G  0 disk [SWAP]</span><br><span class="line">sdc     8:32   0     1T  0 disk /var/lib/docker</span><br><span class="line">                                /var/snap/firefox/common/host-hunspell</span><br><span class="line">                                /snap</span><br><span class="line">                                /mnt/wslg/distro</span><br><span class="line">                                /</span><br></pre></td></tr></table></figure>

<p>Use <code> findmnt</code> to list filesystems</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">findmnt -D -t nosquashfs <span class="comment"># exclude squashfs type files(used for snapshots)</span></span><br></pre></td></tr></table></figure>

<h3 id="Hard-link-and-symbolic-links"><a href="#Hard-link-and-symbolic-links" class="headerlink" title="Hard link and symbolic links"></a>Hard link and symbolic links</h3><p> A hard link works by creating another filename that refers to the inode data of the original file. In practice, this is similar to creating a copy of the file.</p>
<ul>
<li><p>If the original file is deleted, the file data can still be accessed through other hard links.</p>
</li>
<li><p>If the original file is moved, hard links still work.</p>
</li>
<li><p>A hard link can only refer to a file on the same file system.</p>
</li>
<li><p>The inode and file data are permanently deleted when the number of hard links is zero</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> myfile somealias</span><br></pre></td></tr></table></figure>
<p>A soft link, sometimes called a symbolic link or symlink, points to the location or path of the original file. It works like a hyperlink on the internet.</p>
<ul>
<li><p>If the symbolic link file is deleted, the original data remains.</p>
</li>
<li><p>If the original file is moved or deleted, the symbolic link won’t work.</p>
</li>
<li><p>A soft link can refer to a file on a different file system.</p>
</li>
<li><p>Soft links are often used to quickly access a frequently-used file without typing the whole location.</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s myfile somealias</span><br></pre></td></tr></table></figure>
<p>Differences between hard link and symbolic link</p>
<ul>
<li><p>A soft link does not contain the data in the target file.</p>
</li>
<li><p>A soft link points to another entry somewhere in the file system.</p>
</li>
<li><p>A soft link has the ability to link to directories, or to files on remote computers networked through NFS.</p>
</li>
<li><p>Deleting a target file for a symbolic link makes that link useless.</p>
</li>
<li><p>A hard link preserves the contents of the file.</p>
</li>
<li><p>A hard link cannot be created for directories, and they cannot cross filesystem boundaries or span across partitions.</p>
</li>
<li><p>In a hard link, you can use any of the hard link names created to execute a program or script in the same manner as the original name given.</p>
</li>
</ul>
<h3 id="VFS-virtual-file-system"><a href="#VFS-virtual-file-system" class="headerlink" title="VFS (virtual file system)"></a>VFS (virtual file system)</h3><p>Abstraction layer in the kernel that provides clients a common way to access resources.<br>Using VFS user can access to resource like local filesystems, in-memory filesystems(memory), pseudo filesystems or network filesystems and treat them as simple file.<br>[<a target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/next/filesystems/vfs.html]">https://www.kernel.org/doc/html/next/filesystems/vfs.html]</a></p>
<h3 id="Creating-filesystems"><a href="#Creating-filesystems" class="headerlink" title="Creating filesystems"></a>Creating filesystems</h3><p>To creating filesystems, first step is to create filesystem (similar to partition)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs -t ext4 /dev/some_vg/some_lv <span class="comment"># some volume group and logical volume</span></span><br></pre></td></tr></table></figure>
<p>Then, you need to mount it to the root filesystem tree</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ext4, tmpfs <span class="comment"># check mount status for ext4 tmpfs file system types</span></span><br></pre></td></tr></table></figure>

<p><code>Mounts is avaliable as long as the system is running, to mount permanentlly you need to use the fstab file.</code></p>
<h3 id="procfs-sysfs-and-devfs"><a href="#procfs-sysfs-and-devfs" class="headerlink" title="procfs sysfs and devfs"></a>procfs sysfs and devfs</h3><ul>
<li><p>proc filesystem contains process-related infor from the kernel.<br>users can view at <code>/proc/PID/</code></p>
</li>
<li><p>sysfs is located in <code>/sys</code> contains kernal information to exposed select information.</p>
</li>
<li><p>devfs contains device files, random data generator is also included.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tr</span> -dc A-Za-z0-9 &lt; /dev/urandowm | <span class="built_in">head</span> -c 42</span><br></pre></td></tr></table></figure>
</li>
<li><p>common filesystem is format for filesystems. Check link below for more details. <a target="_blank" rel="noopener" href="https://hyperskill.org/learn/step/34977">https://hyperskill.org/learn/step/34977</a></p>
</li>
</ul>
<h2 id="Packages-and-applications"><a href="#Packages-and-applications" class="headerlink" title="Packages and applications"></a>Packages and applications</h2><h3 id="Terminology-explanations"><a href="#Terminology-explanations" class="headerlink" title="Terminology explanations"></a>Terminology explanations</h3><ul>
<li>Program: binary file or executable. Code to run something.</li>
<li>Process: A running entity based on a program loaded into main memory and either using CPU or I&#x2F;O when not sleeping</li>
<li>Daemon: or called service, a background process that provides function to other processes. For example: daemons for web service, logging time …</li>
<li>Application: program including its dependencies. A combination of multiple programs. </li>
<li>Package: A file that contains programs and configs, used to distribute software applications</li>
<li>Package manager: A program that takes a package as an input, and based on its content and user instruction to install it upgrades it or removes it</li>
</ul>
<h4 id="Boot-process"><a href="#Boot-process" class="headerlink" title="Boot process"></a>Boot process</h4><p>PWR on —&gt; UEFI or BIOS —&gt; Boot loader —&gt; Kernel —&gt; Init —&gt; Other user interface</p>
<ol>
<li>UEFI or BIOS init hardware and boot basic configuration, then handle over to boot loader</li>
<li>Boot loader starts kernel</li>
<li>kernel are loaded from &#x2F;boot to main memory</li>
<li>Init system is responsible for launching daemons</li>
</ol>
<h3 id="Systemd-initializer"><a href="#Systemd-initializer" class="headerlink" title="Systemd initializer"></a>Systemd initializer</h3><p>If we want to set an application as service, we can define .service file and put them into <code>/run/systemd/system/</code></p>
<ul>
<li>User <code>journalctl</code> command, you can see systemctl-managed service logs.</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2024/02/21/linux-FS-and-pkg/" data-id="cmkzmweou000ul4uratj9bd4q" data-title="linux FS and pkg" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Linux/" rel="tag">Linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Deploy-free5GC-with-k8s-and-helm" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/10/23/Deploy-free5GC-with-k8s-and-helm/" class="article-date">
  <time class="dt-published" datetime="2023-10-23T06:32:30.000Z" itemprop="datePublished">2023-10-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/DIY-and-lab/">DIY and lab</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/10/23/Deploy-free5GC-with-k8s-and-helm/">Deploy free5GC with k8s and helm</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Install-free5gc-on-personal-pcs-using-k8s-and-helm"><a href="#Install-free5gc-on-personal-pcs-using-k8s-and-helm" class="headerlink" title="Install free5gc on personal pcs using k8s and helm"></a>Install free5gc on personal pcs using k8s and helm</h1><h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Very trivial and simple try to install and run free5gc on my personal PC by using Free5GC with Kubernetes, helm, calico and multus.</p>
<p>For the first step, I was planning to install free5gc<br>on one cluster and test it using UERANSIM.</p>
<p>As for next step I plan to deploy free5gc on multiple nodes environments in which master and worker node are separated. Also planning to deploy on openstack environment or AWS.</p>
<h2 id="Prepare"><a href="#Prepare" class="headerlink" title="Prepare"></a>Prepare</h2><p>I was using vmware workstation and deployed ubuntu 20.6 image on it. Memory was set to around 10G to make sure calico works ok.</p>
<p><img src="https://s2.loli.net/2023/10/26/VRX3ncqWjINhxzY.png" alt="VM info"></p>
<p>After ubuntu is up, do the install and update packages first.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:~$ sudo apt update -y</span><br><span class="line">:~$ sudo apt upgrade -y</span><br><span class="line">:~$ sudo apt install -y curl wget apt-transport-https</span><br></pre></td></tr></table></figure>

<p>Then install and start up minikube, minikube enables user to set up kubernetes cluster on the system.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">:~$ wget https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</span><br><span class="line">:~$ sudo <span class="built_in">cp</span> minikube-linux-amd64 /usr/local/bin/minikube</span><br><span class="line">:~$ sudo <span class="built_in">chmod</span> +x /usr/local/bin/minikube</span><br><span class="line"><span class="comment"># use calico as cni(container network interface) plugin </span></span><br><span class="line">:~$ minikube start --driver=docker --cpus=4 --memory=8g --disk-size=20g --cni=calico</span><br><span class="line"></span><br><span class="line">:~$ minikube status</span><br><span class="line"></span><br><span class="line">    minikube</span><br><span class="line">    <span class="built_in">type</span>: Control Plane</span><br><span class="line">    host: Running</span><br><span class="line">    kubelet: Running</span><br><span class="line">    apiserver: Running</span><br><span class="line">    kubeconfig: Configured</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2023/10/26/gJeHqMjoGhIONCR.png" alt="minikube status"></p>
<p>After minikube was installed, install kubectl for better experience. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">:~$ curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl</span><br><span class="line"><span class="comment"># If exeucte the command directly, it may have warning regard to minikube and kubectl version mismatch. To avoid this, you can designate version of kubectl to match with minikube</span></span><br><span class="line">:~$ curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.26.3/bin/linux/amd64/kubectl</span><br><span class="line">:~$ <span class="built_in">chmod</span> +x kubectl</span><br><span class="line">:~$ sudo <span class="built_in">mv</span> kubectl /usr/local/bin/</span><br><span class="line">:~$ kubectl version -o yaml</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2023/10/26/HkLGdtBNwoVfFCc.png" alt="Installed kubectl"></p>
<p>Then for the last step of preparation, we need to install helm and multus-CNI plugin to enable multiple interface support for pods.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">:~$ curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3</span><br><span class="line">:~$ <span class="built_in">chmod</span> 700 get_helm.sh</span><br><span class="line">:~$ ./get_helm.sh</span><br><span class="line">:~$ helm list -A</span><br><span class="line">:~$ git <span class="built_in">clone</span> https://github.com/k8snetworkplumbingwg/multus-cni.git</span><br><span class="line">:~$ <span class="built_in">cd</span> multus-cni</span><br><span class="line">:~$ <span class="built_in">cat</span> ./deployments/multus-daemonset-thick.yml | kubectl apply -f -</span><br><span class="line">:~$ kubectl get pods -n kube-system</span><br></pre></td></tr></table></figure>

<p>For me I had multus pods oom killed, so I modified the request and limit resource in the multus-daemonset-thick.yml then pod went up fine.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kube-multus</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/k8snetworkplumbingwg/multus-cni:snapshot-thick</span></span><br><span class="line">    <span class="attr">command:</span> [ <span class="string">&quot;/usr/src/multus-cni/bin/multus-daemon&quot;</span> ]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;50Mi&quot;</span> <span class="string">--&gt;</span> <span class="string">&quot;250Mi&quot;</span></span><br><span class="line">      <span class="attr">limits:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;50Mi&quot;</span> <span class="string">--&gt;</span> <span class="string">&quot;350Mi&quot;</span></span><br><span class="line">    <span class="attr">securityContext:</span></span><br><span class="line">      <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni</span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/host/etc/cni/net.d</span></span><br></pre></td></tr></table></figure>

<h2 id="Free5gc-install"><a href="#Free5gc-install" class="headerlink" title="Free5gc install"></a>Free5gc install</h2><p>Main step of installing 5gc is to use helm to pull repository from free5gc git, then install the helm chart.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create namespace </span></span><br><span class="line">:~$ kubectl create namespace free5gc</span><br><span class="line"><span class="comment"># add helm repository</span></span><br><span class="line">:~$ helm repo add towards5gs <span class="string">&#x27;https://raw.githubusercontent.com/Orange-OpenSource/towards5gs-helm/main/repo/&#x27;</span></span><br><span class="line">:~$ helm repo update</span><br><span class="line">:~$ helm repo list</span><br><span class="line">:~$ helm search repo</span><br></pre></td></tr></table></figure>


<p><img src="https://s2.loli.net/2023/10/26/oF6m4k1uTtsqc3d.png" alt="Helm install"></p>
<p>After checking the helm repository, it is ok to procced with installing free5gc.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">:~$ helm -n free5gc install free5gc towards5gs/free5gc</span><br><span class="line">:~$ kubectl get pods -n free5gc</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><img src="https://s2.loli.net/2023/10/26/qcLoV1daCsj8TSR.png" alt="pod install complete"></p>
<p><strong>Upf pod cannot set up and will stuck in creating state because multus cannot add eth1 to this pod.</strong></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Orange-OpenSource/towards5gs-helm">towards5gs-helm-github</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/rahasak/deploying-5g-core-network-with-free5gc-kubernets-and-helm-charts-29741cea3922">Deploying 5G core network with Free5GC, Kubernetes and Helm</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/rahasak/deploying-5g-core-network-with-free5gc-kubernets-and-helm-charts-29741cea3922">Kubernetes環境でfree 5GCを動かすまで</a> </li>
<li><a target="_blank" rel="noopener" href="https://qiita.com/wzm/items/0dbe928ed891d82380d6">kubernetes cluster上にfree5gcを構築してみる</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2023/10/23/Deploy-free5GC-with-k8s-and-helm/" data-id="cmkzmweoj0001l4ur32li8es0" data-title="Deploy free5GC with k8s and helm" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/k8s-helm/" rel="tag">k8s, helm</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Cloud-native-and-its-implementation-in-Telco" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/08/24/Cloud-native-and-its-implementation-in-Telco/" class="article-date">
  <time class="dt-published" datetime="2023-08-24T04:48:22.000Z" itemprop="datePublished">2023-08-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/Learning/">Learning</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/08/24/Cloud-native-and-its-implementation-in-Telco/">Cloud native and its implementation in Telco</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Cloud-native-in-telecom"><a href="#Cloud-native-in-telecom" class="headerlink" title="Cloud native in telecom"></a>Cloud native in telecom</h1><p><strong>Right now it is unclear what is the concept of Cloud Native and what is its implementations, so main goal of this blog is to simply introduce the basic concept and how Cloud Native is composed.</strong></p>
<h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><ol>
<li><a href="#what-is-cloud-native">What is Cloud Native？</a></li>
<li><a href="#basic-principles-and-conponents-of-cloud-native">Basic principles and components of Cloud Native</a></li>
<li><a href="#Cloud-Native-design-principles">Cloud Native design principles</a><ol>
<li><a href="#agnosticism">Agnosticism</a></li>
<li><a href="#software-decomposition-and-life-cycle-management">Software decomposition and Life Cycle Management</a></li>
</ol>
</li>
<li><a href="#qas">Some Q&amp;As</a></li>
</ol>
<h2 id="What-is-Cloud-Native？"><a href="#What-is-Cloud-Native？" class="headerlink" title="What is Cloud Native？"></a>What is Cloud Native？</h2><p>Cloud native is not a particular product or technology. Instead, it’s a principle, a business pattern. Cloud Native is a term that describes the patterns of organizations, architectures and technologies that consistently, reliably and at scale fully takes advantage of the possibilities of the cloud to support cloud-oriented business models. It is the combination of different kinds of best practices.Enterprise and developers use technologies based on Cloud Native such as CI&#x2F;CD, container and microservices to achieve high availability, high reliability scalability and lower Time To Market and delivery.</p>
<h2 id="Basic-principles-and-components-of-Cloud-Native"><a href="#Basic-principles-and-components-of-Cloud-Native" class="headerlink" title="Basic principles and components of Cloud Native"></a>Basic principles and components of Cloud Native</h2><p>What can Cloud Native bring us?</p>
<ul>
<li>Speed: Fast introduction of new services</li>
<li>Scale: Easily expand from hundreds of users to millions</li>
<li>Performance: Optimized capacity throughput and resource utilization</li>
<li>Efficiency : Low cost for both Speed and Scale. Automation, zero-touch operations, legacy and new services, life-cycle independence for both Services and<br>Infrastructure</li>
</ul>
<p>Therefore, target of Cloud Native is to achieve higher TTM(Time to) and lower TCO(Total Cost of Ownership) without sacrificing service reliability and performance. Let’s see what are the basic components of Cloud Native.</p>
<ul>
<li>Cloud Native Applications</li>
<li>Microservice</li>
<li>APIs</li>
<li>Containers and container orchestration</li>
<li>Other automating tools</li>
<li>Cloud native friendly infrastructures(Public clouds，private clouds，mixture clouds)</li>
</ul>
<p>Like I mentioned earlier, cloud native doesn’t only contain technologies, but also idea and behavior patterns. Let’s see what needs to be considered in mind about cloud native.</p>
<ul>
<li>CI&#x2F;CD (Continuous delivery and continuous integration)</li>
<li>Highly automated (includes CI&#x2F;CD，along with auto monitoring，data handling and analysis with ability to anomaly detection)</li>
<li>Embrace actively to open source and collaboration with CNCF (cloud native computing foundation): CNCF is an open source Cloud Native organization, it is responsible to develop and maintain crucial parts close related to Cloud Native. Please refer to their <a target="_blank" rel="noopener" href="https://www.cncf.io/">website</a>.</li>
</ul>
<p>To sum-up, a company need to achieve the following to completely take the advantage of cloud native.</p>
<ol>
<li>Posses complete infrastructure and environments for cloud native applications</li>
<li>Have the ideal of automation on duplicated process</li>
<li>Contribute to open source society, continuous delivery of value to the user</li>
</ol>
<p><img src="https://s2.loli.net/2023/09/14/2uHknclWej18IiB.png" alt="Cloud native requires both infrastructure and development patterns to reach the target."></p>
<h2 id="Cloud-Native-design-principles"><a href="#Cloud-Native-design-principles" class="headerlink" title="Cloud Native design principles"></a>Cloud Native design principles</h2><p>Let’s talk about the design principles of cloud native application. Since it is one of the most important parts in the whole could native concept and it is rather new in the industry.  Graph below describes the basic principles need to considered before deploying and designing cloud native applications.</p>
<p><img src="https://s2.loli.net/2024/02/21/s6AUd5MEwOl9IDV.png" alt="Cloud Native Application Design Principles"></p>
<h3 id="Agnosticism"><a href="#Agnosticism" class="headerlink" title="Agnosticism"></a>Agnosticism</h3><p>Cloud native applications need to to be agnostic to the underlying cloud infrastructure. Although this does not necessarily apply to the traditional Cloud Native players like Netflix and Uber since they control the full stack that they are deploying their application on.<br>As we evolve the cloud infrastructure towards supporting container infrastructure (CaaS) the agnosticism requirements remain but the challenges are different. A CNA requires a CaaS and must be able to be deployed on whatever CaaS and IaaS combination that an operator has in their cloud environment, see figure below for CNA agnosticism scenario. A CNA must be able to run on any modern kernel without requiring any proprietary additions. Optional use of plug-ins for optimizing performance is allowed.</p>
<p><img src="https://s2.loli.net/2023/10/18/ctJGAWqylKeRxuz.png" alt="Agnosticism explained"></p>
<h3 id="Software-decomposition-and-Life-Cycle-Management"><a href="#Software-decomposition-and-Life-Cycle-Management" class="headerlink" title="Software decomposition and Life Cycle Management"></a>Software decomposition and Life Cycle Management</h3><p>Another important principle is for CNA itself, which requires CNA to be decomposed into smaller, more manageable pieces. This is usually done through utilizing a microservice architecture (MSA). MSA is a design pattern that strives to structure an application as a collection of loosely coupled stateless services.<br><img src="https://s2.loli.net/2023/10/23/KhxQlkCBGo7WI9z.png" alt="Microservice architecture"><br>This concept is not new in only for cloud native, dividing code into more manageable pieces and call them “code modules” or “software components” has always been a good practice in software development. However, in cloud native realm, those software components, AKA microservices, now have a well bounded scope and can be individually deploys, scaled and upgrade using CaaS environment. In addition, microservices have their own defines and version-controlled network-based interfaces to communicate with each other, which enables the lifecycle management for each microservice.</p>
<h4 id="Scaling"><a href="#Scaling" class="headerlink" title="Scaling"></a>Scaling</h4><h4 id="Upgrade"><a href="#Upgrade" class="headerlink" title="Upgrade"></a>Upgrade</h4><h2 id="Q-amp-As"><a href="#Q-amp-As" class="headerlink" title="Q&amp;As"></a>Q&amp;As</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2023/08/24/Cloud-native-and-its-implementation-in-Telco/" data-id="cmkzmweog0000l4urf2yr24sp" data-title="Cloud native and its implementation in Telco" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Cloud-native/" rel="tag">Cloud native</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-k8s-templates" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/06/05/k8s-templates/" class="article-date">
  <time class="dt-published" datetime="2023-06-05T09:07:29.000Z" itemprop="datePublished">2023-06-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/06/05/k8s-templates/">k8s templates</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Config-templates-for-K8s"><a href="#Config-templates-for-K8s" class="headerlink" title="Config templates for K8s"></a>Config templates for K8s</h1><h3 id="YAML-description-file-for-pods"><a href="#YAML-description-file-for-pods" class="headerlink" title="YAML description file for pods"></a>YAML description file for pods</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span> </span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cmd</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;args&quot;</span></span><br><span class="line">    <span class="comment"># or </span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;somecommand&quot;</span>]</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="attr">args:</span> [<span class="string">&quot;some_args&quot;</span>]</span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">initContainers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sth</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">sth</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sidecar</span>  </span><br><span class="line">    <span class="attr">image:</span> <span class="string">sidecar_image</span></span><br></pre></td></tr></table></figure>

<p>ENV VAR for pods</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ENV_VAR_NAME</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">ENV_VAR_VALUE</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="Template-for-configmap"><a href="#Template-for-configmap" class="headerlink" title="Template for configmap"></a>Template for configmap</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">  <span class="attr">name:</span> <span class="string">&lt;ConfigMap_Name&gt;</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="string">&lt;key_name&gt;:</span> <span class="string">&lt;value_name&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Template-for-secret"><a href="#Template-for-secret" class="headerlink" title="Template for secret"></a>Template for secret</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># need to convert k-v data into coded form</span></span><br><span class="line"><span class="comment"># echo -n &#x27;&lt;plain_text&gt;&#x27; | base64</span></span><br><span class="line"><span class="comment"># echo -n &#x27;&lt;secret_text&gt;&#x27; | base64 --decode</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">  <span class="attr">name:</span> <span class="string">&lt;secret_Name&gt;</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="string">&lt;key_name&gt;:</span> <span class="string">&lt;value_name&gt;</span></span><br><span class="line">  <span class="string">&lt;key_name_1&gt;:</span> <span class="string">&lt;Pwd_1&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Inject-configmap-and-secrets-to-pods"><a href="#Inject-configmap-and-secrets-to-pods" class="headerlink" title="Inject configmap and secrets to pods"></a>Inject configmap and secrets to pods</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span></span><br><span class="line">    <span class="attr">image:</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> </span><br><span class="line">    <span class="attr">envFrom:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">configMapRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">&lt;config_map_name&gt;</span></span><br><span class="line">        <span class="attr">secretRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">&lt;secret_name&gt;</span></span><br><span class="line">  </span><br><span class="line">      </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">env:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span></span><br><span class="line">    <span class="attr">valueFrom:</span></span><br><span class="line">      <span class="attr">configMapKeyRef:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&lt;config_map_name&gt;</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">&lt;some_keys_of_cmap&gt;</span></span><br><span class="line">      <span class="attr">secretKeyRef:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&lt;secret_name&gt;</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">&lt;some_keys&gt;</span></span><br><span class="line">      </span><br></pre></td></tr></table></figure>




<h3 id="YAML-description-file-for-replication-sets"><a href="#YAML-description-file-for-replication-sets" class="headerlink" title="YAML description file for replication-sets"></a>YAML description file for replication-sets</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>  <span class="comment"># error: unable to recognize &quot;filename.yml&quot;: no matches for /, kind=ReplicaSet appears if apiVersion was set to v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicaSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myrs</span></span><br><span class="line">  <span class="attr">namespace:</span> [<span class="string">ns</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">	    <span class="attr">labels:</span> </span><br><span class="line">	      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">		    <span class="attr">type:</span> <span class="string">front-end</span></span><br><span class="line">	  <span class="attr">spec:</span></span><br><span class="line">	    <span class="attr">containers:</span></span><br><span class="line">	    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-containers</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span> </span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">front-end</span></span><br></pre></td></tr></table></figure>

<h3 id="YAML-description-file-for-deployments"><a href="#YAML-description-file-for-deployments" class="headerlink" title="YAML description file for deployments"></a>YAML description file for deployments</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my_deploy</span></span><br><span class="line">  <span class="attr">namespace:</span> [<span class="string">ns</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="string">metadata:[]</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">	    <span class="attr">labels:</span> </span><br><span class="line">	      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">		    <span class="attr">type:</span> <span class="string">front-end</span></span><br><span class="line">	  <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">securityContext:</span> <span class="comment"># also can be put under &quot;containers&quot; to choose appling context in pod or container scope</span></span><br><span class="line">        <span class="attr">runAsUser:</span> <span class="number">1000</span> <span class="comment"># define what user to run in the pod</span></span><br><span class="line">        <span class="attr">capabilities:</span></span><br><span class="line">          <span class="attr">add:</span> [<span class="string">&quot;MAC_ADMIN&quot;</span>]</span><br><span class="line">	    <span class="attr">containers:</span></span><br><span class="line">	    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dockerhub_url/nginx-containers</span></span><br><span class="line">		    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">imagePullSecrets:</span> <span class="comment"># image security, docker hub username/pwd secret object</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&lt;docker-registry-secret-name&gt;</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">front-end</span></span><br></pre></td></tr></table></figure>

<h3 id="YAML-description-file-for-DaemonSet"><a href="#YAML-description-file-for-DaemonSet" class="headerlink" title="YAML description file for DaemonSet"></a>YAML description file for DaemonSet</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVsesion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myrs</span></span><br><span class="line">  <span class="attr">namespace:</span> [<span class="string">ns</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">	    <span class="attr">labels:</span> </span><br><span class="line">	      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">		    <span class="attr">type:</span> <span class="string">front-end</span></span><br><span class="line">	  <span class="attr">spec:</span></span><br><span class="line">	    <span class="attr">containers:</span></span><br><span class="line">	    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">monitoring-agent</span></span><br><span class="line">		    <span class="attr">image:</span> <span class="string">monitoring-agent</span></span><br><span class="line">  <span class="attr">selector:</span> </span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">front-end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="YAML-description-file-for-Services"><a href="#YAML-description-file-for-Services" class="headerlink" title="YAML description file for Services"></a>YAML description file for Services</h3><ul>
<li>Nodeport</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVsersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp-service</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span> <span class="comment"># type of service</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targetPort:</span> <span class="number">80</span> <span class="comment"># port want to access on the pod</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span> <span class="comment"># mapping port on service</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30008</span> <span class="comment"># port expose to outside</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment"># links the service to the pod by pod labels</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">	  <span class="attr">type:</span> <span class="string">front-end</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Clusterip</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVsersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">back-end</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span> <span class="comment"># type of service</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targetPort:</span> <span class="number">80</span> <span class="comment"># port exposed from backends</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span> <span class="comment"># mapping port from service</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment"># links the service to the pod by pod labels</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">	  <span class="attr">type:</span> <span class="string">front-end</span></span><br></pre></td></tr></table></figure>


<h3 id="YAML-description-file-for-NameSpace"><a href="#YAML-description-file-for-NameSpace" class="headerlink" title="YAML description file for NameSpace"></a>YAML description file for NameSpace</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>

<h3 id="YAML-description-file-for-NameSpace-quota"><a href="#YAML-description-file-for-NameSpace-quota" class="headerlink" title="YAML description file for NameSpace quota"></a>YAML description file for NameSpace quota</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ResourceQuota</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">compute-quota</span></span><br><span class="line">  <span class="attr">namespace:</span> [<span class="string">ns_name</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hard:</span></span><br><span class="line">    <span class="attr">pods:</span> <span class="string">&quot;10&quot;</span></span><br><span class="line">    <span class="attr">requests.cpu:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line">    <span class="attr">requests.memory:</span> <span class="string">5Gi</span></span><br><span class="line">    <span class="attr">limits.cpu:</span> <span class="string">&quot;10&quot;</span></span><br><span class="line">    <span class="attr">limits.memory:</span> <span class="string">10Gi</span></span><br></pre></td></tr></table></figure>

<h3 id="Limit-range-for-resource-management"><a href="#Limit-range-for-resource-management" class="headerlink" title="Limit range for resource management"></a>Limit range for resource management</h3><p><strong>only affect on creation</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">LimitRange</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> [<span class="string">name</span>]</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">limits:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">default:</span></span><br><span class="line">      <span class="attr">cpu:</span></span><br><span class="line">    <span class="attr">defaultRequest:</span></span><br><span class="line">      <span class="attr">cpu:</span> </span><br><span class="line">    <span class="attr">max:</span></span><br><span class="line">      <span class="attr">cpu:</span></span><br><span class="line">    <span class="attr">min:</span></span><br><span class="line">      <span class="attr">cpu:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Container</span>  </span><br></pre></td></tr></table></figure>


<h3 id="Allocate-pods-to-deploy-on-modified-scheduler"><a href="#Allocate-pods-to-deploy-on-modified-scheduler" class="headerlink" title="Allocate pods to deploy on modified scheduler"></a>Allocate pods to deploy on modified scheduler</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># on pod definition file</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedulerName:</span> <span class="string">&lt;scheduler-name&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Allocate-the-priority-to-be-scheduled-in-the-queue"><a href="#Allocate-the-priority-to-be-scheduled-in-the-queue" class="headerlink" title="Allocate the priority to be scheduled in the queue"></a>Allocate the priority to be scheduled in the queue</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">priorityClassName:</span> <span class="string">high-priority</span></span><br></pre></td></tr></table></figure>

<h3 id="description-file-for-CSR"><a href="#description-file-for-CSR" class="headerlink" title="description file for CSR"></a>description file for CSR</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">certificates.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CertificateSigningRequest</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">somename</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">expirationSeconds:</span> <span class="number">600</span></span><br><span class="line">  <span class="attr">usages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">digital</span> <span class="string">signature</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">key</span> <span class="string">encipherment</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">server</span> <span class="string">auth</span></span><br><span class="line">  <span class="attr">request:</span> <span class="string">&lt;BASE64_encoded</span> <span class="string">CSR_info&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Definition-file-for-kubeconfig"><a href="#Definition-file-for-kubeconfig" class="headerlink" title="Definition file for kubeconfig"></a>Definition file for kubeconfig</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">clusters:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">cluster:</span></span><br><span class="line">    <span class="attr">certificate-authority:</span> <span class="string">/path_to_ca_crt</span></span><br><span class="line">    <span class="comment"># or</span></span><br><span class="line">    <span class="attr">certificate-authority-data:</span> <span class="string">&lt;base64&gt;</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">https://controlplane:6443</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes</span></span><br><span class="line"></span><br><span class="line"><span class="attr">contexts:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">context:</span></span><br><span class="line">    <span class="attr">cluster:</span> <span class="string">kubernetes</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">kubernetes-admin</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-admin@kubernetes</span></span><br><span class="line"><span class="attr">current-context:</span> <span class="string">kubernetes-admin@kubernetes</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Config</span></span><br><span class="line"><span class="attr">preferences:</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">users:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubernetes-admin</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">client-certificate-data:</span> <span class="string">&lt;base64&gt;</span></span><br><span class="line">    <span class="attr">client-key-data:</span> <span class="string">&lt;base64&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="role-definition-file"><a href="#role-definition-file" class="headerlink" title="role definition file"></a>role definition file</h3><ul>
<li>namespace-based resource role definition<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">developer</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">&lt;namespace_name&gt;</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;list&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br></pre></td></tr></table></figure></li>
<li>cluster role definition file<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">role_definition_name</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;nodes&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;list&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>]  </span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="link-user-to-role-role-binding-definition"><a href="#link-user-to-role-role-binding-definition" class="headerlink" title="link user to role, role binding definition"></a>link user to role, role binding definition</h3><ul>
<li>namespace-based resource role binding<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">devuser-developer-binding</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev-user</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">developer</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure></li>
<li>cluster role binding</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluter-binding</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-admin</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-administrator</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="network-policy-definition"><a href="#network-policy-definition" class="headerlink" title="network policy definition"></a>network policy definition</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">NetworkPolicy</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-network-policy</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">podSelector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">role:</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">policyTypes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Ingress</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Egress</span></span><br><span class="line">  <span class="attr">ingress:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">from:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">ipBlock:</span></span><br><span class="line">        <span class="attr">cidr:</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line">        <span class="attr">except:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">172.17</span><span class="number">.1</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">namespaceSelector:</span></span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">project:</span> <span class="string">myproject</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">podSelector:</span>  <span class="comment"># or</span></span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">role:</span> <span class="string">frontend</span></span><br><span class="line">    <span class="attr">ports:</span>  <span class="comment"># and </span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">egress:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">to:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">ipBlock:</span></span><br><span class="line">        <span class="attr">cidr:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">5978</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="Storage-definition-files"><a href="#Storage-definition-files" class="headerlink" title="Storage definition files"></a>Storage definition files</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">spec:</span></span><br><span class="line">    <span class="attr">containers:</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">&lt;dir_in_container&gt;</span> <span class="comment"># directory in container which you need to store file</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&lt;volume_name&gt;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&lt;volume_name&gt;</span></span><br><span class="line">      <span class="attr">hostPath:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">&lt;dir_mounted_path&gt;</span> <span class="comment"># path outside container which you need to store data on </span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">Directory</span></span><br><span class="line">      <span class="comment"># or</span></span><br><span class="line">      <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">        <span class="attr">claimName:</span> <span class="string">&lt;pvclaim_name&gt;</span></span><br><span class="line"><span class="comment"># this will cause directory created on every node in multi-node env</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>persistent volume</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv0003</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">5Gi</span></span><br><span class="line">  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Recycle/Retain/Delete</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">slow</span></span><br><span class="line">  <span class="attr">mountOptions:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">hard</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nfsvers=4.1</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/tmp</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># or</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hostPath:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">&lt;dir_local_storage_path&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>persistent volume claim: bind to persistent volume</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myclaim</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span> </span><br><span class="line">  <span class="attr">volumeName:</span> <span class="string">&lt;name_of_volume&gt;</span> <span class="comment"># match what pv you want to bind</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">8Gi</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">slow</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">release:</span> <span class="string">&quot;stable&quot;</span></span><br><span class="line">    <span class="attr">matchExpressions:</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="string">environment</span>, <span class="attr">operator:</span> <span class="string">In</span>, <span class="attr">values:</span> [<span class="string">dev</span>]&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>If a pvc is deleted before the deletion of pod, it will stuck in terminating state.</strong></p>
</li>
<li><p>attach pvc to pod</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mypod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myfrontend</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">&quot;/var/www/html&quot;</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">mypd</span> <span class="comment"># name should match with name under volumes</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mypd</span>  <span class="comment"># should be same with name under volumeMounts</span></span><br><span class="line">      <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">        <span class="attr">claimName:</span> <span class="string">myclaim</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>storage class: allowed for automatically provision volume</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">standard</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">kubernetes.io/example</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">pd-standard</span></span><br><span class="line"><span class="attr">volumeBindingMode:</span> <span class="string">WaitForFirstConsumer</span></span><br><span class="line"><span class="attr">allowedTopologies:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">matchLabelExpressions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">topology.kubernetes.io/zone</span></span><br><span class="line">    <span class="attr">values:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">us-central-1a</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">us-central-1b</span></span><br></pre></td></tr></table></figure>
<p>then update pvc-definition file with:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">&lt;SC_NAME&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>priority class: for pod and resource that want to gain higher priority. Default value is 0. Higher value means higher priority.</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">scheduling.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PriorityClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">high-priority</span></span><br><span class="line"><span class="attr">value:</span> <span class="number">1000000000</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&quot;Mission critical pods&quot;</span></span><br><span class="line"><span class="attr">preemptionPolicy:</span> <span class="string">PreemptLowerPriority(default)/never</span> <span class="comment"># Whether to premmpt lower priority pod or not</span></span><br></pre></td></tr></table></figure>
<p>After created add to pod’s spec</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">priorityClassName:</span> <span class="string">high-priority</span></span><br></pre></td></tr></table></figure>


<h3 id="Cronjob-definition-files"><a href="#Cronjob-definition-files" class="headerlink" title="Cronjob definition files:"></a>Cronjob definition files:</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ppi</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&quot;*/5 * * * *&quot;</span></span><br><span class="line">  <span class="attr">successfulJobsHistoryLimit:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">failedJobsHistoryLimit:</span> <span class="number">4</span></span><br><span class="line">  <span class="attr">jobTemplate:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">	  <span class="attr">activeDeadlineSeconds:</span> <span class="number">8</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pi</span></span><br><span class="line">            <span class="attr">image:</span> <span class="string">perl:5</span></span><br><span class="line">            <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">            <span class="attr">command:</span> [<span class="string">&quot;perl&quot;</span>, <span class="string">&quot;-Mbignum=bpi&quot;</span>, <span class="string">&quot;-wle&quot;</span>, <span class="string">&quot;print bpi(2000)&quot;</span>]</span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><code>spec.successfulJobsHistoryLimit</code> and  <code>spec.failedJobsHistoryLimit</code>: defines how many job history remains after failure&#x2F;success. Default successful&#x2F;failed is 3&#x2F;1. </li>
<li><code>jobTemplate.spec.activeDeadlineSeconds</code>: this means after how long will the job get terminated no matter  <code>jobTemplate.spec.backoffLimit</code> is reached or not</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2023/06/05/k8s-templates/" data-id="cmkzmweos000nl4urbl2j51ta" data-title="k8s templates" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/K8s/" rel="tag">K8s</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-K8s-TS-hints" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/06/05/K8s-TS-hints/" class="article-date">
  <time class="dt-published" datetime="2023-06-05T07:00:30.000Z" itemprop="datePublished">2023-06-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/troubleshooting/">troubleshooting</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/06/05/K8s-TS-hints/">K8s TS hints</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Provide-some-basic-point-of-view-for-troubleshooting-K8s"><a href="#Provide-some-basic-point-of-view-for-troubleshooting-K8s" class="headerlink" title="Provide some basic point of view for troubleshooting K8s"></a>Provide some basic point of view for troubleshooting K8s</h1><h3 id="ImagePullBackoff"><a href="#ImagePullBackoff" class="headerlink" title="ImagePullBackoff"></a>ImagePullBackoff</h3><ol>
<li>This usually indicates something wrong with the pod description yaml file. Check name under <code>image: </code><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis123</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="unable-to-recognize-“something-yaml”"><a href="#unable-to-recognize-“something-yaml”" class="headerlink" title="unable to recognize “something.yaml”"></a>unable to recognize “something.yaml”</h3><ol>
<li>if “no matches for &#x2F; , kind&#x3D;ReplicaSet” . Possibly the apiVersion problem. Make sure it is <code>apps/v1</code><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="please-apply-your-changes-to-the-latest-version-and-try-again-error"><a href="#please-apply-your-changes-to-the-latest-version-and-try-again-error" class="headerlink" title="please apply your changes to the latest version and try again error"></a>please apply your changes to the latest version and try again error</h3><ol>
<li>This error after <code>kubectl apply</code> indicates that you should acquire the newest yaml file after you did some changes to the parts without modyfing the yaml file.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get replicaset name_of_replicaset -o yaml &gt;&gt; something.yaml</span><br><span class="line"></span><br><span class="line">kubectl replace/apply -f something.yaml</span><br></pre></td></tr></table></figure>

<h3 id="Do-not-add-extra-name-after-pods-name-when-creating-pods-imperatively"><a href="#Do-not-add-extra-name-after-pods-name-when-creating-pods-imperatively" class="headerlink" title="Do not add extra name after [pods_name] when creating pods imperatively"></a>Do not add extra name after [pods_name] when creating pods imperatively</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run &lt;pods_name&gt; &lt;args&gt; --image=&lt;image_name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Things-todo-if-kubectl-command-ceased-responding"><a href="#Things-todo-if-kubectl-command-ceased-responding" class="headerlink" title="Things todo if kubectl command ceased responding"></a>Things todo if kubectl command ceased responding</h3><ul>
<li>check logs under <code>/var/log/container</code></li>
<li>use <code>crictl</code> command <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">crictl ps -a</span><br><span class="line">crictl logs container-id</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">docker ps </span><br><span class="line">docker logs</span><br><span class="line"><span class="comment"># </span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Understand-mountpath-and-host-path"><a href="#Understand-mountpath-and-host-path" class="headerlink" title="Understand mountpath and host path"></a>Understand mountpath and host path</h3><p>Here is the example:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">audit-log</span></span><br><span class="line">  <span class="attr">hostPath:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/var/log/k8s-audit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumeMounts:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">audit-log</span></span><br><span class="line">  <span class="attr">mountPath:</span> <span class="string">/audit</span></span><br></pre></td></tr></table></figure>

<p>From the above example,<br><em><strong>hostPath</strong></em> is the path in the actual node,<br> <em><strong>mountPath</strong></em> is path shown in the container</p>
<p>Container only see <code>/audit</code>. On the actual server, the path is <code>/var/log/k8s-audit</code></p>
<p><strong>One special case is single file mapping:</strong></p>
<p>Warning: mounting path to a file or vice versa will crash the pod</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">audit</span></span><br><span class="line">  <span class="attr">hostPath:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/etc/kubernetes/logpolicy/sample-policy.yaml</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">File</span> </span><br><span class="line"></span><br><span class="line"><span class="attr">volumeMounts:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">audit</span></span><br><span class="line">  <span class="attr">mountPath:</span> <span class="string">/etc/kubernetes/logpolicy/sample-policy.yaml</span></span><br><span class="line">  <span class="attr">readOnly:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2023/06/05/K8s-TS-hints/" data-id="cmkzmweon0006l4ur6fy50nrn" data-title="K8s TS hints" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/K8s/" rel="tag">K8s</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="extend next" rel="next" href="/blog/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/DIY-and-lab/">DIY and lab</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Learning/">Learning</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/commands/">commands</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/troubleshooting/">troubleshooting</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/AWS-K8s/" rel="tag">AWS, K8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Cloud-native/" rel="tag">Cloud native</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/K8s/" rel="tag">K8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/PKI-encryption-TLS/" rel="tag">PKI, encryption, TLS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/k8s-helm/" rel="tag">k8s, helm</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/AWS-K8s/" style="font-size: 10px;">AWS, K8s</a> <a href="/blog/tags/Cloud-native/" style="font-size: 10px;">Cloud native</a> <a href="/blog/tags/K8s/" style="font-size: 20px;">K8s</a> <a href="/blog/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/blog/tags/PKI-encryption-TLS/" style="font-size: 10px;">PKI, encryption, TLS</a> <a href="/blog/tags/k8s-helm/" style="font-size: 15px;">k8s, helm</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2026/01/">January 2026</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/06/">June 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2026/01/29/Deploy-kubernetes-and-datadog-on-AWS/">Deploy kubernetes and datadog on AWS</a>
          </li>
        
          <li>
            <a href="/blog/2026/01/22/kubernetes-security/">kubernetes security</a>
          </li>
        
          <li>
            <a href="/blog/2026/01/05/deploy-5gc-on-kubernetes/">Deploy-5gc-on-kubernetes</a>
          </li>
        
          <li>
            <a href="/blog/2026/01/05/Deploy-k8s-cluster/">Deploy kubernetes cluster on virtual machine</a>
          </li>
        
          <li>
            <a href="/blog/2024/07/18/PKI-and-encryption-explained-step-by-step/">PKI and encryption explained step by step</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2026 Hongyi Shen<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/blog/js/jquery-3.6.4.min.js"></script>



  
<script src="/blog/fancybox/jquery.fancybox.min.js"></script>




<script src="/blog/js/script.js"></script>





  </div>
</body>
</html>