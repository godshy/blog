<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hongyi&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hongyi&#39;s blog">
<meta property="og:url" content="https://godshy.github.io/blog/index.html">
<meta property="og:site_name" content="Hongyi&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Hongyi Shen">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/blog/atom.xml" title="Hongyi's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/blog/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/blog/css/style.css">

  
    
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Hongyi&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/blog/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://godshy.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-deploy-5gc-on-kubernetes" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2026/01/05/deploy-5gc-on-kubernetes/" class="article-date">
  <time class="dt-published" datetime="2026-01-05T13:23:51.000Z" itemprop="datePublished">2026-01-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/DIY-and-lab/">DIY and lab</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2026/01/05/deploy-5gc-on-kubernetes/">Deploy-5gc-on-kubernetes</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Install-5GC-on-kubernetes-cluster"><a href="#Install-5GC-on-kubernetes-cluster" class="headerlink" title="Install 5GC on kubernetes cluster"></a>Install 5GC on kubernetes cluster</h1><h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>2 years ago, I tried to deploy 5gc on a minikube vm, and installed free5gc. However, free5gc is no longer supported and there are problems related to calico cannot be resolved. This time I select another repository and installed on a real kubernetes cluster.</p>
<h2 id="Cluster-installation-and-preparation"><a href="#Cluster-installation-and-preparation" class="headerlink" title="Cluster installation and preparation"></a>Cluster installation and preparation</h2><p>For kubernetes cluster installation, check my other post <strong>Deploy kubernetes cluster on virtual machine</strong>. </p>
<h3 id="CNI-plugin"><a href="#CNI-plugin" class="headerlink" title="CNI plugin"></a>CNI plugin</h3><p>When installing network plugin, a calico plugin is installed, it enables pod-pod network, node-node connectivety. However, when deploying 5gs, multiple ports on pod are needed. For example, when adding UPF, an interface for user-plane and an interface for control-plane are both required. Here I installed multus-CNI to accomplish such requirement.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/k8snetworkplumbingwg/multus-cni/master/deployments/multus-daemonset.yml</span><br></pre></td></tr></table></figure>
<p>Check multus daemonset is installed on each node:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    kubectl get daemonset -n kube-system</span><br><span class="line">NAME             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE</span><br><span class="line">kube-multus-ds   2         2         2       2            2           &lt;none&gt;                   18d</span><br></pre></td></tr></table></figure>
<h3 id="Helm-installation"><a href="#Helm-installation" class="headerlink" title="Helm installation"></a>Helm installation</h3><p>Very simple, just execute following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3</span><br><span class="line"><span class="built_in">chmod</span> 700 get_helm.sh</span><br><span class="line">./get_helm.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="Metric-server"><a href="#Metric-server" class="headerlink" title="Metric server"></a>Metric server</h3><p>Need metric server to use <code> kubectl top</code> command, other wise it will just say: “error: Metrics API not available”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span><br></pre></td></tr></table></figure>


<p>However, after applied it, the pod didn’t go up, after checking the logs it says:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cannot validate certificate for x.x.x.x because it doesn&#x27;t contain any IP SANs&quot; node=&quot;xxx&quot;</span><br></pre></td></tr></table></figure>
<p>This means, kubelet server cert didn’t contain Subject Alternative Name, thus metric-server cannot connect to kubelet using TLS.</p>
<p>Run the following to check for the server certificate</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> /var/lib/kubelet/pki/kubelet.crt -noout -text | grep -A2 <span class="string">&quot;Subject Alternative Name&quot;</span></span><br></pre></td></tr></table></figure>
<p>There are two method to solve this:</p>
<ol>
<li>modify api-server side to let it ignore unsecure tls</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add kubelet-insecure-tls</span></span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - args:</span><br><span class="line">        - --kubelet-insecure-tls</span><br><span class="line">        - --cert-dir=/tmp</span><br><span class="line">        - --secure-port=10250</span><br><span class="line">        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span><br><span class="line">        - --kubelet-use-node-status-port</span><br><span class="line">        - --metric-resolution=15s</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>modifiy kubelet settings to renew a certificate and let it contain new SAN.</li>
</ol>
<p>Add following into &#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;config.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">serverTLSBootstrap:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="PVC-Under-construction"><a href="#PVC-Under-construction" class="headerlink" title="PVC (Under construction)"></a>PVC (Under construction)</h3><p>If installing kubernetes on local machine, storage class and pvc need to be configured, otherwise DB or statefulset cannot be actived.</p>
<h3 id="5GC-install-Under-construction"><a href="#5GC-install-Under-construction" class="headerlink" title="5GC install (Under construction)"></a>5GC install (Under construction)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">helm pull oci://registry-1.docker.io/gradiant/open5gs --version 2.2.0</span><br><span class="line">helm pull oci://registry-1.docker.io/gradiant/ueransim-gnb --version 0.2.6</span><br><span class="line"><span class="built_in">mkdir</span> 5gs</span><br><span class="line"><span class="built_in">mv</span> open5gs-2.2.0.tgz 5gs/</span><br><span class="line"><span class="built_in">mv</span> ueransim-gnb-0.2.6.tgz 5gs/</span><br><span class="line"><span class="built_in">cd</span> 5gs/</span><br><span class="line">tar -zxf open5gs-2.2.0.tgz</span><br><span class="line">tar -zxf ueransim-gnb-0.2.6.tgz</span><br><span class="line"></span><br><span class="line"><span class="comment"># If no need of 4g node, just modify values.yaml before installing. Here is my values without 4g.</span></span><br><span class="line">helm install open5gs -n 5gs ./open5gs-2.2.0.tgz --values ./open5gs/values_no4g.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  values_no4g.yaml</span></span><br><span class="line"><span class="attr">dbURI:</span> <span class="string">&quot;mongodb://<span class="template-variable">&#123;&#123; .Release.Name &#125;&#125;</span>-mongodb/open5gs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">populate:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">registry:</span> <span class="string">docker.io</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">gradiant/open5gs-dbctl</span></span><br><span class="line">    <span class="attr">tag:</span> <span class="number">0.10</span><span class="number">.3</span></span><br><span class="line">    <span class="attr">pullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">initCommands:</span> []</span><br><span class="line">  <span class="comment"># example of initCommands:</span></span><br><span class="line">  <span class="comment">#  - open5gs-dbctl add 999700000000001 465B5CE8B199B49FAA5F0A2EE238A6BC E8ED289DEBA952E4283B54E88E6183CA</span></span><br><span class="line">  <span class="comment">#  - open5gs-dbctl add_ue_with_apn 999700000000002 465B5CE8B199B49FAA5F0A2EE238A6BC E8ED289DEBA952E4283B54E88E6183CA internet</span></span><br><span class="line">  <span class="comment">#  - open5gs-dbctl add_ue_with_slice 999700000000003 465B5CE8B199B49FAA5F0A2EE238A6BC E8ED289DEBA952E4283B54E88E6183CA internet 1 111111</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Common</span></span><br><span class="line"><span class="attr">mongodb:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">auth:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">smf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">upf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">webui:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4G</span></span><br><span class="line"><span class="attr">hss:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">mme:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">pcrf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">sgwc:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">sgwu:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5G</span></span><br><span class="line"><span class="attr">amf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">ausf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">bsf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">nrf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">nssf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">pcf:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">scp:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">udm:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">udr:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mongodb:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2026/01/05/deploy-5gc-on-kubernetes/" data-id="cmkjfu8y4000hecur8ryid8wu" data-title="Deploy-5gc-on-kubernetes" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/k8s-helm/" rel="tag">k8s, helm</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Deploy-k8s-cluster" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2026/01/05/Deploy-k8s-cluster/" class="article-date">
  <time class="dt-published" datetime="2026-01-05T12:44:58.000Z" itemprop="datePublished">2026-01-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2026/01/05/Deploy-k8s-cluster/">Deploy kubernetes cluster on virtual machine</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Set-up-VMs"><a href="#Set-up-VMs" class="headerlink" title="Set up VMs"></a>Set up VMs</h2><p><code>One Network Adapter for internet, the other is for  connection between Nodes</code></p>
<p><img src="https://s2.loli.net/2026/01/05/ZuVatjDWwBnSUbT.png" alt="VM spec"></p>
<p>I installed Ubuntu 22.04.5 LTS on my local PC, two VMs, one is for master the other is for worker. </p>
<p>After VMs are installed and running, make sure two VM can ping each other, then edit etc&#x2F;hosts to let them resolve each other’s hostname:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># On master</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line">192.168.168.129 worker</span><br><span class="line"></span><br><span class="line"><span class="comment"># On worker </span></span><br><span class="line">vim /etc/hosts</span><br><span class="line">192.168.168.128 master</span><br><span class="line"></span><br><span class="line"><span class="comment"># then ping using hostname:</span></span><br><span class="line">master:$ ping worker <span class="comment"># should be ok</span></span><br><span class="line">worker:$ ping master <span class="comment"># should be ok</span></span><br></pre></td></tr></table></figure>

<p>then execute following commands:</p>
<p>On Master and Worker:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade -y</span><br><span class="line"><span class="comment"># check your hostname:</span></span><br><span class="line"><span class="built_in">uname</span> -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># disable swapoff for better performance and best practice:</span></span><br><span class="line">sudo swapoff -a</span><br><span class="line">sudo sed -i <span class="string">&#x27;/ swap / s/^\(.*\)$/#\1/g&#x27;</span> /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add settings to containerd.conf  </span></span><br><span class="line"><span class="comment"># overlay (for using overlayfs),  </span></span><br><span class="line"><span class="comment"># br_netfilter (for ipvlan, macvlan, external SNAT of service IPs)  </span></span><br><span class="line">sudo <span class="built_in">tee</span> /etc/modules-load.d/containerd.conf &lt;&lt;<span class="string">EOF  </span></span><br><span class="line"><span class="string">overlay  </span></span><br><span class="line"><span class="string">br_netfilter  </span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment"># Add settings to kubernetes.conf  </span></span><br><span class="line"><span class="comment"># Allow IPv4, IPv6 and IP forwarding  </span></span><br><span class="line">sudo <span class="built_in">tee</span> /etc/sysctl.d/kubernetes.conf &lt;&lt;<span class="string">EOF  </span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1  </span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1  </span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1  </span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">	<span class="comment"># Reload updated config  </span></span><br><span class="line">	sudo sysctl --system  </span><br><span class="line">	  </span><br><span class="line">	<span class="comment"># Install required tools and CA certificates  </span></span><br><span class="line">	sudo apt install -y curl gnupg2 software-properties-common apt-transport-https ca-certificates  </span><br><span class="line">	  </span><br><span class="line">	<span class="comment"># Add Docker repository  </span></span><br><span class="line">	sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmour -o /etc/apt/trusted.gpg.d/docker.gpg  </span><br><span class="line">	sudo add-apt-repository <span class="string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># Then, install containerd  </span></span><br><span class="line">	sudo apt update  </span><br><span class="line">	sudo apt install -y containerd.io  </span><br><span class="line">	containerd config default | sudo <span class="built_in">tee</span> /etc/containerd/config.toml &gt;/dev/null 2&gt;&amp;1  </span><br><span class="line">	sudo sed -i <span class="string">&#x27;s/SystemdCgroup \= false/SystemdCgroup \= true/g&#x27;</span> /etc/containerd/config.toml  </span><br><span class="line">	sudo systemctl restart containerd  </span><br><span class="line">	sudo systemctl <span class="built_in">enable</span> containerd</span><br><span class="line"></span><br><span class="line">	<span class="comment"># Add k8s repository</span></span><br><span class="line">	<span class="comment"># Please modify v1.32 to latest from https://kubernetes.io/releases/</span></span><br><span class="line">	sudo <span class="built_in">mkdir</span> -p /etc/apt/keyrings</span><br><span class="line">	curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.32/deb/Release.key | gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.32/deb/ /&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/kubernetes.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># Then, install Kubernetes components  </span></span><br><span class="line">	sudo apt update  </span><br><span class="line">	sudo apt install -y kubelet kubeadm kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add port granted for etcd:</span></span><br><span class="line">	sudo iptables -A INPUT -p tcp --dport 6443 -j ACCEPT</span><br><span class="line"><span class="comment"># k8s cluster nodes  </span></span><br><span class="line">	sudo apt-get install docker-ce</span><br><span class="line"></span><br><span class="line">	sudo reboot</span><br></pre></td></tr></table></figure>

<h3 id="Set-up-master-and-worker-and-CNI-plugin"><a href="#Set-up-master-and-worker-and-CNI-plugin" class="headerlink" title="Set up master and worker and CNI plugin"></a>Set up master and worker and CNI plugin</h3><h4 id="On-Master"><a href="#On-Master" class="headerlink" title="On Master"></a>On Master</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">	sudo kubeadm config images pull</span><br><span class="line">	sudo kubeadm init --pod-network-cidr=192.168.0.0/16</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">I0602 21:23:23.755053    2030 version.go:261] remote version is much newer: v1.33.1; falling back to: stable-1.32</span><br><span class="line">[config/images] Pulled registry.k8s.io/kube-apiserver:v1.32.5</span><br><span class="line">[config/images] Pulled registry.k8s.io/kube-controller-manager:v1.32.5</span><br><span class="line">[config/images] Pulled registry.k8s.io/kube-scheduler:v1.32.5</span><br><span class="line">[config/images] Pulled registry.k8s.io/kube-proxy:v1.32.5</span><br><span class="line">[config/images] Pulled registry.k8s.io/coredns/coredns:v1.11.3</span><br><span class="line">[config/images] Pulled registry.k8s.io/pause:3.10</span><br><span class="line">[config/images] Pulled registry.k8s.io/etcd:3.5.16-0</span><br><span class="line">shy@shymaster:~$ sudo kubeadm init</span><br><span class="line">I0602 21:24:42.138404    2276 version.go:261] remote version is much newer: v1.33.1; falling back to: stable-1.32</span><br><span class="line">[init] Using Kubernetes version: v1.32.5</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] Pulling images required <span class="keyword">for</span> setting up a Kubernetes cluster</span><br><span class="line">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight] You can also perform this action beforehand using <span class="string">&#x27;kubeadm config images pull&#x27;</span></span><br><span class="line">W0602 21:24:42.808265    2276 checks.go:846] detected that the sandbox image <span class="string">&quot;registry.k8s.io/pause:3.8&quot;</span> of the container runtime is inconsistent with that used by kubeadm.It is recommended to use <span class="string">&quot;registry.k8s.io/pause:3.10&quot;</span> as the CRI sandbox image.</span><br><span class="line">[certs] Using certificateDir folder <span class="string">&quot;/etc/kubernetes/pki&quot;</span></span><br><span class="line">[certs] Generating <span class="string">&quot;ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver&quot;</span> certificate and key</span><br><span class="line">[certs] apiserver serving cert is signed <span class="keyword">for</span> DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local shymaster] and IPs [10.96.0.1 11.0.1.130]</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver-kubelet-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;front-proxy-ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;front-proxy-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/server&quot;</span> certificate and key</span><br><span class="line">[certs] etcd/server serving cert is signed <span class="keyword">for</span> DNS names [localhost shymaster] and IPs [11.0.1.130 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/peer&quot;</span> certificate and key</span><br><span class="line">[certs] etcd/peer serving cert is signed <span class="keyword">for</span> DNS names [localhost shymaster] and IPs [11.0.1.130 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/healthcheck-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver-etcd-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;sa&quot;</span> key and public key</span><br><span class="line">[kubeconfig] Using kubeconfig folder <span class="string">&quot;/etc/kubernetes&quot;</span></span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;admin.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;super-admin.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;kubelet.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;controller-manager.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;scheduler.conf&quot;</span> kubeconfig file</span><br><span class="line">[etcd] Creating static Pod manifest <span class="keyword">for</span> <span class="built_in">local</span> etcd <span class="keyword">in</span> <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[control-plane] Using manifest folder <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-apiserver&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-controller-manager&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-scheduler&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file <span class="string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet configuration to file <span class="string">&quot;/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[wait-control-plane] Waiting <span class="keyword">for</span> the kubelet to boot up the control plane as static Pods from directory <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[kubelet-check] Waiting <span class="keyword">for</span> a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s</span><br><span class="line">[kubelet-check] The kubelet is healthy after 502.872747ms</span><br><span class="line">[api-check] Waiting <span class="keyword">for</span> a healthy API server. This can take up to 4m0s</span><br><span class="line">[api-check] The API server is healthy after 7.00102198s</span><br><span class="line">[upload-config] Storing the configuration used <span class="keyword">in</span> ConfigMap <span class="string">&quot;kubeadm-config&quot;</span> <span class="keyword">in</span> the <span class="string">&quot;kube-system&quot;</span> Namespace</span><br><span class="line">[kubelet] Creating a ConfigMap <span class="string">&quot;kubelet-config&quot;</span> <span class="keyword">in</span> namespace kube-system with the configuration <span class="keyword">for</span> the kubelets <span class="keyword">in</span> the cluster</span><br><span class="line">[upload-certs] Skipping phase. Please see --upload-certs</span><br><span class="line">[mark-control-plane] Marking the node shymaster as control-plane by adding the labels: [node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]</span><br><span class="line">[mark-control-plane] Marking the node shymaster as control-plane by adding the taints [node-role.kubernetes.io/control-plane:NoSchedule]</span><br><span class="line">[bootstrap-token] Using token: qbqna4.vcib69rginbjmgi3</span><br><span class="line">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs <span class="keyword">in</span> order <span class="keyword">for</span> nodes to get long term certificate credentials</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow certificate rotation <span class="keyword">for</span> all node client certificates <span class="keyword">in</span> the cluster</span><br><span class="line">[bootstrap-token] Creating the <span class="string">&quot;cluster-info&quot;</span> ConfigMap <span class="keyword">in</span> the <span class="string">&quot;kube-public&quot;</span> namespace</span><br><span class="line">[kubelet-finalize] Updating <span class="string">&quot;/etc/kubernetes/kubelet.conf&quot;</span> to point to a rotatable kubelet client certificate and key</span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">Alternatively, <span class="keyword">if</span> you are the root user, you can run:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm <span class="built_in">join</span> ....</span><br><span class="line"><span class="comment">#-------------------#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Follow the instructions from above:</span></span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install cni </span></span><br><span class="line"><span class="comment"># Find latest version on https://github.com/projectcalico/calico/releases</span></span><br><span class="line">	kubectl apply -f https://raw.githubusercontent.com/projectcalico/calico/v3.30.1/manifests/calico.yaml</span><br></pre></td></tr></table></figure>


<h4 id="On-worker"><a href="#On-worker" class="headerlink" title="On worker"></a>On worker</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># just copy and paste kubeadm join .... command from kube init output on master node, it will automatically join the master node</span></span><br><span class="line">	kubeadm <span class="built_in">join</span> ....</span><br></pre></td></tr></table></figure>

<h3 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting:"></a>Troubleshooting:</h3><ul>
<li>Your node will not be ready unless you successfully installed CNI plugin, because your pod cannot communicate outside node. To check issue, run following command:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">journalctl -u kubelet</span><br><span class="line">journalctl -u containerd</span><br></pre></td></tr></table></figure>

<p>Example of the finish state:<br><img src="https://s2.loli.net/2026/01/05/2JkmfQElny6X5z1.png" alt="Final result"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2026/01/05/Deploy-k8s-cluster/" data-id="cmkjfu8xz0004ecurbxhtb93b" data-title="Deploy kubernetes cluster on virtual machine" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/K8s/" rel="tag">K8s</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-PKI-and-encryption-explained-step-by-step" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2024/07/18/PKI-and-encryption-explained-step-by-step/" class="article-date">
  <time class="dt-published" datetime="2024-07-18T02:40:47.000Z" itemprop="datePublished">2024-07-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/security/">security</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/07/18/PKI-and-encryption-explained-step-by-step/">PKI and encryption explained step by step</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="PKI-and-data-transfer-encryption-explained"><a href="#PKI-and-data-transfer-encryption-explained" class="headerlink" title="PKI and data transfer encryption explained"></a>PKI and data transfer encryption explained</h1><p>It is import to understand the concept of data layer encryption and security. Let’s understand how it works from scratch. I will explain this by using different scenarios. </p>
<h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><ol>
<li><a href="#what-we-want-to-achieve">Basic concept</a></li>
<li><a href="#scenario-1-no-encryption">Scenario 1</a></li>
<li><a href="#scenario-2-symmetric-encryption">Scenario 2</a></li>
<li><a href="#scenario-3-asymmetric-encryption">Scenario 3</a></li>
<li><a href="#scenario-4-digital-signature">Scenario 4</a></li>
<li><a href="#summary">Summary</a></li>
</ol>
<h2 id="What-we-want-to-achieve"><a href="#What-we-want-to-achieve" class="headerlink" title="What we want to achieve?"></a>What we want to achieve?</h2><p>It is always import to understand why we need data layer encryption in the first place. Here is some points that we need to consider if we want to protect the data when sending it to remote peers.</p>
<ul>
<li>confidentiality: Only targeted user or device can read and decrypt the data you sent. If attacker want to decrypt your data, they cannot achieve this within the time that this message or data is valid. Confidentiality is achieved by <strong>encryption algorithms</strong>.</li>
<li>integrity: You need to ensure that the data you sent is not alternated by third parties. Receiver can check to see if the data is original and the same as you sent. This is achieved by using <strong>Hash algorithms</strong>.</li>
<li>Source verification: Sender of data can be verified. Not by forged or created by unknown person. This is achieved by <strong>HMAC</strong>, hash message authentication code.</li>
<li>Deniability prevention: Sender of message or data cannot deny the fact that he sent this message. This is achieved by <strong>digital signature</strong>.</li>
</ul>
<p>Next let’s talk about how to encrypt and secure the connection between users.</p>
<h2 id="Scenario-1-no-encryption"><a href="#Scenario-1-no-encryption" class="headerlink" title="Scenario 1: no encryption"></a>Scenario 1: no encryption</h2><p>Imagine A want to send data to B, in which contains sensitive data.<br>In first scenario, A is sending plain text, hackers can easily stole the data by capturing packet. This is, obviously, not safe.<br><img src="https://s2.loli.net/2024/07/18/6tMxpNq2OAoFT5a.png" alt="Scenario 1, A is sending plain text o B."></p>
<h2 id="Scenario-2-symmetric-encryption"><a href="#Scenario-2-symmetric-encryption" class="headerlink" title="Scenario 2: symmetric encryption"></a>Scenario 2: symmetric encryption</h2><p>Let’s consider a encryption method to protect data transportation.<br>There is one method called <strong>symmetric encryption</strong>, data is encrypted and decrypted by a so-called key. In symmetric encryption, both encryption&#x2F;decryption is used by same key. So this doesn’t solve the problem of data leakage. If attackers stole the key, they are also able to see the content of data.<br><img src="https://s2.loli.net/2024/07/18/FSnuHhs178GkKxe.png" alt="Scenario 2, symmetric encryption, but not solving problems"></p>
<h2 id="Scenario-3-asymmetric-encryption"><a href="#Scenario-3-asymmetric-encryption" class="headerlink" title="Scenario 3: asymmetric encryption"></a>Scenario 3: asymmetric encryption</h2><p>To solve the problem in scenario 2, we need to think of a way to protect the key from being stolen while transferring to remote side.<br>Here we introduce <strong>asymmetric encryption algorithm</strong>. Asymmetric encryption use a private&#x2F;public key pair, instead of one key to encrypt and decrypt data. You can either choose to use private key to encrypt and public key to decrypt or vice versa. In our case, A&#x2F;B firstly generate their only private&#x2F;public key-pair. Then encrypt the data using their private key and exchange the public key with others.<br>Data are decrypted by the corresponding public key.</p>
<p>The problem of asymmetric algorithm is that it has a huge compute complexity so using this method to encrypt  large data is time costing.<br>To mitigate the issue, we use asymmetric algorithm to encrypt&#x2F;decrypt the symmetric key only. The data is still encrypted by symmetric key. Then the key itself is encrypted by private key of sender. Receiver received the encrypted symmetric key and the public key of sender, it uses the public key to decrypt the symmetric key, and use this key to decrypt the data. In this case, even if hacker get the public key, he cannot decrypt the encrypted symmetric key, thus not able to stole the data.<br><img src="https://s2.loli.net/2024/07/18/mQ7xhypnv9uMS4I.png" alt="Scenario 3, by using asymmetric and symmetric encryption, data are now secured"></p>
<p>But hacker doesn’t give up, in fact he still has some way to stole the data. Actually the method of exchanging public keys between each other, will cause source verification issue. That’s what I mentioned in the first place. In other word, neither A nor B can figure out whether he is exchanging keys with proper peer. Hacker could be playing A or B, and we don’t have a way to identify then. Also, we are not sure whether data is not tampered during transportation or not. Let’s look two attack pattern below.</p>
<p>In first pattern, hacker is playing A and exchanging key with B, B actually received public key from hacker, but hacker claims the key is actually from A, B cannot verify it.</p>
<p><img src="https://s2.loli.net/2024/07/18/KvucmGXQnyFtji8.png" alt="Attack pattern 1. Hacker is playing role as A and send malicious data"></p>
<p>In second pattern, hacker is playing B and exchanging key with A. A cannot verify whether the incoming public key is from B or others. By encrypting the data using the unknown public key, it is actually sending data to hacker.<br><img src="https://s2.loli.net/2024/07/18/oITn98uUgYlOft1.png" alt="Attack pattern 2. Hacker is staling data from A by playing role as B"></p>
<h2 id="Scenario-4-digital-signature"><a href="#Scenario-4-digital-signature" class="headerlink" title="Scenario 4: digital signature"></a>Scenario 4: digital signature</h2><p>So how we fix this issue? You see, in real world, we use signature to<br>identify the source of executer. You cannot deny what you have done with signature as evidence. We can use same method to identify the sender in our case, by using method so-called digital signature. To verify the source of sender, sender uses his private key to encrypt the hash of his data, hash of the data is called digest, and encrypted hash is called signature. Sender and receiver exchanges public key, then perform Data encryption and symmetric key encryption, when sender sends his encrypted data and key, he also sends a signature in which contains the hash result of the data encrypted by his private key. Receiver then do the same thing, decrypt data and symmetric key, but also decrypt the signature and compare with the hash between the sent data digest and signature digest.<br><img src="https://s2.loli.net/2024/07/18/kdZbijFreGV7BgI.png" alt="A uses his private key to do digital signature"></p>
<p><img src="https://s2.loli.net/2024/07/18/EHZzMIxsUWX6tuL.png" alt="A send his digital signature to prove the data is sent to B not by others and data is not alternated"></p>
<p>However, still one problem exists.. Since there is no way to verify the identity of key owner, everyone can claim they are the correct sender.. Signature can make sure data is not alternated while transporting. But every can claim that they are A using their own signature. </p>
<p>In real world, every one’s identity is proven by your government or a third party authority that everyone can believe into. Here we introduce a concept called CA (centralized authority) to deal with the identity problem. CA acts as a trusted third-party to help validate and verify the identity of each senders&#x2F;receivers.<br>CA uses his private key to create digest and prepare the certificate for each public key of end user. The certificate has specific format. But in general, it contains public key of the end-user, valid data and digital signature of CA.<br>Certificate is verified by CA’s public key, if the digest matches, then senders’ identity are verified.</p>
<p><img src="https://s2.loli.net/2024/07/18/cKhp8g7CRjeBrLA.png" alt="A here send a CSR(certificate sign request) to CA, CA signs this CSR using its private key. A can now use his signed certificate to identify himself."></p>
<p>However, how to verify CA is trusted? Not signed by anyone else? Actually everyone can setup its own CA and sign for himself. To prevent it, CA will self-sign a root certificate, and install on each users. Users use CA’s public key to verify the identity of CA.<br><img src="https://s2.loli.net/2024/07/18/wnUILl3hHWcZFiX.png" alt="CA also need to be trusted."></p>
<p><img src="https://s2.loli.net/2024/07/18/T5R7HOtiSdYIKFl.png" alt="Generally, CA sign its own public key. And installed on end-users. For example, every PC would install CA cert when it was manufactured. CA cert is decrypted by CA public key"></p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>To establish a secured connection between A and B,<br>in which A’s identity is verified by B and B’s identity is verified by A. On A and B there should be these files existing below.<br><img src="https://s2.loli.net/2024/07/18/lRpKxEeHkhTUsr7.png" alt="A/B need to install CA cert, then they exchange their certificates."></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2024/07/18/PKI-and-encryption-explained-step-by-step/" data-id="cmkjfu8y3000fecurfj50citd" data-title="PKI and encryption explained step by step" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/PKI-encryption-TLS/" rel="tag">PKI, encryption, TLS</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-linux-FS-and-pkg" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2024/02/21/linux-FS-and-pkg/" class="article-date">
  <time class="dt-published" datetime="2024-02-21T05:38:04.000Z" itemprop="datePublished">2024-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/Learning/">Learning</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2024/02/21/linux-FS-and-pkg/">linux FS and pkg</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Linux-filesystem-and-package-management"><a href="#Linux-filesystem-and-package-management" class="headerlink" title="Linux filesystem and package management"></a>Linux filesystem and package management</h1><h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><ol>
<li><a href="#filesystems">Filesystems</a></li>
<li><a href="#packages-and-applications">Package and apps</a></li>
</ol>
<h2 id="Filesystems"><a href="#Filesystems" class="headerlink" title="Filesystems"></a>Filesystems</h2><p>Some concept in filesystems are:</p>
<ul>
<li><p>Drive: A physical block device such as HDD or SSD. <strong>In virtual machines, drive can be emulated</strong>. <code>/dev/sda (SCSI device)</code> <code>/dev/sdb (SATA)</code> or <code>/dev/hda (IDE)</code></p>
</li>
<li><p>Partition: Divide physical disks into partitions, logical sub-disks</p>
</li>
<li><p>Volume: special partition with more flexibility </p>
</li>
<li><p>Super block: A special section that contains metadata of the filesystem such as fs type, blocks, state..</p>
</li>
<li><p>Inodes: Inodes store metadata about files such as size, owner, location, data and permissions. It does not store file name and actual data</p>
</li>
</ul>
<p>Use <code> lsblk</code> to list the block devices</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    lsblk --exclude 7</span><br><span class="line">NAME  MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">sda     8:0    0 389.8M  1 disk</span><br><span class="line">sdb     8:16   0     3G  0 disk [SWAP]</span><br><span class="line">sdc     8:32   0     1T  0 disk /var/lib/docker</span><br><span class="line">                                /var/snap/firefox/common/host-hunspell</span><br><span class="line">                                /snap</span><br><span class="line">                                /mnt/wslg/distro</span><br><span class="line">                                /</span><br></pre></td></tr></table></figure>

<p>Use <code> findmnt</code> to list filesystems</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">findmnt -D -t nosquashfs <span class="comment"># exclude squashfs type files(used for snapshots)</span></span><br></pre></td></tr></table></figure>

<h3 id="Hard-link-and-symbolic-links"><a href="#Hard-link-and-symbolic-links" class="headerlink" title="Hard link and symbolic links"></a>Hard link and symbolic links</h3><p> A hard link works by creating another filename that refers to the inode data of the original file. In practice, this is similar to creating a copy of the file.</p>
<ul>
<li><p>If the original file is deleted, the file data can still be accessed through other hard links.</p>
</li>
<li><p>If the original file is moved, hard links still work.</p>
</li>
<li><p>A hard link can only refer to a file on the same file system.</p>
</li>
<li><p>The inode and file data are permanently deleted when the number of hard links is zero</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> myfile somealias</span><br></pre></td></tr></table></figure>
<p>A soft link, sometimes called a symbolic link or symlink, points to the location or path of the original file. It works like a hyperlink on the internet.</p>
<ul>
<li><p>If the symbolic link file is deleted, the original data remains.</p>
</li>
<li><p>If the original file is moved or deleted, the symbolic link won’t work.</p>
</li>
<li><p>A soft link can refer to a file on a different file system.</p>
</li>
<li><p>Soft links are often used to quickly access a frequently-used file without typing the whole location.</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s myfile somealias</span><br></pre></td></tr></table></figure>
<p>Differences between hard link and symbolic link</p>
<ul>
<li><p>A soft link does not contain the data in the target file.</p>
</li>
<li><p>A soft link points to another entry somewhere in the file system.</p>
</li>
<li><p>A soft link has the ability to link to directories, or to files on remote computers networked through NFS.</p>
</li>
<li><p>Deleting a target file for a symbolic link makes that link useless.</p>
</li>
<li><p>A hard link preserves the contents of the file.</p>
</li>
<li><p>A hard link cannot be created for directories, and they cannot cross filesystem boundaries or span across partitions.</p>
</li>
<li><p>In a hard link, you can use any of the hard link names created to execute a program or script in the same manner as the original name given.</p>
</li>
</ul>
<h3 id="VFS-virtual-file-system"><a href="#VFS-virtual-file-system" class="headerlink" title="VFS (virtual file system)"></a>VFS (virtual file system)</h3><p>Abstraction layer in the kernel that provides clients a common way to access resources.<br>Using VFS user can access to resource like local filesystems, in-memory filesystems(memory), pseudo filesystems or network filesystems and treat them as simple file.<br>[<a target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/next/filesystems/vfs.html]">https://www.kernel.org/doc/html/next/filesystems/vfs.html]</a></p>
<h3 id="Creating-filesystems"><a href="#Creating-filesystems" class="headerlink" title="Creating filesystems"></a>Creating filesystems</h3><p>To creating filesystems, first step is to create filesystem (similar to partition)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs -t ext4 /dev/some_vg/some_lv <span class="comment"># some volume group and logical volume</span></span><br></pre></td></tr></table></figure>
<p>Then, you need to mount it to the root filesystem tree</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ext4, tmpfs <span class="comment"># check mount status for ext4 tmpfs file system types</span></span><br></pre></td></tr></table></figure>

<p><code>Mounts is avaliable as long as the system is running, to mount permanentlly you need to use the fstab file.</code></p>
<h3 id="procfs-sysfs-and-devfs"><a href="#procfs-sysfs-and-devfs" class="headerlink" title="procfs sysfs and devfs"></a>procfs sysfs and devfs</h3><ul>
<li><p>proc filesystem contains process-related infor from the kernel.<br>users can view at <code>/proc/PID/</code></p>
</li>
<li><p>sysfs is located in <code>/sys</code> contains kernal information to exposed select information.</p>
</li>
<li><p>devfs contains device files, random data generator is also included.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tr</span> -dc A-Za-z0-9 &lt; /dev/urandowm | <span class="built_in">head</span> -c 42</span><br></pre></td></tr></table></figure>
</li>
<li><p>common filesystem is format for filesystems. Check link below for more details. <a target="_blank" rel="noopener" href="https://hyperskill.org/learn/step/34977">https://hyperskill.org/learn/step/34977</a></p>
</li>
</ul>
<h2 id="Packages-and-applications"><a href="#Packages-and-applications" class="headerlink" title="Packages and applications"></a>Packages and applications</h2><h3 id="Terminology-explanations"><a href="#Terminology-explanations" class="headerlink" title="Terminology explanations"></a>Terminology explanations</h3><ul>
<li>Program: binary file or executable. Code to run something.</li>
<li>Process: A running entity based on a program loaded into main memory and either using CPU or I&#x2F;O when not sleeping</li>
<li>Daemon: or called service, a background process that provides function to other processes. For example: daemons for web service, logging time …</li>
<li>Application: program including its dependencies. A combination of multiple programs. </li>
<li>Package: A file that contains programs and configs, used to distribute software applications</li>
<li>Package manager: A program that takes a package as an input, and based on its content and user instruction to install it upgrades it or removes it</li>
</ul>
<h4 id="Boot-process"><a href="#Boot-process" class="headerlink" title="Boot process"></a>Boot process</h4><p>PWR on —&gt; UEFI or BIOS —&gt; Boot loader —&gt; Kernel —&gt; Init —&gt; Other user interface</p>
<ol>
<li>UEFI or BIOS init hardware and boot basic configuration, then handle over to boot loader</li>
<li>Boot loader starts kernel</li>
<li>kernel are loaded from &#x2F;boot to main memory</li>
<li>Init system is responsible for launching daemons</li>
</ol>
<h3 id="Systemd-initializer"><a href="#Systemd-initializer" class="headerlink" title="Systemd initializer"></a>Systemd initializer</h3><p>If we want to set an application as service, we can define .service file and put them into <code>/run/systemd/system/</code></p>
<ul>
<li>User <code>journalctl</code> command, you can see systemctl-managed service logs.</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2024/02/21/linux-FS-and-pkg/" data-id="cmkjfu8y5000lecure0jfe4w1" data-title="linux FS and pkg" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Linux/" rel="tag">Linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Deploy-free5GC-with-k8s-and-helm" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/10/23/Deploy-free5GC-with-k8s-and-helm/" class="article-date">
  <time class="dt-published" datetime="2023-10-23T06:32:30.000Z" itemprop="datePublished">2023-10-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/DIY-and-lab/">DIY and lab</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/10/23/Deploy-free5GC-with-k8s-and-helm/">Deploy free5GC with k8s and helm</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Install-free5gc-on-personal-pcs-using-k8s-and-helm"><a href="#Install-free5gc-on-personal-pcs-using-k8s-and-helm" class="headerlink" title="Install free5gc on personal pcs using k8s and helm"></a>Install free5gc on personal pcs using k8s and helm</h1><h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Very trivial and simple try to install and run free5gc on my personal PC by using Free5GC with Kubernetes, helm, calico and multus.</p>
<p>For the first step, I was planning to install free5gc<br>on one cluster and test it using UERANSIM.</p>
<p>As for next step I plan to deploy free5gc on multiple nodes environments in which master and worker node are separated. Also planning to deploy on openstack environment or AWS.</p>
<h2 id="Prepare"><a href="#Prepare" class="headerlink" title="Prepare"></a>Prepare</h2><p>I was using vmware workstation and deployed ubuntu 20.6 image on it. Memory was set to around 10G to make sure calico works ok.</p>
<p><img src="https://s2.loli.net/2023/10/26/VRX3ncqWjINhxzY.png" alt="VM info"></p>
<p>After ubuntu is up, do the install and update packages first.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:~$ sudo apt update -y</span><br><span class="line">:~$ sudo apt upgrade -y</span><br><span class="line">:~$ sudo apt install -y curl wget apt-transport-https</span><br></pre></td></tr></table></figure>

<p>Then install and start up minikube, minikube enables user to set up kubernetes cluster on the system.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">:~$ wget https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</span><br><span class="line">:~$ sudo <span class="built_in">cp</span> minikube-linux-amd64 /usr/local/bin/minikube</span><br><span class="line">:~$ sudo <span class="built_in">chmod</span> +x /usr/local/bin/minikube</span><br><span class="line"><span class="comment"># use calico as cni(container network interface) plugin </span></span><br><span class="line">:~$ minikube start --driver=docker --cpus=4 --memory=8g --disk-size=20g --cni=calico</span><br><span class="line"></span><br><span class="line">:~$ minikube status</span><br><span class="line"></span><br><span class="line">    minikube</span><br><span class="line">    <span class="built_in">type</span>: Control Plane</span><br><span class="line">    host: Running</span><br><span class="line">    kubelet: Running</span><br><span class="line">    apiserver: Running</span><br><span class="line">    kubeconfig: Configured</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2023/10/26/gJeHqMjoGhIONCR.png" alt="minikube status"></p>
<p>After minikube was installed, install kubectl for better experience. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">:~$ curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl</span><br><span class="line"><span class="comment"># If exeucte the command directly, it may have warning regard to minikube and kubectl version mismatch. To avoid this, you can designate version of kubectl to match with minikube</span></span><br><span class="line">:~$ curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.26.3/bin/linux/amd64/kubectl</span><br><span class="line">:~$ <span class="built_in">chmod</span> +x kubectl</span><br><span class="line">:~$ sudo <span class="built_in">mv</span> kubectl /usr/local/bin/</span><br><span class="line">:~$ kubectl version -o yaml</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2023/10/26/HkLGdtBNwoVfFCc.png" alt="Installed kubectl"></p>
<p>Then for the last step of preparation, we need to install helm and multus-CNI plugin to enable multiple interface support for pods.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">:~$ curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3</span><br><span class="line">:~$ <span class="built_in">chmod</span> 700 get_helm.sh</span><br><span class="line">:~$ ./get_helm.sh</span><br><span class="line">:~$ helm list -A</span><br><span class="line">:~$ git <span class="built_in">clone</span> https://github.com/k8snetworkplumbingwg/multus-cni.git</span><br><span class="line">:~$ <span class="built_in">cd</span> multus-cni</span><br><span class="line">:~$ <span class="built_in">cat</span> ./deployments/multus-daemonset-thick.yml | kubectl apply -f -</span><br><span class="line">:~$ kubectl get pods -n kube-system</span><br></pre></td></tr></table></figure>

<p>For me I had multus pods oom killed, so I modified the request and limit resource in the multus-daemonset-thick.yml then pod went up fine.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kube-multus</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/k8snetworkplumbingwg/multus-cni:snapshot-thick</span></span><br><span class="line">    <span class="attr">command:</span> [ <span class="string">&quot;/usr/src/multus-cni/bin/multus-daemon&quot;</span> ]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;50Mi&quot;</span> <span class="string">--&gt;</span> <span class="string">&quot;250Mi&quot;</span></span><br><span class="line">      <span class="attr">limits:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;50Mi&quot;</span> <span class="string">--&gt;</span> <span class="string">&quot;350Mi&quot;</span></span><br><span class="line">    <span class="attr">securityContext:</span></span><br><span class="line">      <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni</span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/host/etc/cni/net.d</span></span><br></pre></td></tr></table></figure>

<h2 id="Free5gc-install"><a href="#Free5gc-install" class="headerlink" title="Free5gc install"></a>Free5gc install</h2><p>Main step of installing 5gc is to use helm to pull repository from free5gc git, then install the helm chart.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create namespace </span></span><br><span class="line">:~$ kubectl create namespace free5gc</span><br><span class="line"><span class="comment"># add helm repository</span></span><br><span class="line">:~$ helm repo add towards5gs <span class="string">&#x27;https://raw.githubusercontent.com/Orange-OpenSource/towards5gs-helm/main/repo/&#x27;</span></span><br><span class="line">:~$ helm repo update</span><br><span class="line">:~$ helm repo list</span><br><span class="line">:~$ helm search repo</span><br></pre></td></tr></table></figure>


<p><img src="https://s2.loli.net/2023/10/26/oF6m4k1uTtsqc3d.png" alt="Helm install"></p>
<p>After checking the helm repository, it is ok to procced with installing free5gc.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">:~$ helm -n free5gc install free5gc towards5gs/free5gc</span><br><span class="line">:~$ kubectl get pods -n free5gc</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><img src="https://s2.loli.net/2023/10/26/qcLoV1daCsj8TSR.png" alt="pod install complete"></p>
<p><strong>Upf pod cannot set up and will stuck in creating state because multus cannot add eth1 to this pod.</strong></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Orange-OpenSource/towards5gs-helm">towards5gs-helm-github</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/rahasak/deploying-5g-core-network-with-free5gc-kubernets-and-helm-charts-29741cea3922">Deploying 5G core network with Free5GC, Kubernetes and Helm</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/rahasak/deploying-5g-core-network-with-free5gc-kubernets-and-helm-charts-29741cea3922">Kubernetes環境でfree 5GCを動かすまで</a> </li>
<li><a target="_blank" rel="noopener" href="https://qiita.com/wzm/items/0dbe928ed891d82380d6">kubernetes cluster上にfree5gcを構築してみる</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2023/10/23/Deploy-free5GC-with-k8s-and-helm/" data-id="cmkjfu8xw0001ecurgtzb27zv" data-title="Deploy free5GC with k8s and helm" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/k8s-helm/" rel="tag">k8s, helm</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Cloud-native-and-its-implementation-in-Telco" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/08/24/Cloud-native-and-its-implementation-in-Telco/" class="article-date">
  <time class="dt-published" datetime="2023-08-24T04:48:22.000Z" itemprop="datePublished">2023-08-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/Learning/">Learning</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/08/24/Cloud-native-and-its-implementation-in-Telco/">Cloud native and its implementation in Telco</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Cloud-native-in-telecom"><a href="#Cloud-native-in-telecom" class="headerlink" title="Cloud native in telecom"></a>Cloud native in telecom</h1><p><strong>Right now it is unclear what is the concept of Cloud Native and what is its implementations, so main goal of this blog is to simply introduce the basic concept and how Cloud Native is composed.</strong></p>
<h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><ol>
<li><a href="#what-is-cloud-native">What is Cloud Native？</a></li>
<li><a href="#basic-principles-and-conponents-of-cloud-native">Basic principles and components of Cloud Native</a></li>
<li><a href="#cloud-native-design-priciples">Cloud Native design principles</a><ol>
<li><a href="#agnosticism">Agnosticism</a></li>
<li><a href="#software-decomposition-and-life-cycle-management">Software decomposition and Life Cycle Management</a></li>
</ol>
</li>
<li><a href="#qas">Some Q&amp;As</a></li>
</ol>
<h2 id="What-is-Cloud-Native？"><a href="#What-is-Cloud-Native？" class="headerlink" title="What is Cloud Native？"></a>What is Cloud Native？</h2><p>Cloud native is not a particular product or technology. Instead, it’s a principle, a business pattern. Cloud Native is a term that describes the patterns of organizations, architectures and technologies that consistently, reliably and at scale fully takes advantage of the possibilities of the cloud to support cloud-oriented business models. It is the combination of different kinds of best practices.Enterprise and developers use technologies based on Cloud Native such as CI&#x2F;CD, container and microservices to achieve high availability, high reliability scalability and lower Time To Market and delivery.</p>
<h2 id="Basic-principles-and-components-of-Cloud-Native"><a href="#Basic-principles-and-components-of-Cloud-Native" class="headerlink" title="Basic principles and components of Cloud Native"></a>Basic principles and components of Cloud Native</h2><p>What can Cloud Native bring us?</p>
<ul>
<li>Speed: Fast introduction of new services</li>
<li>Scale: Easily expand from hundreds of users to millions</li>
<li>Performance: Optimized capacity throughput and resource utilization</li>
<li>Efficiency : Low cost for both Speed and Scale. Automation, zero-touch operations, legacy and new services, life-cycle independence for both Services and<br>Infrastructure</li>
</ul>
<p>Therefore, target of Cloud Native is to achieve higher TTM(Time to) and lower TCO(Total Cost of Ownership) without sacrificing service reliability and performance. Let’s see what are the basic components of Cloud Native.</p>
<ul>
<li>Cloud Native Applications</li>
<li>Microservice</li>
<li>APIs</li>
<li>Containers and container orchestration</li>
<li>Other automating tools</li>
<li>Cloud native friendly infrastructures(Public clouds，private clouds，mixture clouds)</li>
</ul>
<p>Like I mentioned earlier, cloud native doesn’t only contain technologies, but also idea and behavior patterns. Let’s see what needs to be considered in mind about cloud native.</p>
<ul>
<li>CI&#x2F;CD (Continuous delivery and continuous integration)</li>
<li>Highly automated (includes CI&#x2F;CD，along with auto monitoring，data handling and analysis with ability to anomaly detection)</li>
<li>Embrace actively to open source and collaboration with CNCF (cloud native computing foundation): CNCF is an open source Cloud Native organization, it is responsible to develop and maintain crucial parts close related to Cloud Native. Please refer to their <a target="_blank" rel="noopener" href="https://www.cncf.io/">website</a>.</li>
</ul>
<p>To sum-up, a company need to achieve the following to completely take the advantage of cloud native.</p>
<ol>
<li>Posses complete infrastructure and environments for cloud native applications</li>
<li>Have the ideal of automation on duplicated process</li>
<li>Contribute to open source society, continuous delivery of value to the user</li>
</ol>
<p><img src="https://s2.loli.net/2023/09/14/2uHknclWej18IiB.png" alt="Cloud native requires both infrastructure and development patterns to reach the target."></p>
<h2 id="Cloud-Native-design-principles"><a href="#Cloud-Native-design-principles" class="headerlink" title="Cloud Native design principles"></a>Cloud Native design principles</h2><p>Let’s talk about the design principles of cloud native application. Since it is one of the most important parts in the whole could native concept and it is rather new in the industry.  Graph below describes the basic principles need to considered before deploying and designing cloud native applications.</p>
<p><img src="https://s2.loli.net/2024/02/21/s6AUd5MEwOl9IDV.png" alt="Cloud Native Application Design Principles"></p>
<h3 id="Agnosticism"><a href="#Agnosticism" class="headerlink" title="Agnosticism"></a>Agnosticism</h3><p>Cloud native applications need to to be agnostic to the underlying cloud infrastructure. Although this does not necessarily apply to the traditional Cloud Native players like Netflix and Uber since they control the full stack that they are deploying their application on.<br>As we evolve the cloud infrastructure towards supporting container infrastructure (CaaS) the agnosticism requirements remain but the challenges are different. A CNA requires a CaaS and must be able to be deployed on whatever CaaS and IaaS combination that an operator has in their cloud environment, see figure below for CNA agnosticism scenario. A CNA must be able to run on any modern kernel without requiring any proprietary additions. Optional use of plug-ins for optimizing performance is allowed.</p>
<p><img src="https://s2.loli.net/2023/10/18/ctJGAWqylKeRxuz.png" alt="Agnosticism explained"></p>
<h3 id="Software-decomposition-and-Life-Cycle-Management"><a href="#Software-decomposition-and-Life-Cycle-Management" class="headerlink" title="Software decomposition and Life Cycle Management"></a>Software decomposition and Life Cycle Management</h3><p>Another important principle is for CNA itself, which requires CNA to be decomposed into smaller, more manageable pieces. This is usually done through utilizing a microservice architecture (MSA). MSA is a design pattern that strives to structure an application as a collection of loosely coupled stateless services.<br><img src="https://s2.loli.net/2023/10/23/KhxQlkCBGo7WI9z.png" alt="Microservice architecture"><br>This concept is not new in only for cloud native, dividing code into more manageable pieces and call them “code modules” or “software components” has always been a good practice in software development. However, in cloud native realm, those software components, AKA microservices, now have a well bounded scope and can be individually deploys, scaled and upgrade using CaaS environment. In addition, microservices have their own defines and version-controlled network-based interfaces to communicate with each other, which enables the lifecycle management for each microservice.</p>
<h4 id="Scaling"><a href="#Scaling" class="headerlink" title="Scaling"></a>Scaling</h4><h4 id="Upgrade"><a href="#Upgrade" class="headerlink" title="Upgrade"></a>Upgrade</h4><h2 id="Q-amp-As"><a href="#Q-amp-As" class="headerlink" title="Q&amp;As"></a>Q&amp;As</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2023/08/24/Cloud-native-and-its-implementation-in-Telco/" data-id="cmkjfu8xt0000ecur132whdv9" data-title="Cloud native and its implementation in Telco" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Cloud-native/" rel="tag">Cloud native</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-k8s-templates" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/06/05/k8s-templates/" class="article-date">
  <time class="dt-published" datetime="2023-06-05T09:07:29.000Z" itemprop="datePublished">2023-06-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/06/05/k8s-templates/">k8s templates</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Config-templates-for-K8s"><a href="#Config-templates-for-K8s" class="headerlink" title="Config templates for K8s"></a>Config templates for K8s</h1><h3 id="YAML-description-file-for-pods"><a href="#YAML-description-file-for-pods" class="headerlink" title="YAML description file for pods"></a>YAML description file for pods</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span> </span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cmd</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;args&quot;</span></span><br><span class="line">    <span class="comment"># or </span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;somecommand&quot;</span>]</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="attr">args:</span> [<span class="string">&quot;some_args&quot;</span>]</span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">initContainers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sth</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">sth</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sidecar</span>  </span><br><span class="line">    <span class="attr">image:</span> <span class="string">sidecar_image</span></span><br></pre></td></tr></table></figure>

<p>ENV VAR for pods</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ENV_VAR_NAME</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">ENV_VAR_VALUE</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="Template-for-configmap"><a href="#Template-for-configmap" class="headerlink" title="Template for configmap"></a>Template for configmap</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">  <span class="attr">name:</span> <span class="string">&lt;ConfigMap_Name&gt;</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="string">&lt;key_name&gt;:</span> <span class="string">&lt;value_name&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Template-for-secret"><a href="#Template-for-secret" class="headerlink" title="Template for secret"></a>Template for secret</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># need to convert k-v data into coded form</span></span><br><span class="line"><span class="comment"># echo -n &#x27;&lt;plain_text&gt;&#x27; | base64</span></span><br><span class="line"><span class="comment"># echo -n &#x27;&lt;secret_text&gt;&#x27; | base64 --decode</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">  <span class="attr">name:</span> <span class="string">&lt;secret_Name&gt;</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="string">&lt;key_name&gt;:</span> <span class="string">&lt;value_name&gt;</span></span><br><span class="line">  <span class="string">&lt;key_name_1&gt;:</span> <span class="string">&lt;Pwd_1&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Inject-configmap-and-secrets-to-pods"><a href="#Inject-configmap-and-secrets-to-pods" class="headerlink" title="Inject configmap and secrets to pods"></a>Inject configmap and secrets to pods</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span></span><br><span class="line">    <span class="attr">image:</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> </span><br><span class="line">    <span class="attr">envFrom:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">configMapRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">&lt;config_map_name&gt;</span></span><br><span class="line">        <span class="attr">secretRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">&lt;secret_name&gt;</span></span><br><span class="line">  </span><br><span class="line">      </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">env:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span></span><br><span class="line">    <span class="attr">valueFrom:</span></span><br><span class="line">      <span class="attr">configMapKeyRef:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&lt;config_map_name&gt;</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">&lt;some_keys_of_cmap&gt;</span></span><br><span class="line">      <span class="attr">secretKeyRef:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&lt;secret_name&gt;</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">&lt;some_keys&gt;</span></span><br><span class="line">      </span><br></pre></td></tr></table></figure>




<h3 id="YAML-description-file-for-replication-sets"><a href="#YAML-description-file-for-replication-sets" class="headerlink" title="YAML description file for replication-sets"></a>YAML description file for replication-sets</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>  <span class="comment"># error: unable to recognize &quot;filename.yml&quot;: no matches for /, kind=ReplicaSet appears if apiVersion was set to v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicaSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myrs</span></span><br><span class="line">  <span class="attr">namespace:</span> [<span class="string">ns</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">	    <span class="attr">labels:</span> </span><br><span class="line">	      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">		    <span class="attr">type:</span> <span class="string">front-end</span></span><br><span class="line">	  <span class="attr">spec:</span></span><br><span class="line">	    <span class="attr">containers:</span></span><br><span class="line">	    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-containers</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span> </span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">front-end</span></span><br></pre></td></tr></table></figure>

<h3 id="YAML-description-file-for-deployments"><a href="#YAML-description-file-for-deployments" class="headerlink" title="YAML description file for deployments"></a>YAML description file for deployments</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my_deploy</span></span><br><span class="line">  <span class="attr">namespace:</span> [<span class="string">ns</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="string">metadata:[]</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">	    <span class="attr">labels:</span> </span><br><span class="line">	      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">		    <span class="attr">type:</span> <span class="string">front-end</span></span><br><span class="line">	  <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">securityContext:</span> <span class="comment"># also can be put under &quot;containers&quot; to choose appling context in pod or container scope</span></span><br><span class="line">        <span class="attr">runAsUser:</span> <span class="number">1000</span> <span class="comment"># define what user to run in the pod</span></span><br><span class="line">        <span class="attr">capabilities:</span></span><br><span class="line">          <span class="attr">add:</span> [<span class="string">&quot;MAC_ADMIN&quot;</span>]</span><br><span class="line">	    <span class="attr">containers:</span></span><br><span class="line">	    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dockerhub_url/nginx-containers</span></span><br><span class="line">		    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">imagePullSecrets:</span> <span class="comment"># image security, docker hub username/pwd secret object</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&lt;docker-registry-secret-name&gt;</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">front-end</span></span><br></pre></td></tr></table></figure>

<h3 id="YAML-description-file-for-DaemonSet"><a href="#YAML-description-file-for-DaemonSet" class="headerlink" title="YAML description file for DaemonSet"></a>YAML description file for DaemonSet</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVsesion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myrs</span></span><br><span class="line">  <span class="attr">namespace:</span> [<span class="string">ns</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">	    <span class="attr">labels:</span> </span><br><span class="line">	      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">		    <span class="attr">type:</span> <span class="string">front-end</span></span><br><span class="line">	  <span class="attr">spec:</span></span><br><span class="line">	    <span class="attr">containers:</span></span><br><span class="line">	    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">monitoring-agent</span></span><br><span class="line">		    <span class="attr">image:</span> <span class="string">monitoring-agent</span></span><br><span class="line">  <span class="attr">selector:</span> </span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">front-end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="YAML-description-file-for-Services"><a href="#YAML-description-file-for-Services" class="headerlink" title="YAML description file for Services"></a>YAML description file for Services</h3><ul>
<li>Nodeport</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVsersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp-service</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span> <span class="comment"># type of service</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targetPort:</span> <span class="number">80</span> <span class="comment"># port want to access on the pod</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span> <span class="comment"># mapping port on service</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30008</span> <span class="comment"># port expose to outside</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment"># links the service to the pod by pod labels</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">	  <span class="attr">type:</span> <span class="string">front-end</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Clusterip</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVsersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">back-end</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span> <span class="comment"># type of service</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targetPort:</span> <span class="number">80</span> <span class="comment"># port exposed from backends</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span> <span class="comment"># mapping port from service</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment"># links the service to the pod by pod labels</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">	  <span class="attr">type:</span> <span class="string">front-end</span></span><br></pre></td></tr></table></figure>


<h3 id="YAML-description-file-for-NameSpace"><a href="#YAML-description-file-for-NameSpace" class="headerlink" title="YAML description file for NameSpace"></a>YAML description file for NameSpace</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>

<h3 id="YAML-description-file-for-NameSpace-quota"><a href="#YAML-description-file-for-NameSpace-quota" class="headerlink" title="YAML description file for NameSpace quota"></a>YAML description file for NameSpace quota</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ResourceQuota</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">compute-quota</span></span><br><span class="line">  <span class="attr">namespace:</span> [<span class="string">ns_name</span>]</span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hard:</span></span><br><span class="line">    <span class="attr">pods:</span> <span class="string">&quot;10&quot;</span></span><br><span class="line">    <span class="attr">requests.cpu:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line">    <span class="attr">requests.memory:</span> <span class="string">5Gi</span></span><br><span class="line">    <span class="attr">limits.cpu:</span> <span class="string">&quot;10&quot;</span></span><br><span class="line">    <span class="attr">limits.memory:</span> <span class="string">10Gi</span></span><br></pre></td></tr></table></figure>

<h3 id="Limit-range-for-resource-management"><a href="#Limit-range-for-resource-management" class="headerlink" title="Limit range for resource management"></a>Limit range for resource management</h3><p><strong>only affect on creation</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">LimitRange</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> [<span class="string">name</span>]</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">limits:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">default:</span></span><br><span class="line">      <span class="attr">cpu:</span></span><br><span class="line">    <span class="attr">defaultRequest:</span></span><br><span class="line">      <span class="attr">cpu:</span> </span><br><span class="line">    <span class="attr">max:</span></span><br><span class="line">      <span class="attr">cpu:</span></span><br><span class="line">    <span class="attr">min:</span></span><br><span class="line">      <span class="attr">cpu:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Container</span>  </span><br></pre></td></tr></table></figure>


<h3 id="Allocate-pods-to-deploy-on-modified-scheduler"><a href="#Allocate-pods-to-deploy-on-modified-scheduler" class="headerlink" title="Allocate pods to deploy on modified scheduler"></a>Allocate pods to deploy on modified scheduler</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># on pod definition file</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedulerName:</span> <span class="string">&lt;scheduler-name&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Allocate-the-priority-to-be-scheduled-in-the-queue"><a href="#Allocate-the-priority-to-be-scheduled-in-the-queue" class="headerlink" title="Allocate the priority to be scheduled in the queue"></a>Allocate the priority to be scheduled in the queue</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">priorityClassName:</span> <span class="string">high-priority</span></span><br></pre></td></tr></table></figure>

<h3 id="description-file-for-CSR"><a href="#description-file-for-CSR" class="headerlink" title="description file for CSR"></a>description file for CSR</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">certificates.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CertificateSigningRequest</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">somename</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">expirationSeconds:</span> <span class="number">600</span></span><br><span class="line">  <span class="attr">usages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">digital</span> <span class="string">signature</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">key</span> <span class="string">encipherment</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">server</span> <span class="string">auth</span></span><br><span class="line">  <span class="attr">request:</span> <span class="string">&lt;BASE64_encoded</span> <span class="string">CSR_info&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Definition-file-for-kubeconfig"><a href="#Definition-file-for-kubeconfig" class="headerlink" title="Definition file for kubeconfig"></a>Definition file for kubeconfig</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">clusters:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">cluster:</span></span><br><span class="line">    <span class="attr">certificate-authority:</span> <span class="string">/path_to_ca_crt</span></span><br><span class="line">    <span class="comment"># or</span></span><br><span class="line">    <span class="attr">certificate-authority-data:</span> <span class="string">&lt;base64&gt;</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">https://controlplane:6443</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes</span></span><br><span class="line"></span><br><span class="line"><span class="attr">contexts:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">context:</span></span><br><span class="line">    <span class="attr">cluster:</span> <span class="string">kubernetes</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">kubernetes-admin</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes-admin@kubernetes</span></span><br><span class="line"><span class="attr">current-context:</span> <span class="string">kubernetes-admin@kubernetes</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Config</span></span><br><span class="line"><span class="attr">preferences:</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">users:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubernetes-admin</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">client-certificate-data:</span> <span class="string">&lt;base64&gt;</span></span><br><span class="line">    <span class="attr">client-key-data:</span> <span class="string">&lt;base64&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="role-definition-file"><a href="#role-definition-file" class="headerlink" title="role definition file"></a>role definition file</h3><ul>
<li>namespace-based resource role definition<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">developer</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">&lt;namespace_name&gt;</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;list&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>]</span><br></pre></td></tr></table></figure></li>
<li>cluster role definition file<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">role_definition_name</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;nodes&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;list&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>]  </span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="link-user-to-role-role-binding-definition"><a href="#link-user-to-role-role-binding-definition" class="headerlink" title="link user to role, role binding definition"></a>link user to role, role binding definition</h3><ul>
<li>namespace-based resource role binding<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">devuser-developer-binding</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev-user</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">developer</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure></li>
<li>cluster role binding</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluter-binding</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-admin</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-administrator</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="network-policy-definition"><a href="#network-policy-definition" class="headerlink" title="network policy definition"></a>network policy definition</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">NetworkPolicy</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-network-policy</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">podSelector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">role:</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">policyTypes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Ingress</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Egress</span></span><br><span class="line">  <span class="attr">ingress:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">from:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">ipBlock:</span></span><br><span class="line">        <span class="attr">cidr:</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line">        <span class="attr">except:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">172.17</span><span class="number">.1</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">namespaceSelector:</span></span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">project:</span> <span class="string">myproject</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">podSelector:</span>  <span class="comment"># or</span></span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">role:</span> <span class="string">frontend</span></span><br><span class="line">    <span class="attr">ports:</span>  <span class="comment"># and </span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">egress:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">to:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">ipBlock:</span></span><br><span class="line">        <span class="attr">cidr:</span> <span class="number">10.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">5978</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="Storage-definition-files"><a href="#Storage-definition-files" class="headerlink" title="Storage definition files"></a>Storage definition files</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">spec:</span></span><br><span class="line">    <span class="attr">containers:</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">&lt;dir_in_container&gt;</span> <span class="comment"># directory in container which you need to store file</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&lt;volume_name&gt;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&lt;volume_name&gt;</span></span><br><span class="line">      <span class="attr">hostPath:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">&lt;dir_mounted_path&gt;</span> <span class="comment"># path outside container which you need to store data on </span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">Directory</span></span><br><span class="line">      <span class="comment"># or</span></span><br><span class="line">      <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">        <span class="attr">claimName:</span> <span class="string">&lt;pvclaim_name&gt;</span></span><br><span class="line"><span class="comment"># this will cause directory created on every node in multi-node env</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>persistent volume</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv0003</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">5Gi</span></span><br><span class="line">  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Recycle/Retain/Delete</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">slow</span></span><br><span class="line">  <span class="attr">mountOptions:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">hard</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nfsvers=4.1</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/tmp</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># or</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hostPath:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">&lt;dir_local_storage_path&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>persistent volume claim: bind to persistent volume</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myclaim</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span> </span><br><span class="line">  <span class="attr">volumeName:</span> <span class="string">&lt;name_of_volume&gt;</span> <span class="comment"># match what pv you want to bind</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">8Gi</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">slow</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">release:</span> <span class="string">&quot;stable&quot;</span></span><br><span class="line">    <span class="attr">matchExpressions:</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="string">environment</span>, <span class="attr">operator:</span> <span class="string">In</span>, <span class="attr">values:</span> [<span class="string">dev</span>]&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>If a pvc is deleted before the deletion of pod, it will stuck in terminating state.</strong></p>
</li>
<li><p>attach pvc to pod</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mypod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myfrontend</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">&quot;/var/www/html&quot;</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">mypd</span> <span class="comment"># name should match with name under volumes</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mypd</span>  <span class="comment"># should be same with name under volumeMounts</span></span><br><span class="line">      <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">        <span class="attr">claimName:</span> <span class="string">myclaim</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>storage class: allowed for automatically provision volume</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">standard</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">kubernetes.io/example</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">pd-standard</span></span><br><span class="line"><span class="attr">volumeBindingMode:</span> <span class="string">WaitForFirstConsumer</span></span><br><span class="line"><span class="attr">allowedTopologies:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">matchLabelExpressions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">topology.kubernetes.io/zone</span></span><br><span class="line">    <span class="attr">values:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">us-central-1a</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">us-central-1b</span></span><br></pre></td></tr></table></figure>
<p>then update pvc-definition file with:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">&lt;SC_NAME&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>priority class: for pod and resource that want to gain higher priority. Default value is 0. Higher value means higher priority.</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">scheduling.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PriorityClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">high-priority</span></span><br><span class="line"><span class="attr">value:</span> <span class="number">1000000000</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&quot;Mission critical pods&quot;</span></span><br><span class="line"><span class="attr">preemptionPolicy:</span> <span class="string">PreemptLowerPriority(default)/never</span> <span class="comment"># Whether to premmpt lower priority pod or not</span></span><br></pre></td></tr></table></figure>
<p>After created add to pod’s spec</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">priorityClassName:</span> <span class="string">high-priority</span></span><br></pre></td></tr></table></figure>


<h3 id="Cronjob-definition-files"><a href="#Cronjob-definition-files" class="headerlink" title="Cronjob definition files:"></a>Cronjob definition files:</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ppi</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&quot;*/5 * * * *&quot;</span></span><br><span class="line">  <span class="attr">successfulJobsHistoryLimit:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">failedJobsHistoryLimit:</span> <span class="number">4</span></span><br><span class="line">  <span class="attr">jobTemplate:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">	  <span class="attr">activeDeadlineSeconds:</span> <span class="number">8</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pi</span></span><br><span class="line">            <span class="attr">image:</span> <span class="string">perl:5</span></span><br><span class="line">            <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">            <span class="attr">command:</span> [<span class="string">&quot;perl&quot;</span>, <span class="string">&quot;-Mbignum=bpi&quot;</span>, <span class="string">&quot;-wle&quot;</span>, <span class="string">&quot;print bpi(2000)&quot;</span>]</span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><code>spec.successfulJobsHistoryLimit</code> and  <code>spec.failedJobsHistoryLimit</code>: defines how many job history remains after failure&#x2F;success. Default successful&#x2F;failed is 3&#x2F;1. </li>
<li><code>jobTemplate.spec.activeDeadlineSeconds</code>: this means after how long will the job get terminated no matter  <code>jobTemplate.spec.backoffLimit</code> is reached or not</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2023/06/05/k8s-templates/" data-id="cmkjfu8yd0015ecurg2y67map" data-title="k8s templates" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/K8s/" rel="tag">K8s</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-K8s-TS-hints" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/06/05/K8s-TS-hints/" class="article-date">
  <time class="dt-published" datetime="2023-06-05T07:00:30.000Z" itemprop="datePublished">2023-06-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/troubleshooting/">troubleshooting</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/06/05/K8s-TS-hints/">K8s TS hints</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Provide-some-basic-point-of-view-for-troubleshooting-K8s"><a href="#Provide-some-basic-point-of-view-for-troubleshooting-K8s" class="headerlink" title="Provide some basic point of view for troubleshooting K8s"></a>Provide some basic point of view for troubleshooting K8s</h1><h3 id="ImagePullBackoff"><a href="#ImagePullBackoff" class="headerlink" title="ImagePullBackoff"></a>ImagePullBackoff</h3><ol>
<li>This usually indicates something wrong with the pod description yaml file. Check name under <code>image: </code><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis123</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="unable-to-recognize-“something-yaml”"><a href="#unable-to-recognize-“something-yaml”" class="headerlink" title="unable to recognize “something.yaml”"></a>unable to recognize “something.yaml”</h3><ol>
<li>if “no matches for &#x2F; , kind&#x3D;ReplicaSet” . Possibly the apiVersion problem. Make sure it is <code>apps/v1</code><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="please-apply-your-changes-to-the-latest-version-and-try-again-error"><a href="#please-apply-your-changes-to-the-latest-version-and-try-again-error" class="headerlink" title="please apply your changes to the latest version and try again error"></a>please apply your changes to the latest version and try again error</h3><ol>
<li>This error after <code>kubectl apply</code> indicates that you should acquire the newest yaml file after you did some changes to the parts without modyfing the yaml file.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get replicaset name_of_replicaset -o yaml &gt;&gt; something.yaml</span><br><span class="line"></span><br><span class="line">kubectl replace/apply -f something.yaml</span><br></pre></td></tr></table></figure>

<h3 id="Do-not-add-extra-name-after-pods-name-when-creating-pods-imperatively"><a href="#Do-not-add-extra-name-after-pods-name-when-creating-pods-imperatively" class="headerlink" title="Do not add extra name after [pods_name] when creating pods imperatively"></a>Do not add extra name after [pods_name] when creating pods imperatively</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run &lt;pods_name&gt; &lt;args&gt; --image=&lt;image_name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Things-todo-if-kubectl-command-ceased-responding"><a href="#Things-todo-if-kubectl-command-ceased-responding" class="headerlink" title="Things todo if kubectl command ceased responding"></a>Things todo if kubectl command ceased responding</h3><ul>
<li>check logs under <code>/var/log/container</code></li>
<li>use <code>crictl</code> command <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">crictl ps -a</span><br><span class="line">crictl logs container-id</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">docker ps </span><br><span class="line">docker logs</span><br><span class="line"><span class="comment"># </span></span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2023/06/05/K8s-TS-hints/" data-id="cmkjfu8y00005ecurhtbs2lrh" data-title="K8s TS hints" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/K8s/" rel="tag">K8s</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-K8s-cmds" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/06/05/K8s-cmds/" class="article-date">
  <time class="dt-published" datetime="2023-06-05T01:57:16.000Z" itemprop="datePublished">2023-06-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/commands/">commands</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/06/05/K8s-cmds/">K8s cmds</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Basic-K8s-Commands"><a href="#Basic-K8s-Commands" class="headerlink" title="Basic K8s-Commands"></a>Basic K8s-Commands</h1><h2 id="Cluster-logs"><a href="#Cluster-logs" class="headerlink" title="Cluster logs"></a>Cluster logs</h2><ul>
<li>Get cluster nodes logs <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl cluster-info dump --output-directory cluster_info_dump_$(<span class="built_in">uname</span> -n)  -A</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="View-and-modify-kubectl-configs"><a href="#View-and-modify-kubectl-configs" class="headerlink" title="View and modify kubectl configs"></a>View and modify kubectl configs</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl config view</span><br><span class="line"><span class="comment"># file is located in ~/.kube/config</span></span><br></pre></td></tr></table></figure>
<ul>
<li>change to use other context to access the cluster<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context &lt;name&gt;@&lt;cluster&gt; --kubeconfig /path_to_config_file</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ETCD-related-commands"><a href="#ETCD-related-commands" class="headerlink" title="ETCD related commands"></a>ETCD related commands</h2><ul>
<li><p>ETCDCTL version 2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">etcdctl backup</span><br><span class="line">etcdctl cluster-health</span><br><span class="line">etcdctl mk</span><br><span class="line">etcdctl <span class="built_in">mkdir</span></span><br><span class="line">etcdctl <span class="built_in">set</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ETCDCTL version 3</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">etcdctl snapshot save </span><br><span class="line">etcdctl endpoint health</span><br><span class="line">etcdctl get</span><br><span class="line">etcdctl put</span><br><span class="line">etcdctl member list  <span class="comment"># check how many nodes are managed by etcd server</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Set version of version</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ETCDCTL_API = 3</span><br></pre></td></tr></table></figure>
<p><strong>When API version is not set, it is assumed to be set to version 2.</strong></p>
</li>
<li><p>For ETCDCTL to authenticate to the ETCD API server, the certificate files are available in the etcd-master.</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--cacert /etc/kubernetes/pki/etcd/ca.crt     </span><br><span class="line">--cert /etc/kubernetes/pki/etcd/server.crt     </span><br><span class="line">--key /etc/kubernetes/pki/etcd/server.key</span><br></pre></td></tr></table></figure>

<p>In total:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> etcd-master -n kube-system -- sh -c <span class="string">&quot;ETCDCTL_API=3 etcdctl get / --prefix --keys-only --limit=10 --cacert /etc/kubernetes/pki/etcd/ca.crt --cert /etc/kubernetes/pki/etcd/server.crt  --key /etc/kubernetes/pki/etcd/server.key&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>set ETCD snapshot<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># create snapshot for ETCD</span></span><br><span class="line">    ETCDCTL_API=3 etcdctl \</span><br><span class="line">        snapshot save snahpshot.db</span><br><span class="line">    <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># check status of ETCD</span></span><br><span class="line">    ETCDCTL_API=3 etcdctl \</span><br><span class="line">        snapshot status snapshot.db</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>Procedures to restore ETCD from snapshot</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># stop api-server</span></span><br><span class="line">    service kube-apiserver stop</span><br><span class="line"><span class="comment"># restore ETCD from snapshot, this created a brand new ETCD cluster</span></span><br><span class="line">    ETCDCTL_API=3 etcdctl \</span><br><span class="line">        snapshot restore &lt;snapshot_name&gt; \ </span><br><span class="line">        --data-dir /var/lib/etcd-from-backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify etcd.service under defination file to use the assigned data-dir</span></span><br><span class="line">--data-dir=/var/lib/etcd-from-back-up</span><br><span class="line"></span><br><span class="line">    systemctl daemon-reload</span><br><span class="line">    service kube-apiserver start</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>Restore etcd as external server</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># Execute restore on etcd server, same</span></span><br><span class="line">    </span><br><span class="line">    ETCDCTL_API=3 etcdctl \</span><br><span class="line">        snapshot restore &lt;snapshot_name&gt; \ </span><br><span class="line">        --data-dir /var/lib/etcd-from-backup</span><br><span class="line"><span class="comment"># Modify data-dir, make sure owner is correct</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">chown</span> -R etcd:etcd /var/lib/etcd-from-backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># Modify configurations</span></span><br><span class="line">    vi etc/systemd/system/etcd.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># Restart</span></span><br><span class="line">    systemctl daemon-reload</span><br><span class="line">    systemctl restart etcd</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<ul>
<li><p>Check if ETCD is stacked or external server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -n kube-system</span><br><span class="line"><span class="comment"># If etcd is shown as pods in kube-system, then it is stacked ETCD.</span></span><br><span class="line"><span class="comment"># or </span></span><br><span class="line">kubectl describe apiserver -n kube-system</span><br><span class="line"><span class="comment"># URL in it shows hos apiserver communicate with ETCD</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Check status on external server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep -i nels</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Kube-API-commands"><a href="#Kube-API-commands" class="headerlink" title="Kube-API commands"></a>Kube-API commands</h2><ul>
<li>View api-server thru kubeadm, kubeadm deploys kube-api as a pod in the kube-system namespace on the master node.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -n kube-system</span><br></pre></td></tr></table></figure>

<ul>
<li>view api-server options with kubeadmin</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/kubernets/manifests/kube-apiserver.yaml</span><br></pre></td></tr></table></figure>

<ul>
<li>view api-server options without kubeadmin</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/systemd/system/kube-apiserver.service</span><br></pre></td></tr></table></figure>

<p>checking active process of apiserver by</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep kube-apiserver</span><br></pre></td></tr></table></figure>

<ul>
<li><p>add username&#x2F;password or token and securely access to api-server (most insecure)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add username/password info in .csv</span></span><br><span class="line"><span class="comment"># then specify the related file</span></span><br><span class="line"><span class="string">--basic-auth-file=user_info.csv</span></span><br><span class="line"><span class="comment"># kube-apiserver.service</span></span><br><span class="line"><span class="comment"># or pod defination file under /etc/kubernetes/manifests</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># use curl command to securely access to api server</span></span><br><span class="line"><span class="string">curl</span> <span class="string">-v</span> <span class="string">-k</span> <span class="string">&lt;url_to_api_server:6443/api/v1/pods</span> <span class="string">--header</span> <span class="string">&quot;Authorization: Bearer &lt;token&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># or </span></span><br><span class="line"><span class="string">curl</span> <span class="string">-v</span> <span class="string">-k</span> <span class="string">&lt;url&gt;</span> <span class="string">-u</span> <span class="string">&quot;user:pass&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>RBAC related commands</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl get roles</span><br><span class="line">kubectl get rolebindings</span><br><span class="line">kubectl describe role developer</span><br><span class="line">kubectl auth can-i &lt;<span class="built_in">command</span> &gt; --as &lt;usergroup&gt; <span class="comment"># for example create deployments</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Kube-controller-manager"><a href="#Kube-controller-manager" class="headerlink" title="Kube controller manager"></a>Kube controller manager</h2><ul>
<li>check status with the deployment by kubeadmin</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kube get pods -n kube-system</span><br></pre></td></tr></table></figure>
<ul>
<li>view options with kubeadmin</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/kubernetes/manifests/kube-controller-manager.yaml</span><br></pre></td></tr></table></figure>
<ul>
<li>view options without kubeadmin</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/systemd/system/kube-controller-manaer.service</span><br></pre></td></tr></table></figure>
<ul>
<li>check process of kube controller manager</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep kube-controller-manager</span><br></pre></td></tr></table></figure>
<ul>
<li>CSR related command</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get csr</span><br><span class="line">kubectl certificate approve</span><br><span class="line">kubectl get csr &lt;name&gt; -o yaml</span><br></pre></td></tr></table></figure>
<h2 id="Kube-scheduler"><a href="#Kube-scheduler" class="headerlink" title="Kube-scheduler"></a>Kube-scheduler</h2><ul>
<li>View kube scheduler thru kubeadm</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/kubernetes/manifests/kube-scheduler.yaml</span><br></pre></td></tr></table></figure>
<ul>
<li>Check thru process</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep kube-scheduler</span><br></pre></td></tr></table></figure>


<h2 id="Run-pods"><a href="#Run-pods" class="headerlink" title="Run pods"></a>Run pods</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run &lt;name&gt; --image=&lt;image_name&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Check pods location</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -o wide</span><br></pre></td></tr></table></figure></li>
<li><p>Check pods manifest (able to export as yaml) </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods &lt;pods_name&gt; -o yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>apply changes to pod </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f </span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Work-with-replicasets"><a href="#Work-with-replicasets" class="headerlink" title="Work with replicasets"></a>Work with replicasets</h2><ul>
<li>Create&#x2F;update replicaset</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f desfilename.yaml</span><br></pre></td></tr></table></figure>

<ul>
<li>Check status of replicaset</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get replicaset &lt;name_of_replicaset&gt;</span><br><span class="line">kubectl describe replicaset name_of_replicaset</span><br></pre></td></tr></table></figure>

<ul>
<li>scale up&#x2F;down without modifying the yaml file.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale --replicas=6 replicaset (<span class="built_in">type</span>) myapp-replicaset (name <span class="keyword">in</span> the metadata) <span class="comment"># or</span></span><br><span class="line"></span><br><span class="line">kubectl scale --replicas=6 -f desfilename.yaml</span><br></pre></td></tr></table></figure>

<ul>
<li>scale up&#x2F;down by modifying the yaml file first <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get replicaset &lt;name_of_replicaset&gt; -o yaml &gt; something.yaml</span><br><span class="line"></span><br><span class="line">kubectl replace/apply -f something.yaml <span class="comment"># able to recreate node</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Kubelet"><a href="#Kubelet" class="headerlink" title="Kubelet"></a>Kubelet</h2><p>Configuration file of kubelet is located at </p>
<figure class="highlight plaintext"><figcaption><span>``` or</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">```/etc/kubernetes/kubelet.conf ```</span><br><span class="line"></span><br><span class="line">## Deployment</span><br><span class="line"></span><br><span class="line">- create deployment by commands</span><br><span class="line"></span><br><span class="line">``` bash</span><br><span class="line">    kubectl create deployment --image=&lt;image_name&gt; &lt;deploy_name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>by configuration file</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f deploy_des_file.yml</span><br><span class="line">kubectl get deployments</span><br></pre></td></tr></table></figure>
</li>
<li><p>edit deployment</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit deployement &lt;name&gt;</span><br></pre></td></tr></table></figure>
<p><strong>Note that only the following is editable when pod is running.</strong></p>
<p>  spec.containers[*].image</p>
<p>  spec.initContainers[*].image</p>
<p>  spec.activeDeadlineSeconds</p>
<p>  spec.tolerations</p>
<p>  spec.terminationGracePeriodSeconds</p>
</li>
</ul>
<h3 id="Generate-deployment-yaml-file-without-creating-it"><a href="#Generate-deployment-yaml-file-without-creating-it" class="headerlink" title="Generate deployment yaml file without creating it"></a>Generate deployment yaml file without creating it</h3><ul>
<li><p>POD manifest</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run &lt;pod_name&gt; --image=&lt;image_name&gt; --dry-run=client -o yaml</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create Deployment YAML file</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create deployment &lt;deployment_name&gt; --image=&lt;image_name&gt; --dry-run=client -o yaml</span><br></pre></td></tr></table></figure>

<h3 id="Check-deployment-rollout-and-update-pods"><a href="#Check-deployment-rollout-and-update-pods" class="headerlink" title="Check deployment rollout and update pods"></a>Check deployment rollout and update pods</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout status deployment/&lt;deployment_name&gt;</span><br><span class="line"></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment/&lt;deployment_name&gt; <span class="comment">#Check rollout history</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># update pods</span></span><br><span class="line">kubectl apply -f deployment-definition.yml <span class="comment"># after edit image spec in definination, apply it</span></span><br><span class="line"></span><br><span class="line">kubectl <span class="built_in">set</span> image deployment &lt;deployment_name&gt; \ &lt;image_name:version&gt;</span><br><span class="line"></span><br><span class="line">kubectl rollout undo deployment &lt;deployment_name&gt;</span><br></pre></td></tr></table></figure>


<h2 id="Service-creation"><a href="#Service-creation" class="headerlink" title="Service creation"></a>Service creation</h2><ul>
<li><p>Create a Service named redis-service of type ClusterIP to expose pod redis on port 6379</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose pod redis --port=6379 --name redis-service --dry-run=client -o yaml <span class="comment"># automatically use pods labels as selectors</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a Service named nginx of type NodePort to expose pod nginx’s port 80 on port 30080 on the nodes:</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose pod nginx --<span class="built_in">type</span>=NodePort --port=80 --name=nginx-service --dry-run=client -o yaml</span><br></pre></td></tr></table></figure>

<ul>
<li><p>create service in a imperative way</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose deployment &lt;deploy_name&gt; --port 80</span><br></pre></td></tr></table></figure>
</li>
<li><p>able to enable service while creating pods</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run &lt;name&gt; --image=&lt;image_name&gt; --port=&lt;port_name&gt; --expose</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Namaespaces"><a href="#Namaespaces" class="headerlink" title="Namaespaces"></a>Namaespaces</h2><ul>
<li>To create namespace</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create namespace dev <span class="comment"># or</span></span><br><span class="line">kubectl create -f &lt;namespace_definition.yml&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>To add pod in the certain namespace:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--namespace=&lt;namespace_name&gt;</span><br></pre></td></tr></table></figure>

<p> Or to add <code>namespace:</code> under  <code>metadata: </code> in the pod definition file.</p>
<ul>
<li>To change to other namespace so that no need to add <code>-n &lt;namespace&gt;</code> to see the pods<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config set-context $(kubectl config current-context) --namespace=dev</span><br></pre></td></tr></table></figure></li>
<li>To see all the pods in all name space</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods --all-namespaces</span><br></pre></td></tr></table></figure>

<h2 id="Schedulers"><a href="#Schedulers" class="headerlink" title="Schedulers"></a>Schedulers</h2><ul>
<li>Filter objects by specifying selectors<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get &lt;sth&gt; --selector &lt;sth.&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>-Create configmap</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap --name &lt;configmap_name&gt; --from-file=&lt;PATH_TO_FILE&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Taint-Node"><a href="#Taint-Node" class="headerlink" title="Taint - Node"></a>Taint - Node</h2><ul>
<li><p>add taints to nodes</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes &lt;node_name&gt; &lt;keys=values&gt;:&lt;taint-effect&#123;NoSchedule|PreferNoSchedule|NoExecute&#125;&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>add tolerations on pods</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tolerations:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;&lt;key&gt;&quot;</span></span><br><span class="line">    <span class="attr">operator:</span> <span class="string">&quot;Equal&quot;</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&quot;&lt;value&gt;&quot;</span></span><br><span class="line">    <span class="attr">effect:</span> <span class="string">&quot;&lt;taint-effect&gt;&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="Node-affinity"><a href="#Node-affinity" class="headerlink" title="Node affinity"></a>Node affinity</h2><h3 id="Node-selector"><a href="#Node-selector" class="headerlink" title="Node selector:"></a>Node selector:</h3><ul>
<li><p>one way to assign nodes for specific pods by setting label on nodes </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&lt;pod&gt;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nodeSelector:</span></span><br><span class="line">    <span class="attr">size:</span> <span class="string">Large</span></span><br></pre></td></tr></table></figure></li>
<li><p>then label a node by</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl label nodes &lt;node-name&gt; &lt;label-key&gt;=&lt;label-value&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Node affinity provide more complicated assignment and placement for nodes</p>
</li>
</ul>
<p><strong>Values can be set to blank if operator uses Exists.</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pod definition</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">affinity:</span></span><br><span class="line">    <span class="attr">nodeAffinity:</span></span><br><span class="line">      <span class="attr">requiredDuringSchedulingIgnoredDuringExectuion:</span></span><br><span class="line">        <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">size</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span>  <span class="comment"># placed on any nodes with values under in </span></span><br><span class="line">            <span class="attr">values:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Large</span></span><br></pre></td></tr></table></figure>

<h3 id="Resource-requests"><a href="#Resource-requests" class="headerlink" title="Resource requests"></a>Resource requests</h3><ul>
<li>allocate resources desirable for pods:<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">&quot;4Gi&quot;</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">limits:</span></span><br><span class="line">      <span class="attr">memory:</span></span><br><span class="line">      <span class="attr">cpu:</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Pod-monitoring"><a href="#Pod-monitoring" class="headerlink" title="Pod monitoring"></a>Pod monitoring</h2><ul>
<li><p>check memory, cpu</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl top node/pods</span><br></pre></td></tr></table></figure>
</li>
<li><p>check logs</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs -f &lt;pod_name&gt;</span><br><span class="line">kubectl previous -f &lt;pod_name&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Node-execution"><a href="#Node-execution" class="headerlink" title="Node execution"></a>Node execution</h2><ul>
<li><p>enable shell in kubernetes</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> --stdin --<span class="built_in">tty</span> &lt;pod_name&gt; &lt;container_name&gt; -n &lt;namespace&gt; -- /bin./bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>copy files from local to pods vice versa.</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copy file from pods to local director</span></span><br><span class="line">    kubectl <span class="built_in">cp</span> &lt;namespace&gt;/&lt;pod_name&gt;:/PATH/FILE /LOCAL_PATH/FILE_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy file from local to pods</span></span><br><span class="line">    kubectl <span class="built_in">cp</span> /LOCAL_PATH/FILE_NAME &lt;namespace&gt;/&lt;pod_name&gt;:/PATH/FILE </span><br></pre></td></tr></table></figure>

<h2 id="ENV-VAR-and-ConfigMap"><a href="#ENV-VAR-and-ConfigMap" class="headerlink" title="ENV VAR and ConfigMap"></a>ENV VAR and ConfigMap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap \</span><br><span class="line">&lt;config-name&gt; --from-literal=&lt;key&gt;=&lt;value&gt;</span><br><span class="line"></span><br><span class="line">kubectl create configmap \</span><br><span class="line">&lt;config-name&gt; --from-file=&lt;configmap_file_name&gt;</span><br><span class="line"></span><br><span class="line">kubectl create -f cfgmap_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># display configmaps</span></span><br><span class="line">kubectl get/describe &lt;configmap_name&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Secrets"><a href="#Secrets" class="headerlink" title="Secrets"></a>Secrets</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create secret using command</span></span><br><span class="line">kubectl create secret generic &lt;secret-name&gt; \</span><br><span class="line">--from-literal=&lt;key&gt;=&lt;value&gt;</span><br><span class="line"></span><br><span class="line">kubectl create secret generic \</span><br><span class="line">&lt;secret-name&gt; --from-file=&lt;secret_file_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker registry secret</span></span><br><span class="line">kubectl create secret docker-registry &lt;secret-name&gt; \</span><br><span class="line">--docker-server= \</span><br><span class="line">--docker-username= \</span><br><span class="line">--docker-password= \</span><br><span class="line">--docker-email=</span><br></pre></td></tr></table></figure>

<h2 id="Service-account"><a href="#Service-account" class="headerlink" title="Service account"></a>Service account</h2><ul>
<li>A service account is an account for services like jenkins and Prometheus to perform tasks on clusters<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create service account</span></span><br><span class="line">kubectl create serviceaccount &lt;account_name&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Procedure-for-pods-when-executing-node-graceful-restart"><a href="#Procedure-for-pods-when-executing-node-graceful-restart" class="headerlink" title="Procedure for pods when executing node graceful restart"></a>Procedure for pods when executing node graceful restart</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># drain pod on the nodes you want to perform reboot procedure</span></span><br><span class="line">    kubectl drain --ignore-daemonsets --delete-emptydir-data</span><br><span class="line">    kubectl describe nodes &lt;node-name&gt;</span><br><span class="line">    <span class="comment"># perform node reboot</span></span><br><span class="line">    kubectl uncordon &lt;node_name&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="Kube-storage"><a href="#Kube-storage" class="headerlink" title="Kube storage"></a>Kube storage</h2><ul>
<li>default directory for docker:</li>
</ul>
<p><code>/var/lib/docker </code></p>
<ul>
<li>To preserve data for container, always create persistent volume for it<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker volume create &lt;name&gt;</span><br><span class="line">docker run -v &lt;volume_name&gt;:&lt;dir_in_container&gt; &lt;container_name&gt; <span class="comment">#volume mounted on /var/lib/docker/volumes or binding mounting on any directories</span></span><br><span class="line">docker run -v &lt;mounted_path&gt;:&lt;dir_in_container&gt; &lt;container_name&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h2><ul>
<li>view kubelet option about CNI<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep kubelet</span><br><span class="line"><span class="built_in">ls</span> /opt/cni/bin</span><br><span class="line"><span class="built_in">ls</span> /etc/cni/net.d</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="JsonPath"><a href="#JsonPath" class="headerlink" title="JsonPath"></a>JsonPath</h2><ol>
<li>what information you need?<br><code> kubectl get ?</code></li>
<li>output as json</li>
<li>check the info and check JSON PATH<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -o=json=<span class="string">&#x27;&#123;JSON_PATH&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">kubectl get pods -o=jsonpath=<span class="string">&#x27;&#123; .items[*].metadata.name&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Prometheus-related-command"><a href="#Prometheus-related-command" class="headerlink" title="Prometheus related command"></a>Prometheus related command</h2><ul>
<li>View prometheus rules</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get prometheusrules -A </span><br></pre></td></tr></table></figure>

<ul>
<li>View service monitor</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get servicemonitor -A <span class="comment"># Service monitor is attached to service to enable prometheus retrieve metrics for core kubernetes components </span></span><br></pre></td></tr></table></figure>

<h2 id="Helm-related-command"><a href="#Helm-related-command" class="headerlink" title="Helm related command"></a>Helm related command</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">helm list</span><br><span class="line">helm <span class="built_in">history</span> &lt;release_name&gt;</span><br><span class="line">helm upgrade &lt;release_name&gt;</span><br><span class="line">helm rollback &lt;release_name&gt; &lt;version_no&gt; <span class="comment"># helm rollback nginx-release 1 # create a new version with same config as version 1</span></span><br></pre></td></tr></table></figure>

<h2 id="List-all-resources-and-explain"><a href="#List-all-resources-and-explain" class="headerlink" title="List all resources and explain"></a>List all resources and explain</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl api-resources</span><br><span class="line">kubectl explain &lt;res&gt;</span><br><span class="line">kubectl explain &lt;res.subfield&gt;</span><br><span class="line">kubectl explain &lt;res&gt; --recursive</span><br><span class="line"><span class="comment"># e.g. kubectl explain pod.spec</span></span><br></pre></td></tr></table></figure>

<h3 id="Some-fancy-custom-listing-examples"><a href="#Some-fancy-custom-listing-examples" class="headerlink" title="Some fancy custom listing examples:"></a>Some fancy custom listing examples:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -o custom-columns=<span class="string">&quot;NAME:.metadata.name,PRIORITY:.spec.priorityClassName&quot;</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2023/06/05/K8s-cmds/" data-id="cmkjfu8y00006ecur4fdzfmxm" data-title="K8s cmds" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/K8s/" rel="tag">K8s</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Linux-cmds" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/06/04/Linux-cmds/" class="article-date">
  <time class="dt-published" datetime="2023-06-04T10:18:25.000Z" itemprop="datePublished">2023-06-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/commands/">commands</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog/2023/06/04/Linux-cmds/">Linux cmds</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Basic-linux-cmds"><a href="#Basic-linux-cmds" class="headerlink" title="Basic linux cmds"></a>Basic linux cmds</h1><h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><ol>
<li><a href="#system-check-related-commands">System check realted commands</a></li>
<li><a href="#inputoutput-related-commands">Input&#x2F;output related commands</a></li>
<li><a href="#shell-and-bash-scripting-related">Shell and bash scripting</a></li>
<li><a href="#security-and-certificate-generation">Security and cert</a></li>
<li><a href="#kvm-related">VM management</a></li>
</ol>
<h2 id="System-check-related-commands"><a href="#System-check-related-commands" class="headerlink" title="System check related commands"></a>System check related commands</h2><h3 id="Often-used-basic-commands-and-their-variations"><a href="#Often-used-basic-commands-and-their-variations" class="headerlink" title="Often used basic commands and their variations"></a>Often used basic commands and their variations</h3><ul>
<li>‘cat’ command and its successor ‘bat’</li>
</ul>
<h3 id="Log-check-commands"><a href="#Log-check-commands" class="headerlink" title="Log check commands"></a>Log check commands</h3><ul>
<li>use journalctl to check service logs</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">journalctl -f -u &lt;someservice.service&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Resource-check-commands"><a href="#Resource-check-commands" class="headerlink" title="Resource check commands"></a>Resource check commands</h3><ul>
<li>Check CPU info</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/cpuinfo</span><br></pre></td></tr></table></figure>

<p>or </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> cpu</span><br></pre></td></tr></table></figure>

<ul>
<li>Check memory</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep MemTotal /proc/meminfo</span><br></pre></td></tr></table></figure>

<p>or </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">free -m <span class="comment"># show in mbyte</span></span><br><span class="line">free -h <span class="comment"># human-readable forms</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Check Virtual memory</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep VmallocTotal /procm/meminfo </span><br></pre></td></tr></table></figure>

<ul>
<li>check block device<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br></pre></td></tr></table></figure></li>
<li>display disk partition status</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br></pre></td></tr></table></figure>

<ul>
<li>Check devices</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -la /sys/devices</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Check folder size</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">du</span> -xhs /&lt;PATH&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>check logical volume, physical volume and volume group </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo lvscan <span class="comment"># list logical volumes</span></span><br><span class="line">sudo vgs <span class="comment"># list volume group</span></span><br><span class="line">sudo pvdisplay <span class="comment"># list physical volume</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>check I&#x2F;O status</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iostat -z -- human</span><br></pre></td></tr></table></figure>
</li>
<li><p>use lsof command to follow process</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check port usage </span></span><br><span class="line">sudo lsof -i TCP:1-1024 <span class="comment"># check private port usage</span></span><br><span class="line">sudo lsof -p &lt;pid&gt; -i UDP <span class="comment"># check process&#x27;s udp usage</span></span><br><span class="line"><span class="comment"># check process</span></span><br><span class="line">sudo lsof -p &lt;pid&gt; <span class="comment"># follow process&#x27;s activity</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>check uptime</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uptime</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>chec khow long an operation takes</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">time (the <span class="built_in">command</span>)</span><br><span class="line"><span class="comment"># for example</span></span><br><span class="line">time (<span class="built_in">ls</span> -lf)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Network-related-commands"><a href="#Network-related-commands" class="headerlink" title="Network related commands"></a>Network related commands</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">netstat -t -u -n -p -l <span class="comment"># tcp | udp | numeric(do not resolve hostnames) | programs | listening</span></span><br><span class="line"><span class="comment">#or </span></span><br><span class="line">ss -tlpun</span><br><span class="line"></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 localhost:43619         0.0.0.0:*               LISTEN      13331/node</span><br><span class="line">tcp        0      0 127.0.0.53:domain       0.0.0.0:*               LISTEN      1860/systemd-resolv</span><br><span class="line">tcp        0      0 localhost:34781         0.0.0.0:*               LISTEN      248/containerd</span><br><span class="line">tcp        0      0 localhost:32809         0.0.0.0:*               LISTEN      13259/node</span><br><span class="line">udp        0      0 127.0.0.53:domain       0.0.0.0:*                           1860/systemd-resolv</span><br><span class="line">udp        0      0 localhost:323           0.0.0.0:*                           -</span><br><span class="line">udp6       0      0 ip6-localhost:323       [::]:*                              -</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -i -P -n | grep LISTEN <span class="comment"># -i: listing ports | -P: Inhibits the conversion of port numbers to port names for network files. Inhibiting the conversion may make lsof run a little faster. It is also useful when port name lookup is not working properly. | -n: no dns</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep -v <span class="string">&quot;rem_address&quot;</span> /proc/net/tcp  | awk  <span class="string">&#x27;&#123;x=strtonum(&quot;0x&quot;substr($3,index($3,&quot;:&quot;)-2,2)); for (i=5; i&gt;0; i-=2) x = x&quot;.&quot;strtonum(&quot;0x&quot;substr($3,i,2))&#125;&#123;print x&quot;:&quot;strtonum(&quot;0x&quot;substr($3,index($3,&quot;:&quot;)+1,4))&#125;&#x27;</span></span><br><span class="line"><span class="comment"># If nestat is not there, we can check connection using this instead.</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Check interface bond</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/net/bonding/&lt;bondname&gt;</span><br><span class="line"><span class="comment"># remove interface from bond</span></span><br><span class="line">/sbin/ifenslave -d bond0 eth0</span><br><span class="line"><span class="comment"># add interface to bond</span></span><br><span class="line">/sbin/ifenslave bond0 eth0</span><br></pre></td></tr></table></figure>

<ul>
<li><p>check ip link conditions arps</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span> show</span><br><span class="line">ip addr show</span><br><span class="line"></span><br><span class="line"><span class="comment"># check arp</span></span><br><span class="line">arp</span><br><span class="line"><span class="comment"># check ip neighbors/ arp neighbors</span></span><br><span class="line">ip neigh</span><br><span class="line"></span><br><span class="line"><span class="comment"># check net adaptor related </span></span><br><span class="line">iw dev &lt;nic_name&gt; info</span><br></pre></td></tr></table></figure>
</li>
<li><p>check ip link on other network namespaces</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip -n &lt;ns_name&gt; ip <span class="built_in">link</span></span><br><span class="line"><span class="comment"># network namespace has its own arp tables</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>create virtual link between two ns</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span> add &lt;name&gt; <span class="built_in">type</span> veth peer name &lt;peer-veth_name&gt;</span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> &lt;name&gt; netns &lt;ns_name&gt;</span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> &lt;peer-veth_name&gt; netns &lt;ns_name&gt;</span><br><span class="line">ip -n &lt;ns_name&gt; <span class="built_in">link</span> <span class="built_in">set</span> &lt;name&gt; up</span><br><span class="line">ip -n &lt;peer_ns_name&gt; <span class="built_in">link</span> <span class="built_in">set</span> &lt;peer_veth_name&gt; up</span><br></pre></td></tr></table></figure>
</li>
<li><p>configure vswitch for namespaces</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span> add &lt;name&gt; <span class="built_in">type</span> bridge</span><br><span class="line">ip <span class="built_in">link</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev &lt;name&gt; up</span><br><span class="line">ip <span class="built_in">link</span> add &lt;name&gt; <span class="built_in">type</span> veth peer name &lt;peer-vswitch-name&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>check if ip forwarding is enabled</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/sys/net/ipv4/ip_forward <span class="comment"># 1 for enable</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>check traffic status on inteface</p>
</li>
</ul>
<p>There are several commands to check traffic.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.  sar command.</span></span><br><span class="line"></span><br><span class="line">sar -n DEV 1 <span class="comment"># 1 means monitor real-time every 1 second</span></span><br><span class="line"><span class="comment"># if want to check past status</span></span><br><span class="line"><span class="built_in">cd</span> /var/log/sysstat <span class="comment"># check for sa files</span></span><br><span class="line">sar -n DEV -f /var/log/sysstat/sa10 -s 12:00:00 -e 13:00:00 <span class="comment"># check from time to time</span></span><br><span class="line">sar -n DEV -f /var/log/sysstat/sa10 <span class="comment"># check all traffic. default is every 10 min.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ethtool </span></span><br><span class="line">ethtool -S &lt;interface_name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ip link show </span></span><br><span class="line">ip -s <span class="built_in">link</span> show &lt;interface_name&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Process-related-commands"><a href="#Process-related-commands" class="headerlink" title="Process related commands"></a>Process related commands</h3><ul>
<li>List current process and show in tree form<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstree</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Syscall-related-commands"><a href="#Syscall-related-commands" class="headerlink" title="Syscall related commands"></a>Syscall related commands</h3><ul>
<li>Follow syscall</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace + syscall_cmd</span><br></pre></td></tr></table></figure>

<ul>
<li><p>use  -c summarize the overview of the command</p>
</li>
<li><p>Check kernel machine and kernel release</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -srm</span><br></pre></td></tr></table></figure>

<ul>
<li>Check capability (Advanced access control)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">capsh --<span class="built_in">print</span></span><br><span class="line">grep Cap /proc/$$/status <span class="comment"># capabilities for the current process</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="cgroup-and-namespace-related-commands"><a href="#cgroup-and-namespace-related-commands" class="headerlink" title="cgroup and namespace related commands"></a>cgroup and namespace related commands</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo lsns <span class="comment"># check namespace</span></span><br><span class="line">systemctl status <span class="comment"># check cgroup</span></span><br></pre></td></tr></table></figure>
<h3 id="Directory-sync-commands"><a href="#Directory-sync-commands" class="headerlink" title="Directory sync commands"></a>Directory sync commands</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rsync &lt;source_ip&gt; &lt;user_name&gt;@&lt;target_ip&gt;:/dir</span><br><span class="line"><span class="comment">#a -- for archive keep file group, version etc</span></span><br><span class="line"><span class="comment">#z -- for compress</span></span><br><span class="line"><span class="comment">#p -- keep permissions</span></span><br><span class="line"><span class="comment">#q -- quiet mode</span></span><br><span class="line"><span class="comment">#v -- verbose</span></span><br></pre></td></tr></table></figure>

<h2 id="Input-x2F-output-related-commands"><a href="#Input-x2F-output-related-commands" class="headerlink" title="Input&#x2F;output related commands"></a>Input&#x2F;output related commands</h2><ul>
<li>Translate with input&#x2F;outs. tr command.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="built_in">tr</span> [input] [output]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Examples</span></span><br><span class="line"><span class="comment"># Input some texts into tr command then translate to all CAPS</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">tr</span> [a-z] [A-Z] &lt; input.txt &gt;output.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># delete numbers in the given input</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;My UID is <span class="variable">$UID</span>&quot;</span> | <span class="built_in">tr</span> -<span class="built_in">cd</span> <span class="string">&quot;[:digit:]\n&quot;</span></span><br></pre></td></tr></table></figure>
for detailed SETS, need to check with the <code>tr --help</code> command</li>
</ul>
<h3 id="Locate-file-x2F-folders"><a href="#Locate-file-x2F-folders" class="headerlink" title="Locate file&#x2F;folders"></a>Locate file&#x2F;folders</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">locate <span class="comment"># Find all files available with keyword </span></span><br><span class="line">whereis <span class="comment"># find binary file, config file and man files</span></span><br><span class="line"><span class="built_in">which</span> <span class="comment"># find the position of the command executed</span></span><br></pre></td></tr></table></figure>

<h3 id="File-content-management"><a href="#File-content-management" class="headerlink" title="File content management"></a>File content management</h3><ul>
<li><p>Create a file using here document. “EOF”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">&#x27;EOF&#x27;</span> &gt; /some_dir/file_name</span><br><span class="line"><span class="comment"># ENDLINE with EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Compare to files side by side</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff -y file1 file2</span><br></pre></td></tr></table></figure></li>
<li><p><strong>To see a constantly growing file</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f sth.log</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Find-command"><a href="#Find-command" class="headerlink" title="Find command"></a>Find command</h3><ul>
<li>For example, to find available modules in Linux.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    find /lib/modules/$(umame -r) -<span class="built_in">type</span> f -name <span class="string">&#x27;*.ko*&#x27;</span></span><br><span class="line">    <span class="comment"># find &quot;in directory - type file or else -name &#x27;&#x27; with anything related to .ko</span></span><br><span class="line">    <span class="comment"># It didn&#x27;t work on my WSL ubuntu</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&#x27;find&#x27; command and its better version</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># example of using find and rg to find yaml files that contains &quot;sample&quot;</span></span><br><span class="line">    find . -<span class="built_in">type</span> f -name <span class="string">&quot;*.yaml&quot;</span> -<span class="built_in">exec</span> grep <span class="string">&quot;sample&quot;</span> <span class="string">&#x27;&#123;&#125;&#x27;</span> \; -<span class="built_in">print</span></span><br><span class="line">    rg -t <span class="string">&quot;yaml&quot;</span> sample</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>Copy&#x2F;move multiple files using wildcard with advanced find command<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -<span class="built_in">type</span> f -name <span class="string">&quot;file_name*.*&quot;</span> -<span class="built_in">exec</span> <span class="built_in">mv</span> <span class="string">&#x27;&#123;&#125;&#x27;</span> /target_dir/ \;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="To-list-modules-that-loaded-by-kernel"><a href="#To-list-modules-that-loaded-by-kernel" class="headerlink" title="To list modules that loaded by kernel"></a>To list modules that loaded by kernel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod</span><br></pre></td></tr></table></figure>

<h3 id="scp-command"><a href="#scp-command" class="headerlink" title="scp command"></a>scp command</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Upload: </span></span><br><span class="line">    scp -i &lt;Path_to_key&gt;  /dir/file username@remote:/dir  </span><br><span class="line"><span class="comment">#Download: </span></span><br><span class="line">    scp -i &lt;Path_to_key&gt; username@remote/dir/file /local/dir</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Shell-and-bash-scripting-related"><a href="#Shell-and-bash-scripting-related" class="headerlink" title="Shell and bash scripting related"></a>Shell and bash scripting related</h2><h3 id="terminal-and-shell"><a href="#terminal-and-shell" class="headerlink" title="terminal and shell"></a>terminal and shell</h3><ul>
<li>solve problem of <code>/bin/bash^m bad interpreter no such file or directory</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/\r//&#x27;</span> &lt;filename&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>check terminal configuration</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    infocmp</span><br><span class="line"><span class="comment">#       Reconstructed via infocmp from file: /lib/terminfo/x/xterm-256color</span></span><br><span class="line">xterm-256color|xterm with 256 colors,</span><br><span class="line">        am, bce, ccc, km, mc5i, mir, msgr, npc, xenl,</span><br><span class="line">        colors<span class="comment">#0x100, cols#80, it#8, lines#24, pairs#0x10000,</span></span><br><span class="line">        acsc=``aaffggiijjkkllmmnnooppqqrrssttuuvvwwxxyyzz&#123;&#123;||&#125;&#125;~~,</span><br></pre></td></tr></table></figure>

<p>In general, shell uses File Descriptors for input and output</p>
<ul>
<li>stdin (FD 0)</li>
<li>stdout (FD 1)</li>
<li>stderr (FD 2)</li>
</ul>
<p>Here is some redirect examples:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl https://sth.com &amp;&gt; /dev/null <span class="comment"># no output generated </span></span><br><span class="line"></span><br><span class="line">curl https://sth.com 1&gt; output 2&gt; curl_status <span class="comment"># generate std output and status of the execution of curl seperatelly.</span></span><br><span class="line"></span><br><span class="line">curl https://sth.com 1&gt;&amp;2 file <span class="comment"># 2 kind of outputs in one file.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h3><p>There are <em>Shell variables</em> and <em>Environmental Variables</em> in Linux.<br>Shell variables only exist in local shell process and are not inherited by subprocesses. Env variables are shell-wide.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MY_VAR=42 <span class="comment"># Shell variable</span></span><br><span class="line"><span class="built_in">export</span> MY_GLOBAL_VAR=250 <span class="comment"># Global variable</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">set</span> | grep MY</span><br><span class="line">MY_GLOBAL_VAR=250</span><br><span class="line">MY_VAR=42</span><br><span class="line">$ <span class="built_in">env</span> | grep MY</span><br><span class="line">MY_GLOBAL_VAR=250</span><br><span class="line">$ bash</span><br><span class="line">$ <span class="built_in">set</span> | grep MY  <span class="comment"># Shell variable only exists in current shell.</span></span><br><span class="line">MY_GLOBAL_VAR=250</span><br></pre></td></tr></table></figure>
<p>Full environmental variable list is under <a target="_blank" rel="noopener" href="https://www.gnu.org/software/bash/manual/html_node/Bash-Variables.html">GNU bash manual</a>.</p>
<h3 id="Exit-status"><a href="#Exit-status" class="headerlink" title="Exit status"></a>Exit status</h3><p>The result of the execution of commands are determined by the exit status code from 0-255, in which 0 means normal. To query the exit status, use <code>echo &amp;?</code> </p>
<h3 id="Job-control"><a href="#Job-control" class="headerlink" title="Job control"></a>Job control</h3><p>We can run commands in background, and then take it back to the foreground. Also use ctrl+z is able to put command into background.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;some <span class="built_in">command</span>&gt; &amp; <span class="comment"># use &amp; to run commands in backend</span></span><br><span class="line"><span class="built_in">fg</span> <span class="comment"># bring command back to frontend</span></span><br><span class="line"><span class="built_in">jobs</span> <span class="comment"># watch current jobs in the backend</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">disown</span></span><br><span class="line"><span class="built_in">nohup</span> <span class="comment"># disown and nohup</span></span><br></pre></td></tr></table></figure>

<p>Terminal multiplexer, is also able to maintain multiple tasks. </p>
<h3 id="Json-processing-command-jq"><a href="#Json-processing-command-jq" class="headerlink" title="Json processing command jq"></a>Json processing command jq</h3><p>For example, we have a following json file.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;menu&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;file&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;File&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;popup&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;menuitem&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;New&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;onclick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CreateNewDoc()&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Open&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;onclick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenDoc()&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>dot ‘.’ followed by the object is used to access the value of jq.      </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># this shows the whole file of test.json</span></span><br><span class="line">jq <span class="string">&#x27;.&#x27;</span> test.json</span><br><span class="line"><span class="comment"># use multiple dots to show the nested proterty</span></span><br><span class="line">jq <span class="string">&#x27;.menu.value, .menu.id&#x27;</span> test.json</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;File&quot;</span><br><span class="line">&quot;file&quot;</span><br></pre></td></tr></table></figure>
<p>It is able to use <code>[]</code> to show lists in json file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq <span class="string">&#x27;.menu.popup.menuitem&#x27;</span> test.json | jq <span class="string">&#x27;.[]&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;New&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;onclick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CreateNewDoc()&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Open&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;onclick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenDoc()&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span>   </span><br></pre></td></tr></table></figure>
<p>Also, it is able to use index in the <code>[]</code> operator. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq <span class="string">&#x27;.menu.popup.menuitem&#x27;</span> test.json | jq <span class="string">&#x27;.[0].value&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;New&quot;  </span><br></pre></td></tr></table></figure>

<h3 id="Time-display"><a href="#Time-display" class="headerlink" title="Time display"></a>Time display</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># show time in linux epoch</span></span><br><span class="line"><span class="built_in">date</span> +%s</span><br><span class="line"></span><br><span class="line"><span class="comment"># linux time to human readable time</span></span><br><span class="line"><span class="built_in">date</span> -d @1707912602 <span class="string">&#x27;+%m/%d/%Y :%H:%M:%S&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Security-and-certificate-generation"><a href="#Security-and-certificate-generation" class="headerlink" title="Security and certificate generation"></a>Security and certificate generation</h2><p>Generate keys for CA.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># generate private key</span></span><br><span class="line">openssl genrsa -out ca.key 2048 </span><br><span class="line"><span class="comment"># create CSR</span></span><br><span class="line">openssl req -new -key ca.key -subj <span class="string">&quot;/CN=&quot;</span> -out ca.csr</span><br><span class="line"><span class="comment"># sign the CSR</span></span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> ca.csr -signkey ca.key -out ca.crt</span><br></pre></td></tr></table></figure>

<p>Generate keys cert for client</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out admin.key 2048</span><br><span class="line">openssl req -new -key admin.key -subj <span class="string">&quot;/CN=kube-admin/O=system:masters&quot;</span> -out admin.csr</span><br><span class="line"><span class="comment"># Sign the csr using CA&#x27;s private key</span></span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> admin.csr -CA ca.crt -CAkey ca.key -out admin.crt</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Check certificate details</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> /etc/kubernetes/pki/apiserver.crt -text -noout</span><br></pre></td></tr></table></figure>

<h2 id="KVM-related"><a href="#KVM-related" class="headerlink" title="KVM related"></a>KVM related</h2><ul>
<li><p>check vm list</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh list --all</span><br></pre></td></tr></table></figure></li>
<li><p>login into a vm</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh console &lt;vm-name&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>to logout from vm, use <code>ctrl+5</code></p>
</li>
<li><p>Check VM IP nad net stack</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">virsh net-list <span class="comment"># show network name</span></span><br><span class="line">virsh net-info &lt;net_name&gt; <span class="comment"># default named default</span></span><br><span class="line">virsh net-dhcp-leases &lt;net_name&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Docker-or-container-related-command"><a href="#Docker-or-container-related-command" class="headerlink" title="Docker or container related command"></a>Docker or container related command</h3><p>Open Container Initiative</p>
<ul>
<li>imagespec</li>
<li>runtimespec</li>
</ul>
<hr>
<p>Support for docker on kubernetes is terminated, containerd is used instead</p>
<p>Command <code>nerdctl</code> is similar to docker, you can use all command just replace <code>docker</code> to <code>nerdctl</code> or</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">crictl pods</span><br><span class="line">crictl logs </span><br><span class="line">crictl <span class="built_in">exec</span> -it &lt;<span class="built_in">id</span>&gt; <span class="built_in">ls</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2023/06/04/Linux-cmds/" data-id="cmkjfu8y1000aecur57si0ykx" data-title="Linux cmds" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Linux/" rel="tag">Linux</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="extend next" rel="next" href="/blog/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/DIY-and-lab/">DIY and lab</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Learning/">Learning</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/commands/">commands</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/troubleshooting/">troubleshooting</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Cloud-native/" rel="tag">Cloud native</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/K8s/" rel="tag">K8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/PKI-encryption-TLS/" rel="tag">PKI, encryption, TLS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/k8s-helm/" rel="tag">k8s, helm</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/Cloud-native/" style="font-size: 10px;">Cloud native</a> <a href="/blog/tags/K8s/" style="font-size: 20px;">K8s</a> <a href="/blog/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/blog/tags/PKI-encryption-TLS/" style="font-size: 10px;">PKI, encryption, TLS</a> <a href="/blog/tags/k8s-helm/" style="font-size: 15px;">k8s, helm</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2026/01/">January 2026</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/06/">June 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2026/01/05/deploy-5gc-on-kubernetes/">Deploy-5gc-on-kubernetes</a>
          </li>
        
          <li>
            <a href="/blog/2026/01/05/Deploy-k8s-cluster/">Deploy kubernetes cluster on virtual machine</a>
          </li>
        
          <li>
            <a href="/blog/2024/07/18/PKI-and-encryption-explained-step-by-step/">PKI and encryption explained step by step</a>
          </li>
        
          <li>
            <a href="/blog/2024/02/21/linux-FS-and-pkg/">linux FS and pkg</a>
          </li>
        
          <li>
            <a href="/blog/2023/10/23/Deploy-free5GC-with-k8s-and-helm/">Deploy free5GC with k8s and helm</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2026 Hongyi Shen<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/blog/js/jquery-3.6.4.min.js"></script>



  
<script src="/blog/fancybox/jquery.fancybox.min.js"></script>




<script src="/blog/js/script.js"></script>





  </div>
</body>
</html>