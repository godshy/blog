<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Deploy free5GC with k8s and helm | Hongyi&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Install free5gc on personal pcs using k8s and helmBackgroundVery trivial and simple try to install and run free5gc on my personal PC by using Free5GC with Kubernetes, helm, calico and multus. For the">
<meta property="og:type" content="article">
<meta property="og:title" content="Deploy free5GC with k8s and helm">
<meta property="og:url" content="https://godshy.github.io/blog/2023/10/23/Deploy-free5GC-with-k8s-and-helm/index.html">
<meta property="og:site_name" content="Hongyi&#39;s blog">
<meta property="og:description" content="Install free5gc on personal pcs using k8s and helmBackgroundVery trivial and simple try to install and run free5gc on my personal PC by using Free5GC with Kubernetes, helm, calico and multus. For the">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2023/10/26/VRX3ncqWjINhxzY.png">
<meta property="og:image" content="https://s2.loli.net/2023/10/26/gJeHqMjoGhIONCR.png">
<meta property="og:image" content="https://s2.loli.net/2023/10/26/HkLGdtBNwoVfFCc.png">
<meta property="og:image" content="https://s2.loli.net/2023/10/26/oF6m4k1uTtsqc3d.png">
<meta property="og:image" content="https://s2.loli.net/2023/10/26/qcLoV1daCsj8TSR.png">
<meta property="article:published_time" content="2023-10-23T06:32:30.000Z">
<meta property="article:modified_time" content="2024-08-05T11:01:30.267Z">
<meta property="article:author" content="Hongyi Shen">
<meta property="article:tag" content="k8s, helm">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/10/26/VRX3ncqWjINhxzY.png">
  
    <link rel="alternate" href="/blog/atom.xml" title="Hongyi's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/blog/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/blog/css/style.css">

  
    
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Hongyi&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/blog/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://godshy.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Deploy-free5GC-with-k8s-and-helm" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/2023/10/23/Deploy-free5GC-with-k8s-and-helm/" class="article-date">
  <time class="dt-published" datetime="2023-10-23T06:32:30.000Z" itemprop="datePublished">2023-10-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/DIY-and-lab/">DIY and lab</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Deploy free5GC with k8s and helm
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Install-free5gc-on-personal-pcs-using-k8s-and-helm"><a href="#Install-free5gc-on-personal-pcs-using-k8s-and-helm" class="headerlink" title="Install free5gc on personal pcs using k8s and helm"></a>Install free5gc on personal pcs using k8s and helm</h1><h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Very trivial and simple try to install and run free5gc on my personal PC by using Free5GC with Kubernetes, helm, calico and multus.</p>
<p>For the first step, I was planning to install free5gc<br>on one cluster and test it using UERANSIM.</p>
<p>As for next step I plan to deploy free5gc on multiple nodes environments in which master and worker node are separated. Also planning to deploy on openstack environment or AWS.</p>
<h2 id="Prepare"><a href="#Prepare" class="headerlink" title="Prepare"></a>Prepare</h2><p>I was using vmware workstation and deployed ubuntu 20.6 image on it. Memory was set to around 10G to make sure calico works ok.</p>
<p><img src="https://s2.loli.net/2023/10/26/VRX3ncqWjINhxzY.png" alt="VM info"></p>
<p>After ubuntu is up, do the install and update packages first.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:~$ sudo apt update -y</span><br><span class="line">:~$ sudo apt upgrade -y</span><br><span class="line">:~$ sudo apt install -y curl wget apt-transport-https</span><br></pre></td></tr></table></figure>

<p>Then install and start up minikube, minikube enables user to set up kubernetes cluster on the system.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">:~$ wget https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</span><br><span class="line">:~$ sudo <span class="built_in">cp</span> minikube-linux-amd64 /usr/local/bin/minikube</span><br><span class="line">:~$ sudo <span class="built_in">chmod</span> +x /usr/local/bin/minikube</span><br><span class="line"><span class="comment"># use calico as cni(container network interface) plugin </span></span><br><span class="line">:~$ minikube start --driver=docker --cpus=4 --memory=8g --disk-size=20g --cni=calico</span><br><span class="line"></span><br><span class="line">:~$ minikube status</span><br><span class="line"></span><br><span class="line">    minikube</span><br><span class="line">    <span class="built_in">type</span>: Control Plane</span><br><span class="line">    host: Running</span><br><span class="line">    kubelet: Running</span><br><span class="line">    apiserver: Running</span><br><span class="line">    kubeconfig: Configured</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2023/10/26/gJeHqMjoGhIONCR.png" alt="minikube status"></p>
<p>After minikube was installed, install kubectl for better experience. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">:~$ curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl</span><br><span class="line"><span class="comment"># If exeucte the command directly, it may have warning regard to minikube and kubectl version mismatch. To avoid this, you can designate version of kubectl to match with minikube</span></span><br><span class="line">:~$ curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.26.3/bin/linux/amd64/kubectl</span><br><span class="line">:~$ <span class="built_in">chmod</span> +x kubectl</span><br><span class="line">:~$ sudo <span class="built_in">mv</span> kubectl /usr/local/bin/</span><br><span class="line">:~$ kubectl version -o yaml</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2023/10/26/HkLGdtBNwoVfFCc.png" alt="Installed kubectl"></p>
<p>Then for the last step of preparation, we need to install helm and multus-CNI plugin to enable multiple interface support for pods.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">:~$ curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3</span><br><span class="line">:~$ <span class="built_in">chmod</span> 700 get_helm.sh</span><br><span class="line">:~$ ./get_helm.sh</span><br><span class="line">:~$ helm list -A</span><br><span class="line">:~$ git <span class="built_in">clone</span> https://github.com/k8snetworkplumbingwg/multus-cni.git</span><br><span class="line">:~$ <span class="built_in">cd</span> multus-cni</span><br><span class="line">:~$ <span class="built_in">cat</span> ./deployments/multus-daemonset-thick.yml | kubectl apply -f -</span><br><span class="line">:~$ kubectl get pods -n kube-system</span><br></pre></td></tr></table></figure>

<p>For me I had multus pods oom killed, so I modified the request and limit resource in the multus-daemonset-thick.yml then pod went up fine.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kube-multus</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/k8snetworkplumbingwg/multus-cni:snapshot-thick</span></span><br><span class="line">    <span class="attr">command:</span> [ <span class="string">&quot;/usr/src/multus-cni/bin/multus-daemon&quot;</span> ]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;50Mi&quot;</span> <span class="string">--&gt;</span> <span class="string">&quot;250Mi&quot;</span></span><br><span class="line">      <span class="attr">limits:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;50Mi&quot;</span> <span class="string">--&gt;</span> <span class="string">&quot;350Mi&quot;</span></span><br><span class="line">    <span class="attr">securityContext:</span></span><br><span class="line">      <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni</span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/host/etc/cni/net.d</span></span><br></pre></td></tr></table></figure>

<h2 id="Free5gc-install"><a href="#Free5gc-install" class="headerlink" title="Free5gc install"></a>Free5gc install</h2><p>Main step of installing 5gc is to use helm to pull repository from free5gc git, then install the helm chart.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create namespace </span></span><br><span class="line">:~$ kubectl create namespace free5gc</span><br><span class="line"><span class="comment"># add helm repository</span></span><br><span class="line">:~$ helm repo add towards5gs <span class="string">&#x27;https://raw.githubusercontent.com/Orange-OpenSource/towards5gs-helm/main/repo/&#x27;</span></span><br><span class="line">:~$ helm repo update</span><br><span class="line">:~$ helm repo list</span><br><span class="line">:~$ helm search repo</span><br></pre></td></tr></table></figure>


<p><img src="https://s2.loli.net/2023/10/26/oF6m4k1uTtsqc3d.png" alt="Helm install"></p>
<p>After checking the helm repository, it is ok to procced with installing free5gc.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">:~$ helm -n free5gc install free5gc towards5gs/free5gc</span><br><span class="line">:~$ kubectl get pods -n free5gc</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><img src="https://s2.loli.net/2023/10/26/qcLoV1daCsj8TSR.png" alt="pod install complete"></p>
<p><strong>Upf pod cannot set up and will stuck in creating state because multus cannot add eth1 to this pod.</strong></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Orange-OpenSource/towards5gs-helm">towards5gs-helm-github</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/rahasak/deploying-5g-core-network-with-free5gc-kubernets-and-helm-charts-29741cea3922">Deploying 5G core network with Free5GC, Kubernetes and Helm</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/rahasak/deploying-5g-core-network-with-free5gc-kubernets-and-helm-charts-29741cea3922">Kubernetes環境でfree 5GCを動かすまで</a> </li>
<li><a target="_blank" rel="noopener" href="https://qiita.com/wzm/items/0dbe928ed891d82380d6">kubernetes cluster上にfree5gcを構築してみる</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://godshy.github.io/blog/2023/10/23/Deploy-free5GC-with-k8s-and-helm/" data-id="cm72q4pke0004v2khbq5k65dz" data-title="Deploy free5GC with k8s and helm" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/k8s-helm/" rel="tag">k8s, helm</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2024/02/21/linux-FS-and-pkg/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          linux FS and pkg
        
      </div>
    </a>
  
  
    <a href="/blog/2023/08/24/Cloud-native-and-its-implementation-in-Telco/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Cloud native and its implementation in Telco</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/DIY-and-lab/">DIY and lab</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/Learning/">Learning</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/commands/">commands</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/troubleshooting/">troubleshooting</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Cloud-native/" rel="tag">Cloud native</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/K8s/" rel="tag">K8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/PKI-encryption-TLS/" rel="tag">PKI, encryption, TLS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/k8s-helm/" rel="tag">k8s, helm</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/Cloud-native/" style="font-size: 10px;">Cloud native</a> <a href="/blog/tags/K8s/" style="font-size: 20px;">K8s</a> <a href="/blog/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/blog/tags/PKI-encryption-TLS/" style="font-size: 10px;">PKI, encryption, TLS</a> <a href="/blog/tags/k8s-helm/" style="font-size: 10px;">k8s, helm</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/06/">June 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2024/07/18/PKI-and-encryption-explained-step-by-step/">PKI and encryption explained step by step</a>
          </li>
        
          <li>
            <a href="/blog/2024/02/21/linux-FS-and-pkg/">linux FS and pkg</a>
          </li>
        
          <li>
            <a href="/blog/2023/10/23/Deploy-free5GC-with-k8s-and-helm/">Deploy free5GC with k8s and helm</a>
          </li>
        
          <li>
            <a href="/blog/2023/08/24/Cloud-native-and-its-implementation-in-Telco/">Cloud native and its implementation in Telco</a>
          </li>
        
          <li>
            <a href="/blog/2023/06/05/k8s-templates/">k8s templates</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 Hongyi Shen<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/blog/js/jquery-3.6.4.min.js"></script>



  
<script src="/blog/fancybox/jquery.fancybox.min.js"></script>




<script src="/blog/js/script.js"></script>





  </div>
</body>
</html>